<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8 Modelling fireworks disturbance | Fireworks</title>
  <meta name="description" content="Using ground-based bird counts and weather radar measurements to estimate numbers of birds aloft during NYE fireworks events." />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="8 Modelling fireworks disturbance | Fireworks" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Using ground-based bird counts and weather radar measurements to estimate numbers of birds aloft during NYE fireworks events." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 Modelling fireworks disturbance | Fireworks" />
  
  <meta name="twitter:description" content="Using ground-based bird counts and weather radar measurements to estimate numbers of birds aloft during NYE fireworks events." />
  

<meta name="author" content="Bart Hoekstra" />


<meta name="date" content="2020-07-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="07.Composite-all-PPIs.html"/>
<link rel="next" href="09.Quantifying-model-uncertainty.html"/>
<script src="assets/jquery-2.2.3/jquery.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="assets/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="assets/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="assets/typedarray-0.1/typedarray.min.js"></script>
<link href="assets/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="assets/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="assets/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="assets/plotly-main-1.52.2/plotly-latest.min.js"></script>
<link href="assets/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="assets/leaflet-1.3.1/leaflet.js"></script>
<link href="assets/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="assets/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="assets/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="assets/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="assets/leaflet-binding-2.0.3/leaflet.js"></script>
<script src="assets/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="assets/leaflet-providers-plugin-2.0.3/leaflet-providers-plugin.js"></script>
<script src="assets/layer.1-1/data_stars_layer136c0a7.txt"></script>
<script src="assets/joda-0.0.1/joda.js"></script>
<script src="assets/joda-0.0.1/addImageQuery-bindings.js"></script>
<script src="assets/clipboard-0.0.1/setClipboardText.js"></script>
<link href="assets/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="assets/HomeButton-0.0.1/home-button.js"></script>
<script src="assets/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="assets/layer.2-1/data_stars_layer2386e54.txt"></script>
<script src="assets/layer.3-1/data_stars_layer33bec70.txt"></script>
<script src="assets/layer.4-1/data_stars_layer446390d.txt"></script>
<script src="assets/layer.5-1/data_stars_layer50cabd5.txt"></script>
<script src="assets/layer.6-1/data_stars_layer6c4e68b.txt"></script>
<script src="assets/layer.7-1/data_stars_layer70b2de4.txt"></script>
<script src="assets/layer.8-1/data_stars_layer84a95bd.txt"></script>
<script src="assets/layer.9-1/data_stars_layer981daf9.txt"></script>
<script src="assets/layer.10-1/data_stars_layer10b47cda.txt"></script>
<script src="assets/urban-1/data_stars_urbanf897d6.txt"></script>
<script src="assets/agricultural-1/data_stars_agriculturald54c39.txt"></script>
<script src="assets/semiopen-1/data_stars_semiopenfda2b5.txt"></script>
<script src="assets/forests-1/data_stars_forestsa5c3d2.txt"></script>
<script src="assets/wetlands-1/data_stars_wetlands53bdf1.txt"></script>
<script src="assets/waterbodies-1/data_stars_waterbodiese2db56.txt"></script>
<script src="assets/dist_urban-1/data_stars_dist_urban976de5.txt"></script>
<script src="assets/human_pop-1/data_stars_human_pop10986f.txt"></script>
<script src="assets/kePrint-0.0.1/kePrint.js"></script>
<script src="assets/resid-1/data_stars_stars7bac80.txt"></script>
<link href="assets/jquery-ui-1.10.3/jquery-ui-1.10.3.custom.min.css" rel="stylesheet" />
<script src="assets/jquery-ui-1.10.3/jquery-ui-1.10.3.custom.min.js"></script>
<link href="assets/opacity-1.0.0/Control.Opacity.css" rel="stylesheet" />
<script src="assets/opacity-1.0.0/Control.Opacity.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#abstract"><i class="fa fa-check"></i>Abstract</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-use-this-document"><i class="fa fa-check"></i>How to use this document</a></li>
</ul></li>
<li class="part"><span><b>I Weather radar data</b></span></li>
<li class="chapter" data-level="1" data-path="01.Selecting-take-off-moments.html"><a href="01.Selecting-take-off-moments.html"><i class="fa fa-check"></i><b>1</b> Selecting firework take-off moment</a><ul>
<li class="chapter" data-level="1.1" data-path="01.Selecting-take-off-moments.html"><a href="01.Selecting-take-off-moments.html#setting-up-the-processing-environment"><i class="fa fa-check"></i><b>1.1</b> Setting up the processing environment</a></li>
<li class="chapter" data-level="1.2" data-path="01.Selecting-take-off-moments.html"><a href="01.Selecting-take-off-moments.html#calculate-the-vertical-profiles"><i class="fa fa-check"></i><b>1.2</b> Calculate the vertical profiles</a></li>
<li class="chapter" data-level="1.3" data-path="01.Selecting-take-off-moments.html"><a href="01.Selecting-take-off-moments.html#generate-time-series-of-vertical-profiles"><i class="fa fa-check"></i><b>1.3</b> Generate time series of vertical profiles</a></li>
<li class="chapter" data-level="1.4" data-path="01.Selecting-take-off-moments.html"><a href="01.Selecting-take-off-moments.html#identifying-moment-of-take-off"><i class="fa fa-check"></i><b>1.4</b> Identifying moment of take-off</a></li>
<li class="chapter" data-level="1.5" data-path="01.Selecting-take-off-moments.html"><a href="01.Selecting-take-off-moments.html#determining-maximum-range-from-radar-to-detect-birds"><i class="fa fa-check"></i><b>1.5</b> Determining maximum range from radar to detect birds</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html"><i class="fa fa-check"></i><b>2</b> Radar Data Preprocessing</a><ul>
<li class="chapter" data-level="2.1" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#setting-up-the-pre-processing-environment"><i class="fa fa-check"></i><b>2.1</b> Setting-up the pre-processing environment</a></li>
<li class="chapter" data-level="2.2" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#removing-electromagnetic-interference"><i class="fa fa-check"></i><b>2.2</b> Removing electromagnetic interference</a></li>
<li class="chapter" data-level="2.3" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#filter-meteorology-using-the-depolarization-ratio"><i class="fa fa-check"></i><b>2.3</b> Filter meteorology using the depolarization ratio</a></li>
<li class="chapter" data-level="2.4" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#remove-classified-precipitation-from-polar-volumes"><i class="fa fa-check"></i><b>2.4</b> Remove classified precipitation from polar volumes</a></li>
<li class="chapter" data-level="2.5" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#filter-ground-clutter"><i class="fa fa-check"></i><b>2.5</b> Filter ground clutter</a></li>
<li class="chapter" data-level="2.6" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#range-bias-correction"><i class="fa fa-check"></i><b>2.6</b> Range-bias correction</a></li>
<li class="chapter" data-level="2.7" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#keep-biologymeteorology-classification"><i class="fa fa-check"></i><b>2.7</b> Keep biology/meteorology classification</a></li>
<li class="chapter" data-level="2.8" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#distance-to-radar"><i class="fa fa-check"></i><b>2.8</b> Distance to radar</a></li>
<li class="chapter" data-level="2.9" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#spatial-coordinates"><i class="fa fa-check"></i><b>2.9</b> Spatial coordinates</a></li>
<li class="chapter" data-level="2.10" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#visualising-range-bias-correction"><i class="fa fa-check"></i><b>2.10</b> Visualising range-bias correction</a></li>
<li class="chapter" data-level="2.11" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#preprocess-additional-scans"><i class="fa fa-check"></i><b>2.11</b> Preprocess additional scans</a></li>
</ul></li>
<li class="part"><span><b>II Land use</b></span></li>
<li class="chapter" data-level="3" data-path="03.Annotate-land-use.html"><a href="03.Annotate-land-use.html"><i class="fa fa-check"></i><b>3</b> Annotating land use</a><ul>
<li class="chapter" data-level="3.1" data-path="03.Annotate-land-use.html"><a href="03.Annotate-land-use.html#setting-up-the-annotation-environment"><i class="fa fa-check"></i><b>3.1</b> Setting up the annotation environment</a></li>
<li class="chapter" data-level="3.2" data-path="03.Annotate-land-use.html"><a href="03.Annotate-land-use.html#converting-the-land-use-map"><i class="fa fa-check"></i><b>3.2</b> Converting the land use map</a></li>
<li class="chapter" data-level="3.3" data-path="03.Annotate-land-use.html"><a href="03.Annotate-land-use.html#adding-land-use-classifications-to-the-ppis"><i class="fa fa-check"></i><b>3.3</b> Adding land use classifications to the PPIs</a></li>
<li class="chapter" data-level="3.4" data-path="03.Annotate-land-use.html"><a href="03.Annotate-land-use.html#calculate-distance-to-nearest-urban-area"><i class="fa fa-check"></i><b>3.4</b> Calculate distance to nearest urban area</a></li>
<li class="chapter" data-level="3.5" data-path="03.Annotate-land-use.html"><a href="03.Annotate-land-use.html#add-population-density"><i class="fa fa-check"></i><b>3.5</b> Add population density</a></li>
</ul></li>
<li class="part"><span><b>III Sovon counts</b></span></li>
<li class="chapter" data-level="4" data-path="04.Annotate-count-areas.html"><a href="04.Annotate-count-areas.html"><i class="fa fa-check"></i><b>4</b> Annotating count areas</a><ul>
<li class="chapter" data-level="4.1" data-path="04.Annotate-count-areas.html"><a href="04.Annotate-count-areas.html#setting-up-the-annotation-environment-1"><i class="fa fa-check"></i><b>4.1</b> Setting up the annotation environment</a></li>
<li class="chapter" data-level="4.2" data-path="04.Annotate-count-areas.html"><a href="04.Annotate-count-areas.html#annotate-ppis-with-waterbird-area-codes"><i class="fa fa-check"></i><b>4.2</b> Annotate PPIs with waterbird area codes</a></li>
<li class="chapter" data-level="4.3" data-path="04.Annotate-count-areas.html"><a href="04.Annotate-count-areas.html#annotate-ppis-with-point-transect-counts"><i class="fa fa-check"></i><b>4.3</b> Annotate PPIs with point-transect-counts</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="05.Processing-count-results.html"><a href="05.Processing-count-results.html"><i class="fa fa-check"></i><b>5</b> Processing count results</a><ul>
<li class="chapter" data-level="5.1" data-path="05.Processing-count-results.html"><a href="05.Processing-count-results.html#setting-up-the-processing-environment-1"><i class="fa fa-check"></i><b>5.1</b> Setting up the processing environment</a></li>
<li class="chapter" data-level="5.2" data-path="05.Processing-count-results.html"><a href="05.Processing-count-results.html#loading-the-sovon-count-data"><i class="fa fa-check"></i><b>5.2</b> Loading the Sovon count data</a></li>
<li class="chapter" data-level="5.3" data-path="05.Processing-count-results.html"><a href="05.Processing-count-results.html#filteringpreprocessing-species-names"><i class="fa fa-check"></i><b>5.3</b> Filtering/preprocessing species names</a></li>
<li class="chapter" data-level="5.4" data-path="05.Processing-count-results.html"><a href="05.Processing-count-results.html#linking-life-history-traits-to-species"><i class="fa fa-check"></i><b>5.4</b> Linking life-history traits to species</a></li>
<li class="chapter" data-level="5.5" data-path="05.Processing-count-results.html"><a href="05.Processing-count-results.html#calculating-total-bird-biomass"><i class="fa fa-check"></i><b>5.5</b> Calculating total bird biomass</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="06.Applying-annotations-to-all-PPIs.html"><a href="06.Applying-annotations-to-all-PPIs.html"><i class="fa fa-check"></i><b>6</b> Apply processing to all PPIs</a><ul>
<li class="chapter" data-level="6.1" data-path="06.Applying-annotations-to-all-PPIs.html"><a href="06.Applying-annotations-to-all-PPIs.html#setting-up-the-environment"><i class="fa fa-check"></i><b>6.1</b> Setting-up the environment</a></li>
<li class="chapter" data-level="6.2" data-path="06.Applying-annotations-to-all-PPIs.html"><a href="06.Applying-annotations-to-all-PPIs.html#load-the-reference-ppis"><i class="fa fa-check"></i><b>6.2</b> Load the reference PPIs</a></li>
<li class="chapter" data-level="6.3" data-path="06.Applying-annotations-to-all-PPIs.html"><a href="06.Applying-annotations-to-all-PPIs.html#add-biomass-to-reference-ppis"><i class="fa fa-check"></i><b>6.3</b> Add biomass to reference PPIs</a></li>
<li class="chapter" data-level="6.4" data-path="06.Applying-annotations-to-all-PPIs.html"><a href="06.Applying-annotations-to-all-PPIs.html#copy-annotations-from-reference-ppis-to-other-ppis"><i class="fa fa-check"></i><b>6.4</b> Copy annotations from reference PPIs to other PPIs</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="07.Composite-all-PPIs.html"><a href="07.Composite-all-PPIs.html"><i class="fa fa-check"></i><b>7</b> Composite all PPIs</a><ul>
<li class="chapter" data-level="7.1" data-path="07.Composite-all-PPIs.html"><a href="07.Composite-all-PPIs.html#setting-up-the-environment-1"><i class="fa fa-check"></i><b>7.1</b> Setting-up the environment</a></li>
<li class="chapter" data-level="7.2" data-path="07.Composite-all-PPIs.html"><a href="07.Composite-all-PPIs.html#generating-the-composite-ppis"><i class="fa fa-check"></i><b>7.2</b> Generating the composite PPIs</a></li>
<li class="chapter" data-level="7.3" data-path="07.Composite-all-PPIs.html"><a href="07.Composite-all-PPIs.html#visualising-the-composites"><i class="fa fa-check"></i><b>7.3</b> Visualising the composites</a></li>
</ul></li>
<li class="part"><span><b>IV Fireworks disturbance</b></span></li>
<li class="chapter" data-level="8" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html"><i class="fa fa-check"></i><b>8</b> Modelling fireworks disturbance</a><ul>
<li class="chapter" data-level="8.1" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#setting-up-the-environment-2"><i class="fa fa-check"></i><b>8.1</b> Setting-up the environment</a></li>
<li class="chapter" data-level="8.2" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#preparing-a-dataset-for-modelling"><i class="fa fa-check"></i><b>8.2</b> Preparing a dataset for modelling</a></li>
<li class="chapter" data-level="8.3" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#determine-model-resolution-based-on-performance-in-simple-total_biomass-model"><i class="fa fa-check"></i><b>8.3</b> Determine model resolution based on performance in simple <code>total_biomass</code> model</a></li>
<li class="chapter" data-level="8.4" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#check-for-correlations-among-predictors"><i class="fa fa-check"></i><b>8.4</b> Check for correlations among predictors</a></li>
<li class="chapter" data-level="8.5" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#correlated-land-use-proportions"><i class="fa fa-check"></i><b>8.5</b> Correlated land use proportions</a></li>
<li class="chapter" data-level="8.6" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#determine-the-most-suitable-proxy-for-disturbance"><i class="fa fa-check"></i><b>8.6</b> Determine the most suitable proxy for disturbance</a></li>
<li class="chapter" data-level="8.7" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#determine-best-hyperparameter-settings-for-lr"><i class="fa fa-check"></i><b>8.7</b> Determine best hyperparameter settings for <code>lr</code></a></li>
<li class="chapter" data-level="8.8" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#retraining-the-disturbance-models-using-optimised-learning-rate-and-maximum-number-of-trees"><i class="fa fa-check"></i><b>8.8</b> Retraining the disturbance models using optimised learning rate and maximum number of trees</a></li>
<li class="chapter" data-level="8.9" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#relative-influence-of-variables"><i class="fa fa-check"></i><b>8.9</b> Relative influence of variables</a></li>
<li class="chapter" data-level="8.10" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#models-for-seperate-land-uses"><i class="fa fa-check"></i><b>8.10</b> Models for seperate land uses</a></li>
<li class="chapter" data-level="8.11" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#partial-dependence"><i class="fa fa-check"></i><b>8.11</b> Partial dependence</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="09.Quantifying-model-uncertainty.html"><a href="09.Quantifying-model-uncertainty.html"><i class="fa fa-check"></i><b>9</b> Quantifying model uncertainty</a><ul>
<li class="chapter" data-level="9.1" data-path="09.Quantifying-model-uncertainty.html"><a href="09.Quantifying-model-uncertainty.html#setting-up-the-environment-3"><i class="fa fa-check"></i><b>9.1</b> Setting-up the environment</a></li>
<li class="chapter" data-level="9.2" data-path="09.Quantifying-model-uncertainty.html"><a href="09.Quantifying-model-uncertainty.html#load-the-constructed-models"><i class="fa fa-check"></i><b>9.2</b> Load the constructed models</a></li>
<li class="chapter" data-level="9.3" data-path="09.Quantifying-model-uncertainty.html"><a href="09.Quantifying-model-uncertainty.html#determine-evaluation-grid"><i class="fa fa-check"></i><b>9.3</b> Determine evaluation grid</a></li>
<li class="chapter" data-level="9.4" data-path="09.Quantifying-model-uncertainty.html"><a href="09.Quantifying-model-uncertainty.html#bootstrapped-retraining-of-gbm-models"><i class="fa fa-check"></i><b>9.4</b> Bootstrapped retraining of <code>gbm</code> models</a></li>
<li class="chapter" data-level="9.5" data-path="09.Quantifying-model-uncertainty.html"><a href="09.Quantifying-model-uncertainty.html#plot-bootstrapped-uncertainties"><i class="fa fa-check"></i><b>9.5</b> Plot bootstrapped uncertainties</a></li>
<li class="chapter" data-level="9.6" data-path="09.Quantifying-model-uncertainty.html"><a href="09.Quantifying-model-uncertainty.html#show-model-residuals"><i class="fa fa-check"></i><b>9.6</b> Show model residuals</a></li>
<li class="chapter" data-level="9.7" data-path="09.Quantifying-model-uncertainty.html"><a href="09.Quantifying-model-uncertainty.html#leaflet-alternative"><i class="fa fa-check"></i><b>9.7</b> Leaflet alternative</a></li>
</ul></li>
<li class="part"><span><b>V Appendix</b></span></li>
<li class="chapter" data-level="10" data-path="A1.Generating-VPs-for-Den-Helder-radar.html"><a href="A1.Generating-VPs-for-Den-Helder-radar.html"><i class="fa fa-check"></i><b>10</b> Generating vertical profiles for Den Helder radar</a></li>
<li class="part"><span><b>VI Other</b></span></li>
<li class="chapter" data-level="11" data-path="References.html"><a href="References.html"><i class="fa fa-check"></i><b>11</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Fireworks</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="modelling-fireworks-disturbance" class="section level1">
<h1><span class="header-section-number">8</span> Modelling fireworks disturbance</h1>
<p>We have so far:</p>
<ol style="list-style-type: decimal">
<li>Pre-processed the radar data by removing clutter and applying the range-bias correction <span class="citation">(Kranstauber et al. <a href="#ref-kranstauber2020">2020</a>)</span>.</li>
<li>Annotated the PPIs with land use proportions and indicators of disturbance, i.e. distance to inhabited urban areas and (human) population density.</li>
<li>Annotated the PPIs with the total biomass calculated from the Sovon counts.</li>
</ol>
<p>With the dataset of annotated PPIs, we can start to explore the relation between fireworks disturbance and the birds measured aloft during NYE 2017-2018.</p>
<p>The following parameters we assume are important predictors for measured bird densities aloft:</p>
<ol style="list-style-type: decimal">
<li>The total biomass of birds on the ground.</li>
<li>The take-off habitat of these birds.</li>
<li>The human population in the vicinity of birds.</li>
<li>The distance to the nearest inhabited urban area.</li>
</ol>
<div id="setting-up-the-environment-2" class="section level2">
<h2><span class="header-section-number">8.1</span> Setting-up the environment</h2>
<p>Load the required packages.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" data-line-number="1"><span class="kw">library</span>(ggstatsplot)</a>
<a class="sourceLine" id="cb145-2" data-line-number="2"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb145-3" data-line-number="3"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb145-4" data-line-number="4"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb145-5" data-line-number="5"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb145-6" data-line-number="6"><span class="kw">library</span>(gbm)</a>
<a class="sourceLine" id="cb145-7" data-line-number="7"><span class="kw">library</span>(dismo)</a>
<a class="sourceLine" id="cb145-8" data-line-number="8"><span class="kw">library</span>(ggBRT)</a>
<a class="sourceLine" id="cb145-9" data-line-number="9"><span class="kw">library</span>(patchwork)</a>
<a class="sourceLine" id="cb145-10" data-line-number="10"><span class="kw">library</span>(pdp)</a>
<a class="sourceLine" id="cb145-11" data-line-number="11"><span class="kw">library</span>(parallel)</a>
<a class="sourceLine" id="cb145-12" data-line-number="12"><span class="kw">library</span>(ggridges)</a>
<a class="sourceLine" id="cb145-13" data-line-number="13">cpucores &lt;-<span class="st"> </span><span class="dv">6</span></a></code></pre></div>
<p>In the previous chapter, we have created some datasets encompassing all the data contained within the individual PPIs at different resolutions. We will determine the optimal resolution and then continue using this dataset for further modelling.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" data-line-number="1">resolutions &lt;-<span class="st"> </span><span class="kw">file.path</span>(<span class="st">&quot;data/processed&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;all_500m.RDS&quot;</span>, <span class="st">&quot;all_1000m.RDS&quot;</span>, <span class="st">&quot;all_2000m.RDS&quot;</span>))</a>
<a class="sourceLine" id="cb146-2" data-line-number="2">data &lt;-<span class="st"> </span><span class="kw">lapply</span>(resolutions, <span class="cf">function</span>(x) <span class="kw">readRDS</span>(x))</a>
<a class="sourceLine" id="cb146-3" data-line-number="3"><span class="kw">names</span>(data) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;500m&quot;</span>, <span class="st">&quot;1000m&quot;</span>, <span class="st">&quot;2000m&quot;</span>)</a></code></pre></div>
</div>
<div id="preparing-a-dataset-for-modelling" class="section level2">
<h2><span class="header-section-number">8.2</span> Preparing a dataset for modelling</h2>
<p>As we’re mostly interested in the moment of en masse take-off of birds, and we want to limit the effects of dispersal, we will limit our analysis to the first 5 minutes after 00:05 on January 1st, 2018 (or 23:05 on December 31st, 2017 in UTC), as both radar sites (Den Helder and Herwijnen) show a low <code>VIR</code> prior to and a rapid increase in <code>VIR</code> for that period (see <a href="01.Selecting-take-off-moments.html#identifying-moment-of-take-off">Identifying moment of take-off</a>). Making sure birds are thus still sufficiently ‘linked’ to the take-off sites requires that we limit our analysis to only this one scan.</p>
<p>Furthermore, we want to make sure that:
1. the area is ‘covered’ by at least 1 radar,
1. we have an estimate of <code>total_biomass</code>for these sites,
1. the proportion of urban area (<code>urban</code>) in the PPI pixel is less than .25,
1. <code>VIR</code> is &gt; 0 (otherwise log-conversion will return <code>-Inf</code>), so we replace 0-values with 1e-3,
1. the radar beam does not overshoot birds too much based on the <code>vp</code>.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" data-line-number="1">dt_start &lt;-<span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2017-12-31 23:05:00&quot;</span>, <span class="dt">tz =</span> <span class="st">&quot;UTC&quot;</span>)</a>
<a class="sourceLine" id="cb147-2" data-line-number="2">dt_end &lt;-<span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2017-12-31 23:10:00&quot;</span>, <span class="dt">tz =</span> <span class="st">&quot;UTC&quot;</span>)</a>
<a class="sourceLine" id="cb147-3" data-line-number="3"></a>
<a class="sourceLine" id="cb147-4" data-line-number="4">clean_data &lt;-<span class="st"> </span><span class="cf">function</span>(data, scan_start, scan_end, max_distance) {</a>
<a class="sourceLine" id="cb147-5" data-line-number="5">  mdl_variables &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;VIR&quot;</span>, <span class="st">&quot;dist_radar&quot;</span>, <span class="st">&quot;datetime&quot;</span>, <span class="st">&quot;total_biomass&quot;</span>, <span class="st">&quot;urban&quot;</span>, <span class="st">&quot;agricultural&quot;</span>, <span class="st">&quot;semiopen&quot;</span>, <span class="st">&quot;forests&quot;</span>, <span class="st">&quot;wetlands&quot;</span>, <span class="st">&quot;waterbodies&quot;</span>, </a>
<a class="sourceLine" id="cb147-6" data-line-number="6">                     <span class="st">&quot;dist_urban&quot;</span>, <span class="st">&quot;human_pop&quot;</span>, <span class="st">&quot;disturb_pot&quot;</span>, <span class="st">&quot;pixel&quot;</span>, <span class="st">&quot;coverage&quot;</span>, <span class="st">&quot;class&quot;</span>)</a>
<a class="sourceLine" id="cb147-7" data-line-number="7">  log10_variables &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;dist_urban&quot;</span>, <span class="st">&quot;human_pop&quot;</span>, <span class="st">&quot;total_biomass&quot;</span>, <span class="st">&quot;dist_urban&quot;</span>, <span class="st">&quot;disturb_pot&quot;</span>)</a>
<a class="sourceLine" id="cb147-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb147-9" data-line-number="9">  data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb147-10" data-line-number="10"><span class="st">    </span><span class="kw">filter</span>(coverage <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb147-11" data-line-number="11">           class <span class="op">!=</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb147-12" data-line-number="12">           datetime <span class="op">&gt;=</span><span class="st"> </span>scan_start <span class="op">&amp;</span><span class="st"> </span>datetime <span class="op">&lt;</span><span class="st"> </span>scan_end,</a>
<a class="sourceLine" id="cb147-13" data-line-number="13">           total_biomass <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb147-14" data-line-number="14">           dist_radar <span class="op">&lt;</span><span class="st"> </span>max_distance,</a>
<a class="sourceLine" id="cb147-15" data-line-number="15">           urban <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.25</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb147-16" data-line-number="16"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">VIR =</span> <span class="kw">replace_na</span>(VIR, <span class="fl">0.001</span>),</a>
<a class="sourceLine" id="cb147-17" data-line-number="17">           <span class="dt">VIR =</span> <span class="kw">log10</span>(VIR),</a>
<a class="sourceLine" id="cb147-18" data-line-number="18">           <span class="dt">disturb_pot =</span> human_pop <span class="op">/</span><span class="st"> </span>dist_urban,</a>
<a class="sourceLine" id="cb147-19" data-line-number="19">           <span class="dt">total_biomass =</span> total_biomass <span class="op">/</span><span class="st"> </span><span class="dv">1000</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb147-20" data-line-number="20"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="kw">all_of</span>(mdl_variables)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb147-21" data-line-number="21"><span class="st">    </span><span class="kw">filter_all</span>(<span class="kw">all_vars</span>(<span class="kw">is.finite</span>(.))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb147-22" data-line-number="22"><span class="st">    </span><span class="kw">identity</span>() -&gt;<span class="st"> </span>data_cleaned</a>
<a class="sourceLine" id="cb147-23" data-line-number="23">  </a>
<a class="sourceLine" id="cb147-24" data-line-number="24">  data_cleaned</a>
<a class="sourceLine" id="cb147-25" data-line-number="25">}</a>
<a class="sourceLine" id="cb147-26" data-line-number="26"></a>
<a class="sourceLine" id="cb147-27" data-line-number="27">data_cleaned &lt;-<span class="st"> </span><span class="kw">lapply</span>(data, <span class="cf">function</span>(x) <span class="kw">clean_data</span>(x, dt_start, dt_end, <span class="dv">66000</span>))</a>
<a class="sourceLine" id="cb147-28" data-line-number="28"><span class="kw">rm</span>(data)</a></code></pre></div>
</div>
<div id="determine-model-resolution-based-on-performance-in-simple-total_biomass-model" class="section level2">
<h2><span class="header-section-number">8.3</span> Determine model resolution based on performance in simple <code>total_biomass</code> model</h2>
<p>As we want to correct for the influence of <code>total_biomass</code> on the measured response by the radars, we will test the performance of a simple model using just <code>dist_radar</code> to correct for range-biased measurement error and <code>total_biomass</code> for the resolutions we have generated composte PPIs for so far (500m, 1000m and 2000m). The most performant model is then a logical candidate to continue working with. Learning rates are tweaked roughly to force training of the model without 1) hitting a maximum number of trees limit and 2) avoid overfitting.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" data-line-number="1">x_vars &lt;-<span class="st"> </span><span class="kw">match</span>(<span class="kw">c</span>(<span class="st">&quot;dist_radar&quot;</span>, <span class="st">&quot;total_biomass&quot;</span>), <span class="kw">colnames</span>(data_cleaned[[<span class="dv">1</span>]]))</a>
<a class="sourceLine" id="cb148-2" data-line-number="2">resolution_models &lt;-<span class="st"> </span><span class="kw">mcmapply</span>(<span class="cf">function</span>(dataset, lr) <span class="kw">gbm.step</span>(<span class="dt">data =</span> dataset, <span class="dt">gbm.y =</span> <span class="dv">1</span>, <span class="dt">gbm.x =</span> x_vars, <span class="dt">bag.fraction =</span> <span class="fl">0.5</span>, <span class="dt">family =</span> <span class="st">&quot;gaussian&quot;</span>, </a>
<a class="sourceLine" id="cb148-3" data-line-number="3">                                                             <span class="dt">tree.complexity =</span> <span class="dv">2</span>, <span class="dt">learning.rate =</span> lr, <span class="dt">silent =</span> <span class="ot">TRUE</span>, <span class="dt">plot.main =</span> <span class="ot">FALSE</span>),</a>
<a class="sourceLine" id="cb148-4" data-line-number="4">                              <span class="dt">dataset =</span> data_cleaned, <span class="dt">lr =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">0.1</span>, <span class="fl">0.01</span>), <span class="dt">SIMPLIFY =</span> <span class="ot">FALSE</span>, <span class="dt">mc.preschedule =</span> <span class="ot">FALSE</span>, <span class="dt">mc.cores =</span> cpucores)</a></code></pre></div>
<p>With these models trained, we can now compare their performance.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb149-1" data-line-number="1">resolution_perf &lt;-<span class="kw">ggPerformance</span>(<span class="st">&quot;500m&quot;</span> =<span class="st"> </span>resolution_models[[<span class="dv">1</span>]], <span class="st">&quot;1000m&quot;</span> =<span class="st"> </span>resolution_models[[<span class="dv">2</span>]], <span class="st">&quot;2000m&quot;</span> =<span class="st"> </span>resolution_models[[<span class="dv">3</span>]])</a>
<a class="sourceLine" id="cb149-2" data-line-number="2"><span class="kw">rm</span>(resolution_models)</a>
<a class="sourceLine" id="cb149-3" data-line-number="3">resolution_perf</a></code></pre></div>
<div class="kable-table">

<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
500m
</th>
<th style="text-align:right;">
1000m
</th>
<th style="text-align:right;">
2000m
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Total.Deviance
</td>
<td style="text-align:right;">
2.299291e+08
</td>
<td style="text-align:right;">
5.525488e+08
</td>
<td style="text-align:right;">
1.901589e+08
</td>
</tr>
<tr>
<td style="text-align:left;">
Residual.Deviance
</td>
<td style="text-align:right;">
1.984452e+08
</td>
<td style="text-align:right;">
4.549535e+08
</td>
<td style="text-align:right;">
1.848898e+08
</td>
</tr>
<tr>
<td style="text-align:left;">
Correlation
</td>
<td style="text-align:right;">
3.924370e-01
</td>
<td style="text-align:right;">
5.267161e-01
</td>
<td style="text-align:right;">
2.424428e-01
</td>
</tr>
<tr>
<td style="text-align:left;">
AUC
</td>
<td style="text-align:right;">
0.000000e+00
</td>
<td style="text-align:right;">
0.000000e+00
</td>
<td style="text-align:right;">
0.000000e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
Per.Expl
</td>
<td style="text-align:right;">
1.369288e+01
</td>
<td style="text-align:right;">
1.766274e+01
</td>
<td style="text-align:right;">
2.770867e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
cvDeviance
</td>
<td style="text-align:right;">
2.366209e+08
</td>
<td style="text-align:right;">
5.622911e+08
</td>
<td style="text-align:right;">
1.904390e+08
</td>
</tr>
<tr>
<td style="text-align:left;">
cvCorrelation
</td>
<td style="text-align:right;">
1.171754e-01
</td>
<td style="text-align:right;">
9.700350e-02
</td>
<td style="text-align:right;">
8.823790e-02
</td>
</tr>
<tr>
<td style="text-align:left;">
cvAUC
</td>
<td style="text-align:right;">
0.000000e+00
</td>
<td style="text-align:right;">
0.000000e+00
</td>
<td style="text-align:right;">
0.000000e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
cvPer.Expl
</td>
<td style="text-align:right;">
-2.910379e+00
</td>
<td style="text-align:right;">
-1.763173e+00
</td>
<td style="text-align:right;">
-1.472999e-01
</td>
</tr>
</tbody>
</table>
</div>
<p>It is clear that as the resolution increases (in other words: the cellsize decreases) the performance of <code>total_biomass</code> improves substantially, so it makes sense to continue with the 500m resolution data. Additionally, this suggests that dispersion is not really a problematic factor yet, as in that case the performance of a model based on <code>total_biomass</code> should not have been so good using small pixel sizes.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" data-line-number="1">data_cleaned &lt;-<span class="st"> </span>data_cleaned[[<span class="kw">which.max</span>(resolution_perf[<span class="st">&quot;cvPer.Expl&quot;</span>, ])]]</a></code></pre></div>
</div>
<div id="check-for-correlations-among-predictors" class="section level2">
<h2><span class="header-section-number">8.4</span> Check for correlations among predictors</h2>
<p>We have to see if variables are strongly correlated and thus unfit for being included in the same model, so we calculate Spearman correlation coefficients for all numerical predictors. As this is ecological data, some degree of correlation is of course inevitable for most variables.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb151-1" data-line-number="1">mdl_variables &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;VIR&quot;</span>, <span class="st">&quot;dist_radar&quot;</span>, <span class="st">&quot;datetime&quot;</span>, <span class="st">&quot;total_biomass&quot;</span>, <span class="st">&quot;urban&quot;</span>, <span class="st">&quot;agricultural&quot;</span>, <span class="st">&quot;semiopen&quot;</span>, <span class="st">&quot;forests&quot;</span>, <span class="st">&quot;wetlands&quot;</span>, <span class="st">&quot;waterbodies&quot;</span>, </a>
<a class="sourceLine" id="cb151-2" data-line-number="2">                   <span class="st">&quot;dist_urban&quot;</span>, <span class="st">&quot;human_pop&quot;</span>, <span class="st">&quot;disturb_pot&quot;</span>, <span class="st">&quot;pixel&quot;</span>, <span class="st">&quot;coverage&quot;</span>, <span class="st">&quot;class&quot;</span>)</a>
<a class="sourceLine" id="cb151-3" data-line-number="3">predictors &lt;-<span class="st"> </span>mdl_variables[<span class="op">!</span>mdl_variables <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;VIR&quot;</span>, <span class="st">&quot;datetime&quot;</span>, <span class="st">&quot;pixel&quot;</span>, <span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;coverage&quot;</span>, <span class="st">&quot;class&quot;</span>)]</a>
<a class="sourceLine" id="cb151-4" data-line-number="4">corr_radar &lt;-<span class="st"> </span><span class="kw">ggcorrmat</span>(data_cleaned, <span class="dt">output =</span> <span class="st">&quot;plot&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;spearman&quot;</span>, <span class="dt">cor.vars =</span> <span class="kw">all_of</span>(predictors), <span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;#2166AC&quot;</span>, <span class="st">&quot;#F7F7F7&quot;</span>, <span class="st">&quot;#B2182B&quot;</span>))</a>
<a class="sourceLine" id="cb151-5" data-line-number="5">corr_radar</a></code></pre></div>
<p><img src="Fireworks_files/figure-html/check_for_correlations-1.svg" width="960" /></p>
<p>So obviously there is a strong correlation between the different proxies for disturbance and between <code>agricultural</code> and the other land use proportions. For the disturbance proxies it would make sense to determine which is most performant, but for the land use proportions we have to determine if <code>agricultural</code> should be included in the model with these other predictors.</p>
</div>
<div id="correlated-land-use-proportions" class="section level2">
<h2><span class="header-section-number">8.5</span> Correlated land use proportions</h2>
<p>Let’s see what the distributions of values is for the different land use proportions.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb152-1" data-line-number="1">data_cleaned <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb152-2" data-line-number="2"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(urban, agricultural, semiopen, forests, wetlands, waterbodies) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb152-3" data-line-number="3"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> <span class="kw">everything</span>(), <span class="dt">names_to =</span> <span class="st">&quot;landuse&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb152-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> landuse, <span class="dt">fill =</span> <span class="kw">stat</span>(x))) <span class="op">+</span></a>
<a class="sourceLine" id="cb152-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_density_ridges_gradient</span>(<span class="dt">scale =</span> <span class="dv">1</span>, <span class="dt">rel_min_height =</span> <span class="fl">0.0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb152-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">name =</span> <span class="st">&quot;LU Prop.&quot;</span>, <span class="dt">option =</span> <span class="st">&quot;C&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb152-7" data-line-number="7"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Distribution of land use proportions in modelling dataset&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb152-8" data-line-number="8"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Land use proportion&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb152-9" data-line-number="9"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Land use class&quot;</span>)</a></code></pre></div>
<p><img src="Fireworks_files/figure-html/show_correlated_land_use-1.svg" width="672" /></p>
<p>As can be expected in The Netherlands, the dominant land use class is clearly <code>agricultural</code> with the most prominent peak at full PPI pixel coverage (values close to 1) and all other land use classes peaking very strongly at low proportions. This essentially means that when one of the other land use classes increases in proportion, this will almost always come at the cost of the proportion of <code>agricultural</code> and vice versa. So, using all these land use proportions in the model will be uninformative, and will blow up our uncertainty estimates after bootstrapping. Therefore, we will not train a model containing <em>both</em> <code>agricultural</code> and one of the other land use classes.</p>
</div>
<div id="determine-the-most-suitable-proxy-for-disturbance" class="section level2">
<h2><span class="header-section-number">8.6</span> Determine the most suitable proxy for disturbance</h2>
<p>As could be expected, the three ‘disturbance parameters’ (<code>dist_urban</code>, <code>human_pop</code>, <code>disturb_pot</code>) are highly correlated, so we should see which of these is most suitable to include in our model, as it makes no sense to include all. To assess that, we will simply compare the performance of each of the models trained with a single disturbance parameter.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb153-1" data-line-number="1">lr &lt;-<span class="st"> </span><span class="fl">0.05</span></a>
<a class="sourceLine" id="cb153-2" data-line-number="2">max_trees &lt;-<span class="st"> </span><span class="kw">nrow</span>(data_cleaned) <span class="op">*</span><span class="st"> </span><span class="fl">0.25</span></a>
<a class="sourceLine" id="cb153-3" data-line-number="3">silence &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb153-4" data-line-number="4"></a>
<a class="sourceLine" id="cb153-5" data-line-number="5">base_model &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;dist_radar&quot;</span>, <span class="st">&quot;total_biomass&quot;</span>, <span class="st">&quot;urban&quot;</span>, <span class="st">&quot;semiopen&quot;</span>, <span class="st">&quot;forests&quot;</span>, <span class="st">&quot;wetlands&quot;</span>, <span class="st">&quot;waterbodies&quot;</span>)</a>
<a class="sourceLine" id="cb153-6" data-line-number="6">disturbance_proxies &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;dist_urban&quot;</span>, <span class="st">&quot;human_pop&quot;</span>, <span class="st">&quot;disturb_pot&quot;</span>)</a>
<a class="sourceLine" id="cb153-7" data-line-number="7">x_vars &lt;-<span class="st"> </span><span class="kw">lapply</span>(disturbance_proxies, <span class="cf">function</span>(x) <span class="kw">match</span>(<span class="kw">c</span>(base_model,x), <span class="kw">colnames</span>(data_cleaned)))</a>
<a class="sourceLine" id="cb153-8" data-line-number="8"><span class="kw">names</span>(x_vars) &lt;-<span class="st"> </span>disturbance_proxies</a></code></pre></div>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb154-1" data-line-number="1">disturbance_models &lt;-<span class="st"> </span><span class="kw">mclapply</span>(x_vars, <span class="cf">function</span>(x) <span class="kw">gbm.step</span>(<span class="dt">data =</span> data_cleaned, <span class="dt">gbm.y =</span> <span class="dv">1</span>, <span class="dt">gbm.x =</span> x, <span class="dt">bag.fraction =</span> <span class="fl">0.5</span>, <span class="dt">family =</span> <span class="st">&quot;gaussian&quot;</span>, </a>
<a class="sourceLine" id="cb154-2" data-line-number="2">                                                            <span class="dt">tree.complexity =</span> <span class="dv">2</span>, <span class="dt">learning.rate =</span> lr, <span class="dt">silent =</span> silence, <span class="dt">max.trees =</span> max_trees, </a>
<a class="sourceLine" id="cb154-3" data-line-number="3">                                                            <span class="dt">step.size =</span> <span class="dv">50</span>, <span class="dt">plot.main =</span> <span class="ot">FALSE</span>), <span class="dt">mc.cores =</span> cpucores, <span class="dt">mc.preschedule =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb154-4" data-line-number="4"><span class="kw">names</span>(disturbance_models) &lt;-<span class="st"> </span>disturbance_proxies</a>
<a class="sourceLine" id="cb154-5" data-line-number="5"><span class="kw">saveRDS</span>(disturbance_models, <span class="dt">file =</span> <span class="st">&quot;data/models/brt_models_disturbance.RDS&quot;</span>)</a></code></pre></div>
<p>Let’s compare the performance:</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb155-1" data-line-number="1">disturbance_models &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;data/models/brt_models_disturbance.RDS&quot;</span>)</a>
<a class="sourceLine" id="cb155-2" data-line-number="2">disturb_perf &lt;-<span class="st"> </span><span class="kw">ggPerformance</span>(<span class="st">&quot;dist_urban&quot;</span> =<span class="st"> </span>disturbance_models[[<span class="dv">1</span>]], <span class="st">&quot;human_pop&quot;</span> =<span class="st"> </span>disturbance_models[[<span class="dv">2</span>]], <span class="st">&quot;disturb_pot&quot;</span> =<span class="st"> </span>disturbance_models[[<span class="dv">3</span>]])</a>
<a class="sourceLine" id="cb155-3" data-line-number="3">disturb_perf</a></code></pre></div>
<div class="kable-table">

<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
dist_urban
</th>
<th style="text-align:right;">
human_pop
</th>
<th style="text-align:right;">
disturb_pot
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Total.Deviance
</td>
<td style="text-align:right;">
3.3009830
</td>
<td style="text-align:right;">
3.3009830
</td>
<td style="text-align:right;">
3.3009830
</td>
</tr>
<tr>
<td style="text-align:left;">
Residual.Deviance
</td>
<td style="text-align:right;">
0.8799697
</td>
<td style="text-align:right;">
0.8397164
</td>
<td style="text-align:right;">
0.8615670
</td>
</tr>
<tr>
<td style="text-align:left;">
Correlation
</td>
<td style="text-align:right;">
0.8579778
</td>
<td style="text-align:right;">
0.8652355
</td>
<td style="text-align:right;">
0.8616432
</td>
</tr>
<tr>
<td style="text-align:left;">
AUC
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;">
Per.Expl
</td>
<td style="text-align:right;">
73.3421913
</td>
<td style="text-align:right;">
74.5616254
</td>
<td style="text-align:right;">
73.8996853
</td>
</tr>
<tr>
<td style="text-align:left;">
cvDeviance
</td>
<td style="text-align:right;">
1.3237012
</td>
<td style="text-align:right;">
1.3664894
</td>
<td style="text-align:right;">
1.3856431
</td>
</tr>
<tr>
<td style="text-align:left;">
cvCorrelation
</td>
<td style="text-align:right;">
0.7741624
</td>
<td style="text-align:right;">
0.7660149
</td>
<td style="text-align:right;">
0.7623042
</td>
</tr>
<tr>
<td style="text-align:left;">
cvAUC
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;">
cvPer.Expl
</td>
<td style="text-align:right;">
59.8997888
</td>
<td style="text-align:right;">
58.6035604
</td>
<td style="text-align:right;">
58.0233201
</td>
</tr>
</tbody>
</table>
</div>
<p>We have a clear winner here: <code>dist_urban</code> performs the best, so we’ll continue with that proxy for disturbance.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" data-line-number="1">best_disturbance_proxy &lt;-<span class="st"> </span><span class="kw">names</span>(<span class="kw">which.max</span>(disturb_perf[<span class="st">&quot;cvPer.Expl&quot;</span>, ]))</a></code></pre></div>
</div>
<div id="determine-best-hyperparameter-settings-for-lr" class="section level2">
<h2><span class="header-section-number">8.7</span> Determine best hyperparameter settings for <code>lr</code></h2>
<p>To avoid overfitting to noise, we will limit the maximum nr of trees used in the model to 25% of the number of datapoints, which yields a possible 472 trees to be used. We still want to make sure our model reaches some measure of optimality (in this case a reduction of cross-validated deviance explained), we have to do a hyperparameter search for a suitable combination of maximum number of trees and learning rate. See Elith et al. for an explanation on the linkage between number of trees and learning rate.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb157-1" data-line-number="1">learning_rates &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.15</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>)  <span class="co"># Lower and higher learning rates certainly do not converge quick enough or increase error</span></a></code></pre></div>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" data-line-number="1">hyperparms &lt;-<span class="st"> </span><span class="kw">mclapply</span>(learning_rates, <span class="cf">function</span>(x) { <span class="kw">gbm.step</span>(<span class="dt">data =</span> data_cleaned, <span class="dt">gbm.y =</span> <span class="dv">1</span>, <span class="dt">gbm.x =</span> x_vars[[best_disturbance_proxy]], <span class="dt">bag.fraction =</span> <span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb158-2" data-line-number="2">                                                              <span class="dt">family =</span> <span class="st">&quot;gaussian&quot;</span>, <span class="dt">plot.main =</span> <span class="ot">FALSE</span>, <span class="dt">tree.complexity =</span> <span class="dv">2</span>, <span class="dt">learning.rate =</span> x, </a>
<a class="sourceLine" id="cb158-3" data-line-number="3">                                                              <span class="dt">max.trees =</span> max_trees, <span class="dt">step.size =</span> <span class="dv">50</span>, <span class="dt">silent =</span> <span class="ot">TRUE</span>)}, </a>
<a class="sourceLine" id="cb158-4" data-line-number="4">                       <span class="dt">mc.preschedule =</span> <span class="ot">FALSE</span>, <span class="dt">mc.cores =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb158-5" data-line-number="5"><span class="kw">saveRDS</span>(hyperparms, <span class="dt">file =</span> <span class="st">&quot;data/models/brt_models_hyperparms.RDS&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb159-1" data-line-number="1">hyperparms &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="dt">file =</span> <span class="st">&quot;data/models/brt_models_hyperparms.RDS&quot;</span>)</a>
<a class="sourceLine" id="cb159-2" data-line-number="2">max_used_trees &lt;-<span class="st"> </span><span class="kw">max</span>(<span class="kw">unlist</span>(<span class="kw">lapply</span>(hyperparms, <span class="cf">function</span>(x) {<span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(x)) { <span class="kw">max</span>(x<span class="op">$</span>trees.fitted) }})))</a>
<a class="sourceLine" id="cb159-3" data-line-number="3">trees &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">trees =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">50</span>, <span class="dt">to =</span> max_used_trees <span class="op">*</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">by =</span> <span class="dv">50</span>))</a>
<a class="sourceLine" id="cb159-4" data-line-number="4">holdout_deviance &lt;-<span class="st"> </span><span class="kw">lapply</span>(hyperparms, <span class="cf">function</span>(x) { <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(x)) { x<span class="op">$</span>cv.values }} )</a>
<a class="sourceLine" id="cb159-5" data-line-number="5">missing &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">unlist</span>(<span class="kw">lapply</span>(holdout_deviance, is.null)))</a>
<a class="sourceLine" id="cb159-6" data-line-number="6"></a>
<a class="sourceLine" id="cb159-7" data-line-number="7">h &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">data =</span> <span class="ot">NA</span>, <span class="dt">nrow =</span> <span class="kw">dim</span>(trees)[<span class="dv">1</span>], <span class="dt">ncol =</span> <span class="kw">length</span>(holdout_deviance))</a>
<a class="sourceLine" id="cb159-8" data-line-number="8"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(holdout_deviance)) {</a>
<a class="sourceLine" id="cb159-9" data-line-number="9">  h[<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(holdout_deviance[[i]]), i] &lt;-<span class="st"> </span>holdout_deviance[[i]]</a>
<a class="sourceLine" id="cb159-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb159-11" data-line-number="11">h &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(h)</a>
<a class="sourceLine" id="cb159-12" data-line-number="12"></a>
<a class="sourceLine" id="cb159-13" data-line-number="13">hp &lt;-<span class="st"> </span><span class="kw">data.frame</span>(trees, h)</a>
<a class="sourceLine" id="cb159-14" data-line-number="14"><span class="kw">colnames</span>(hp) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">colnames</span>(trees), learning_rates)</a>
<a class="sourceLine" id="cb159-15" data-line-number="15"></a>
<a class="sourceLine" id="cb159-16" data-line-number="16">hp <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb159-17" data-line-number="17"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> <span class="kw">c</span>(<span class="op">-</span>trees), <span class="dt">names_to =</span> <span class="st">&quot;lr&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;holdout_deviance&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb159-18" data-line-number="18"><span class="st">  </span><span class="kw">identity</span>() -&gt;<span class="st"> </span>hp</a>
<a class="sourceLine" id="cb159-19" data-line-number="19"></a>
<a class="sourceLine" id="cb159-20" data-line-number="20"><span class="kw">ggplot</span>(hp) <span class="op">+</span></a>
<a class="sourceLine" id="cb159-21" data-line-number="21"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> trees, <span class="dt">y =</span> holdout_deviance, <span class="dt">color =</span> lr), <span class="dt">size =</span> <span class="dv">1</span>)</a></code></pre></div>
<pre><code>## Warning: Removed 1004 row(s) containing missing values (geom_path).</code></pre>
<p><img src="Fireworks_files/figure-html/compare_hyperparameter_settings-1.svg" width="672" /></p>
<p>It seems a learning rate of 0.3 is a good balance between speedy conversion and model performance. We can now retrain our most performant disturbance model with these new parameters.</p>
</div>
<div id="retraining-the-disturbance-models-using-optimised-learning-rate-and-maximum-number-of-trees" class="section level2">
<h2><span class="header-section-number">8.8</span> Retraining the disturbance models using optimised learning rate and maximum number of trees</h2>
<p>We can now retrain the models with the best combination of learning rate and maximum number of trees.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb161-1" data-line-number="1">lr &lt;-<span class="st"> </span><span class="fl">0.3</span></a>
<a class="sourceLine" id="cb161-2" data-line-number="2">max_trees &lt;-<span class="st"> </span><span class="kw">nrow</span>(data_cleaned) <span class="op">*</span><span class="st"> </span><span class="fl">0.25</span></a>
<a class="sourceLine" id="cb161-3" data-line-number="3">silence &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb161-4" data-line-number="4"></a>
<a class="sourceLine" id="cb161-5" data-line-number="5">disturbance_models &lt;-<span class="st"> </span><span class="kw">mclapply</span>(x_vars, <span class="cf">function</span>(x) <span class="kw">gbm.step</span>(<span class="dt">data =</span> data_cleaned, <span class="dt">gbm.y =</span> <span class="dv">1</span>, <span class="dt">gbm.x =</span> x, <span class="dt">bag.fraction =</span> <span class="fl">0.5</span>, <span class="dt">family =</span> <span class="st">&quot;gaussian&quot;</span>, </a>
<a class="sourceLine" id="cb161-6" data-line-number="6">                                                          <span class="dt">tree.complexity =</span> <span class="dv">2</span>, <span class="dt">learning.rate =</span> lr, <span class="dt">silent =</span> silence, <span class="dt">max.trees =</span> max_trees, <span class="dt">step.size =</span> <span class="dv">50</span>,</a>
<a class="sourceLine" id="cb161-7" data-line-number="7">                                                          <span class="dt">plot.main =</span> <span class="ot">FALSE</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>), <span class="dt">mc.preschedule =</span> <span class="ot">FALSE</span>, <span class="dt">mc.cores =</span> cpucores)</a>
<a class="sourceLine" id="cb161-8" data-line-number="8"><span class="kw">names</span>(disturbance_models) &lt;-<span class="st"> </span>disturbance_proxies</a>
<a class="sourceLine" id="cb161-9" data-line-number="9"><span class="kw">saveRDS</span>(disturbance_models, <span class="dt">file =</span> <span class="st">&quot;data/models/brt_models_disturbance.RDS&quot;</span>)</a></code></pre></div>
<p>And once again we can compare the performance</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" data-line-number="1">disturbance_models &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;data/models/brt_models_disturbance.RDS&quot;</span>)</a>
<a class="sourceLine" id="cb162-2" data-line-number="2"><span class="kw">ggPerformance</span>(<span class="st">&quot;dist_urban&quot;</span> =<span class="st"> </span>disturbance_models[[<span class="dv">1</span>]], <span class="st">&quot;human_pop&quot;</span> =<span class="st"> </span>disturbance_models[[<span class="dv">2</span>]], <span class="st">&quot;disturb_pot&quot;</span> =<span class="st"> </span>disturbance_models[[<span class="dv">3</span>]])</a></code></pre></div>
<div class="kable-table">

<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
dist_urban
</th>
<th style="text-align:right;">
human_pop
</th>
<th style="text-align:right;">
disturb_pot
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Total.Deviance
</td>
<td style="text-align:right;">
3.3009830
</td>
<td style="text-align:right;">
3.3009830
</td>
<td style="text-align:right;">
3.3009830
</td>
</tr>
<tr>
<td style="text-align:left;">
Residual.Deviance
</td>
<td style="text-align:right;">
0.8799697
</td>
<td style="text-align:right;">
0.8397164
</td>
<td style="text-align:right;">
0.8615670
</td>
</tr>
<tr>
<td style="text-align:left;">
Correlation
</td>
<td style="text-align:right;">
0.8579778
</td>
<td style="text-align:right;">
0.8652355
</td>
<td style="text-align:right;">
0.8616432
</td>
</tr>
<tr>
<td style="text-align:left;">
AUC
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;">
Per.Expl
</td>
<td style="text-align:right;">
73.3421913
</td>
<td style="text-align:right;">
74.5616254
</td>
<td style="text-align:right;">
73.8996853
</td>
</tr>
<tr>
<td style="text-align:left;">
cvDeviance
</td>
<td style="text-align:right;">
1.3237012
</td>
<td style="text-align:right;">
1.3664894
</td>
<td style="text-align:right;">
1.3856431
</td>
</tr>
<tr>
<td style="text-align:left;">
cvCorrelation
</td>
<td style="text-align:right;">
0.7741624
</td>
<td style="text-align:right;">
0.7660149
</td>
<td style="text-align:right;">
0.7623042
</td>
</tr>
<tr>
<td style="text-align:left;">
cvAUC
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;">
cvPer.Expl
</td>
<td style="text-align:right;">
59.8997888
</td>
<td style="text-align:right;">
58.6035604
</td>
<td style="text-align:right;">
58.0233201
</td>
</tr>
</tbody>
</table>
</div>
<p>So the model with the disturbance proxy of <code>dist_urban</code> continues to perform best and we’ll save it for future use.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb163-1" data-line-number="1">model_disturbance_best &lt;-<span class="st"> </span>disturbance_models[best_disturbance_proxy]</a>
<a class="sourceLine" id="cb163-2" data-line-number="2"><span class="kw">saveRDS</span>(model_disturbance_best, <span class="dt">file =</span> <span class="st">&quot;data/models/brt_models_disturbance_best.RDS&quot;</span>)</a></code></pre></div>
</div>
<div id="relative-influence-of-variables" class="section level2">
<h2><span class="header-section-number">8.9</span> Relative influence of variables</h2>
<p>We can now also compare the relative influence of the variables used in this model.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" data-line-number="1">relinf &lt;-<span class="st"> </span><span class="kw">ggInfluence</span>(disturbance_models<span class="op">$</span>dist_urban, <span class="dt">show.signif =</span> <span class="ot">FALSE</span>, <span class="dt">main =</span> <span class="st">&quot;Relative influence of predictor variables on log(VIR)&quot;</span>)</a></code></pre></div>
<p><img src="Fireworks_files/figure-html/determine_relatieve_influence_of_predictors-1.svg" width="672" /></p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb165-1" data-line-number="1">relinf</a></code></pre></div>
<div class="kable-table">

<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
rel.inf
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
dist_radar
</td>
<td style="text-align:right;">
37.281624
</td>
</tr>
<tr>
<td style="text-align:left;">
total_biomass
</td>
<td style="text-align:right;">
23.891639
</td>
</tr>
<tr>
<td style="text-align:left;">
dist_urban
</td>
<td style="text-align:right;">
10.926148
</td>
</tr>
<tr>
<td style="text-align:left;">
forests
</td>
<td style="text-align:right;">
7.512595
</td>
</tr>
<tr>
<td style="text-align:left;">
waterbodies
</td>
<td style="text-align:right;">
7.397746
</td>
</tr>
<tr>
<td style="text-align:left;">
urban
</td>
<td style="text-align:right;">
6.188727
</td>
</tr>
<tr>
<td style="text-align:left;">
semiopen
</td>
<td style="text-align:right;">
4.672409
</td>
</tr>
<tr>
<td style="text-align:left;">
wetlands
</td>
<td style="text-align:right;">
2.129112
</td>
</tr>
</tbody>
</table>
</div>
<p>The high relative importance of <code>total_biomass</code> (23.9%) suggests a clear link between birds counted on the ground (by Sovon’s observers) and what is measured aloft, exactly what one would expect if birds are still sufficiently ‘tied’ to their take-off habitat.</p>
</div>
<div id="models-for-seperate-land-uses" class="section level2">
<h2><span class="header-section-number">8.10</span> Models for seperate land uses</h2>
<p>As the land use proportions are correlated, and <code>agricultural</code> land use is by far the most common in The Netherlands, it may be a worthwhile exercise to model the effects of each land use proportion seperately. This way, we may discover effects that disappear because of the compound effects of correlation among the other predictors.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb166-1" data-line-number="1">lr &lt;-<span class="st"> </span><span class="fl">0.3</span></a>
<a class="sourceLine" id="cb166-2" data-line-number="2">silence &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb166-3" data-line-number="3"></a>
<a class="sourceLine" id="cb166-4" data-line-number="4">base_model &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;dist_radar&quot;</span>, <span class="st">&quot;total_biomass&quot;</span>, best_disturbance_proxy)</a>
<a class="sourceLine" id="cb166-5" data-line-number="5">landscapes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;urban&quot;</span>, <span class="st">&quot;agricultural&quot;</span>, <span class="st">&quot;semiopen&quot;</span>, <span class="st">&quot;forests&quot;</span>, <span class="st">&quot;wetlands&quot;</span>, <span class="st">&quot;waterbodies&quot;</span>)</a>
<a class="sourceLine" id="cb166-6" data-line-number="6">x_vars &lt;-<span class="st"> </span><span class="kw">lapply</span>(landscapes, <span class="cf">function</span>(x) <span class="kw">match</span>(<span class="kw">c</span>(base_model,x), <span class="kw">colnames</span>(data_cleaned)))</a>
<a class="sourceLine" id="cb166-7" data-line-number="7"></a>
<a class="sourceLine" id="cb166-8" data-line-number="8">landscape_models &lt;-<span class="st"> </span><span class="kw">mclapply</span>(x_vars, <span class="cf">function</span>(x) <span class="kw">gbm.step</span>(<span class="dt">data =</span> data_cleaned, <span class="dt">gbm.y =</span> <span class="dv">1</span>, <span class="dt">gbm.x =</span> x, <span class="dt">bag.fraction =</span> <span class="fl">0.5</span>, <span class="dt">family =</span> <span class="st">&quot;gaussian&quot;</span>, </a>
<a class="sourceLine" id="cb166-9" data-line-number="9">                                                          <span class="dt">tree.complexity =</span> <span class="dv">2</span>, <span class="dt">learning.rate =</span> lr, <span class="dt">silent =</span> silence, <span class="dt">max.trees =</span> max_trees, <span class="dt">plot.main =</span> <span class="ot">FALSE</span>),</a>
<a class="sourceLine" id="cb166-10" data-line-number="10">                             <span class="dt">mc.preschedule =</span> <span class="ot">FALSE</span>, <span class="dt">mc.cores =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb166-11" data-line-number="11"><span class="kw">names</span>(landscape_models) &lt;-<span class="st"> </span><span class="kw">c</span>(landscapes)</a>
<a class="sourceLine" id="cb166-12" data-line-number="12"><span class="kw">saveRDS</span>(landscape_models, <span class="dt">file =</span> <span class="st">&quot;data/models/brt_models_landscapes.RDS&quot;</span>)</a></code></pre></div>
<p>And once again we compare the performance</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb167-1" data-line-number="1">landscape_models &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;data/models/brt_models_landscapes.RDS&quot;</span>)</a>
<a class="sourceLine" id="cb167-2" data-line-number="2"><span class="kw">ggPerformance</span>(<span class="st">&quot;urban&quot;</span> =<span class="st"> </span>landscape_models[[<span class="dv">1</span>]], <span class="st">&quot;agricultural&quot;</span> =<span class="st"> </span>landscape_models[[<span class="dv">2</span>]], <span class="st">&quot;semiopen&quot;</span> =<span class="st"> </span>landscape_models[[<span class="dv">3</span>]], <span class="st">&quot;forests&quot;</span> =<span class="st"> </span>landscape_models[[<span class="dv">4</span>]], </a>
<a class="sourceLine" id="cb167-3" data-line-number="3">              <span class="st">&quot;wetlands&quot;</span> =<span class="st"> </span>landscape_models[[<span class="dv">5</span>]], <span class="st">&quot;waterbodies&quot;</span> =<span class="st"> </span>landscape_models[[<span class="dv">6</span>]])</a></code></pre></div>
<div class="kable-table">

<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
urban
</th>
<th style="text-align:right;">
agricultural
</th>
<th style="text-align:right;">
semiopen
</th>
<th style="text-align:right;">
forests
</th>
<th style="text-align:right;">
wetlands
</th>
<th style="text-align:right;">
waterbodies
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Total.Deviance
</td>
<td style="text-align:right;">
3.3009830
</td>
<td style="text-align:right;">
3.3009830
</td>
<td style="text-align:right;">
3.3009830
</td>
<td style="text-align:right;">
3.3009830
</td>
<td style="text-align:right;">
3.3009830
</td>
<td style="text-align:right;">
3.3009830
</td>
</tr>
<tr>
<td style="text-align:left;">
Residual.Deviance
</td>
<td style="text-align:right;">
0.9398659
</td>
<td style="text-align:right;">
0.9156381
</td>
<td style="text-align:right;">
0.9476384
</td>
<td style="text-align:right;">
0.9485355
</td>
<td style="text-align:right;">
0.9715621
</td>
<td style="text-align:right;">
0.9403277
</td>
</tr>
<tr>
<td style="text-align:left;">
Correlation
</td>
<td style="text-align:right;">
0.8475936
</td>
<td style="text-align:right;">
0.8514734
</td>
<td style="text-align:right;">
0.8457678
</td>
<td style="text-align:right;">
0.8462161
</td>
<td style="text-align:right;">
0.8416190
</td>
<td style="text-align:right;">
0.8471955
</td>
</tr>
<tr>
<td style="text-align:left;">
AUC
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;">
Per.Expl
</td>
<td style="text-align:right;">
71.5276976
</td>
<td style="text-align:right;">
72.2616530
</td>
<td style="text-align:right;">
71.2922361
</td>
<td style="text-align:right;">
71.2650584
</td>
<td style="text-align:right;">
70.5674913
</td>
<td style="text-align:right;">
71.5137062
</td>
</tr>
<tr>
<td style="text-align:left;">
cvDeviance
</td>
<td style="text-align:right;">
1.3719790
</td>
<td style="text-align:right;">
1.3070784
</td>
<td style="text-align:right;">
1.3213059
</td>
<td style="text-align:right;">
1.3510535
</td>
<td style="text-align:right;">
1.3368846
</td>
<td style="text-align:right;">
1.3466620
</td>
</tr>
<tr>
<td style="text-align:left;">
cvCorrelation
</td>
<td style="text-align:right;">
0.7645865
</td>
<td style="text-align:right;">
0.7772946
</td>
<td style="text-align:right;">
0.7744176
</td>
<td style="text-align:right;">
0.7684092
</td>
<td style="text-align:right;">
0.7713873
</td>
<td style="text-align:right;">
0.7693182
</td>
</tr>
<tr>
<td style="text-align:left;">
cvAUC
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;">
cvPer.Expl
</td>
<td style="text-align:right;">
58.4372588
</td>
<td style="text-align:right;">
60.4033582
</td>
<td style="text-align:right;">
59.9723497
</td>
<td style="text-align:right;">
59.0711774
</td>
<td style="text-align:right;">
59.5004107
</td>
<td style="text-align:right;">
59.2042124
</td>
</tr>
</tbody>
</table>
</div>
<p>With these models trained as well, we will save the final set of models.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb168-1" data-line-number="1">models &lt;-<span class="st"> </span><span class="kw">c</span>(disturbance_models, landscape_models)</a>
<a class="sourceLine" id="cb168-2" data-line-number="2"><span class="kw">saveRDS</span>(models, <span class="dt">file =</span> <span class="st">&quot;data/models/brt_models.RDS&quot;</span>)</a></code></pre></div>
</div>
<div id="partial-dependence" class="section level2">
<h2><span class="header-section-number">8.11</span> Partial dependence</h2>
<p>Partial dependence plots (PDP) can visualise the modelled marginal effect a feature has on the predicted output of a model. For exploratory purposes, we will create a quick visualisation of the PDPs for the trained model, before we start with a bootstrapping procedure to test the robustness of these results.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb169-1" data-line-number="1">plot_pdp &lt;-<span class="st"> </span><span class="cf">function</span>(model, predictor) {</a>
<a class="sourceLine" id="cb169-2" data-line-number="2">  p &lt;-<span class="st"> </span><span class="kw">partial</span>(model, <span class="dt">train =</span> model<span class="op">$</span>gbm.call<span class="op">$</span>dataframe, <span class="dt">pred.var =</span> predictor, <span class="dt">type =</span> <span class="st">&quot;regression&quot;</span>, <span class="dt">plot =</span> <span class="ot">TRUE</span>, <span class="dt">plot.engine =</span><span class="st">&quot;ggplot2&quot;</span>,</a>
<a class="sourceLine" id="cb169-3" data-line-number="3">               <span class="dt">smooth =</span> <span class="ot">TRUE</span>, <span class="dt">rug =</span> <span class="ot">TRUE</span>, <span class="dt">n.trees =</span> model<span class="op">$</span>n.trees)</a>
<a class="sourceLine" id="cb169-4" data-line-number="4">  p</a>
<a class="sourceLine" id="cb169-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb169-6" data-line-number="6">modelnames &lt;-<span class="st"> </span><span class="kw">names</span>(models)</a>
<a class="sourceLine" id="cb169-7" data-line-number="7">i &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb169-8" data-line-number="8"></a>
<a class="sourceLine" id="cb169-9" data-line-number="9"><span class="cf">for</span> (model <span class="cf">in</span> models) {</a>
<a class="sourceLine" id="cb169-10" data-line-number="10">  relinf &lt;-<span class="st"> </span><span class="kw">ggInfluence</span>(model, <span class="dt">plot =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb169-11" data-line-number="11">  plots &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">rownames</span>(relinf), <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb169-12" data-line-number="12">    <span class="kw">plot_pdp</span>(<span class="dt">model =</span> model, <span class="dt">predictor =</span> x) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb169-13" data-line-number="13"><span class="st">      </span><span class="kw">xlab</span>(<span class="kw">paste</span>(x, <span class="st">&quot; (&quot;</span>, <span class="kw">round</span>(relinf[x, <span class="dv">1</span>]), <span class="st">&quot;%)&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb169-14" data-line-number="14"><span class="st">      </span><span class="kw">ylab</span>(<span class="st">&quot;log(VIR)&quot;</span>)</a>
<a class="sourceLine" id="cb169-15" data-line-number="15">    })</a>
<a class="sourceLine" id="cb169-16" data-line-number="16">  <span class="kw">print</span>(<span class="kw">wrap_plots</span>(plots) <span class="op">+</span><span class="st"> </span><span class="kw">plot_annotation</span>(<span class="dt">title =</span> modelnames[i]))</a>
<a class="sourceLine" id="cb169-17" data-line-number="17">  i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb169-18" data-line-number="18">}</a></code></pre></div>
<p><img src="Fireworks_files/figure-html/visualise_partial_dependencies-1.svg" width="672" /><img src="Fireworks_files/figure-html/visualise_partial_dependencies-2.svg" width="672" /><img src="Fireworks_files/figure-html/visualise_partial_dependencies-3.svg" width="672" /><img src="Fireworks_files/figure-html/visualise_partial_dependencies-4.svg" width="672" /><img src="Fireworks_files/figure-html/visualise_partial_dependencies-5.svg" width="672" /><img src="Fireworks_files/figure-html/visualise_partial_dependencies-6.svg" width="672" /><img src="Fireworks_files/figure-html/visualise_partial_dependencies-7.svg" width="672" /><img src="Fireworks_files/figure-html/visualise_partial_dependencies-8.svg" width="672" /><img src="Fireworks_files/figure-html/visualise_partial_dependencies-9.svg" width="672" /></p>

</div>
</div>
<h3> References</h3>
<div id="refs" class="references">
<div id="ref-kranstauber2020">
<p>Kranstauber, Bart, Willem Bouten, Hidde Leijnse, Berend-Christiaan Wijers, Liesbeth Verlinden, Judy Shamoun-Baranes, and Adriaan M Dokter. 2020. “High-Resolution Spatial Distribution of Bird Movements Estimated from a Weather Radar Network.” <em>Remote Sensing</em> 12 (4). Multidisciplinary Digital Publishing Institute: 635. <a href="https://doi.org/10.3390/rs12040635">https://doi.org/10.3390/rs12040635</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="07.Composite-all-PPIs.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="09.Quantifying-model-uncertainty.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/lunr.js"></script>
<script src="assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/barthoekstra/fireworks/edit/master/08.Model-fireworks-disturbance.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/barthoekstra/fireworks/blob/master/08.Model-fireworks-disturbance.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true,
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
