<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>8 Modelling fireworks disturbance | Fireworks</title>
<meta name="author" content="Bart Hoekstra">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.4.9002/tabs.js"></script><script src="libs/bs3compat-0.2.4.9002/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Fireworks</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li class="book-part">Weather radar data</li>
<li><a class="" href="selecting-firework-take-off-moment.html"><span class="header-section-number">1</span> Selecting firework take-off moment</a></li>
<li><a class="" href="radar-data-preprocessing.html"><span class="header-section-number">2</span> Radar Data Preprocessing</a></li>
<li class="book-part">Land use</li>
<li><a class="" href="annotating-land-use.html"><span class="header-section-number">3</span> Annotating land use</a></li>
<li class="book-part">Sovon counts</li>
<li><a class="" href="annotating-count-areas.html"><span class="header-section-number">4</span> Annotating count areas</a></li>
<li><a class="" href="processing-count-results.html"><span class="header-section-number">5</span> Processing count results</a></li>
<li><a class="" href="apply-processing-to-all-ppis.html"><span class="header-section-number">6</span> Apply processing to all PPIs</a></li>
<li><a class="" href="composite-all-ppis.html"><span class="header-section-number">7</span> Composite all PPIs</a></li>
<li class="book-part">Fireworks disturbance</li>
<li><a class="active" href="modelling-fireworks-disturbance.html"><span class="header-section-number">8</span> Modelling fireworks disturbance</a></li>
<li><a class="" href="quantifying-model-uncertainty.html"><span class="header-section-number">9</span> Quantifying model uncertainty</a></li>
<li class="book-part">Figures</li>
<li><a class="" href="figure-1-data-overview.html"><span class="header-section-number">10</span> Figure 1: Data overview</a></li>
<li><a class="" href="figure-2-model-output.html"><span class="header-section-number">11</span> Figure 2: Model output</a></li>
<li><a class="" href="figure-3-species-composition.html"><span class="header-section-number">12</span> Figure 3: Species composition</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="generating-vps-for-den-helder-radar.html"><span class="header-section-number">13</span> Generating vertical profiles for Den Helder radar</a></li>
<li class="book-part">Other</li>
<li><a class="" href="references.html"><span class="header-section-number">14</span> References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/barthoekstra/fireworks">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="modelling-fireworks-disturbance" class="section level1">
<h1>
<span class="header-section-number">8</span> Modelling fireworks disturbance<a class="anchor" aria-label="anchor" href="#modelling-fireworks-disturbance"><i class="fas fa-link"></i></a>
</h1>
<p>We have so far:</p>
<ol style="list-style-type: decimal">
<li>Pre-processed the radar data by removing clutter and applying the range-bias correction <span class="citation">(Kranstauber et al. <a href="references.html#ref-kranstauber2020" role="doc-biblioref">2020</a>)</span>.</li>
<li>Annotated the PPIs with land use proportions and indicators of disturbance, i.e. distance to inhabited urban areas and (human) population density.</li>
<li>Annotated the PPIs with the total biomass calculated from the Sovon counts.</li>
</ol>
<p>With the dataset of annotated PPIs, we can start to explore the relation between fireworks disturbance and the birds measured aloft during NYE 2017-2018.</p>
<p>The following parameters we assume are important predictors for measured bird densities aloft:</p>
<ol style="list-style-type: decimal">
<li>The total biomass of birds on the ground.</li>
<li>The take-off habitat of these birds.</li>
<li>The human population in the vicinity of birds.</li>
<li>The distance to the nearest inhabited urban area.</li>
</ol>
<div id="processing-environment-7" class="section level2">
<h2>
<span class="header-section-number">8.1</span> Processing environment<a class="anchor" aria-label="anchor" href="#processing-environment-7"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://indrajeetpatil.github.io/ggstatsplot/">ggstatsplot</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://readr.tidyverse.org">readr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/ggridges">ggridges</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://perso.orange.fr/giraudoux">pgirmess</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/boost-R/mboost">mboost</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/">leaflet</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">leaflet.opacity</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/leafem">leafem</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://r-gis.net">usdm</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/mapview">mapview</a></span><span class="op">)</span></code></pre></div>
<p>In the previous chapter, we have created some datasets encompassing all the data contained within the individual PPIs at different resolutions. We will determine the optimal resolution and then continue using this dataset for further modelling.</p>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">resolutions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"data/processed"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"all_500m.RDS"</span>, <span class="st">"all_1000m.RDS"</span>, <span class="st">"all_2000m.RDS"</span><span class="op">)</span><span class="op">)</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">resolutions</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"500m"</span>, <span class="st">"1000m"</span>, <span class="st">"2000m"</span><span class="op">)</span></code></pre></div>
</div>
<div id="preparing-a-dataset-for-modelling" class="section level2">
<h2>
<span class="header-section-number">8.2</span> Preparing a dataset for modelling<a class="anchor" aria-label="anchor" href="#preparing-a-dataset-for-modelling"><i class="fas fa-link"></i></a>
</h2>
<p>As we’re mostly interested in the moment of en masse take-off of birds, and we want to limit the effects of dispersal, we will limit our analysis to the first 5 minutes after 00:05 on January 1st, 2018 (or 23:05 on December 31st, 2017 in UTC), as both radar sites (Den Helder and Herwijnen) show a low <code>VIR</code> prior to and a rapid increase in <code>VIR</code> for that period (see <a href="selecting-firework-take-off-moment.html#identifying-moment-of-take-off">Identifying moment of take-off</a>). Making sure birds are thus still sufficiently ‘linked’ to the take-off sites requires that we limit our analysis to only this one scan.</p>
<p>Furthermore, we want to make sure that:
1. the area is ‘covered’ by at least 1 radar,
1. we have an estimate of <code>total_biomass</code>for these sites,
1. the proportion of urban area (<code>urban</code>) in the PPI pixel is less than .25,
1. <code>VIR</code> is &gt; 0 (otherwise log-conversion will return <code>-Inf</code>), so we replace 0-values with 1e-3,
1. the radar beam does not overshoot birds too much based on the <code>vp</code>.</p>
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="st">"2017-12-31 23:05:00"</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span>
<span class="va">dt_end</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="st">"2017-12-31 23:10:00"</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span>

<span class="va">clean_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">scan_start</span>, <span class="va">scan_end</span>, <span class="va">max_distance</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">mdl_variables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"VIR"</span>, <span class="st">"dist_radar"</span>, <span class="st">"datetime"</span>, <span class="st">"total_biomass"</span>, <span class="st">"agricultural"</span>, <span class="st">"semiopen"</span>, <span class="st">"forests"</span>, <span class="st">"wetlands"</span>, <span class="st">"waterbodies"</span>, <span class="st">"urban"</span>,
                     <span class="st">"dist_urban"</span>, <span class="st">"human_pop"</span>, <span class="st">"disturb_pot"</span>, <span class="st">"pixel"</span>, <span class="st">"coverage"</span>, <span class="st">"class"</span>, <span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>
  <span class="va">log10_variables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dist_urban"</span>, <span class="st">"human_pop"</span>, <span class="st">"total_biomass"</span>, <span class="st">"dist_urban"</span>, <span class="st">"disturb_pot"</span><span class="op">)</span>
  
  <span class="va">data</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">coverage</span> <span class="op">&gt;</span> <span class="fl">0</span>,
           <span class="va">class</span> <span class="op">!=</span> <span class="fl">1</span>,
           <span class="va">datetime</span> <span class="op">&gt;=</span> <span class="va">scan_start</span> <span class="op">&amp;</span> <span class="va">datetime</span> <span class="op">&lt;</span> <span class="va">scan_end</span>,
           <span class="va">total_biomass</span> <span class="op">&gt;</span> <span class="fl">0</span>,
           <span class="va">dist_radar</span> <span class="op">&lt;</span> <span class="va">max_distance</span>, 
           <span class="va">urban</span> <span class="op">&lt;</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>VIR <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="va">VIR</span>, <span class="fl">0.1</span><span class="op">)</span>,
           VIR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">VIR</span><span class="op">)</span>,
           disturb_pot <span class="op">=</span> <span class="va">human_pop</span> <span class="op">/</span> <span class="va">dist_urban</span>,
           total_biomass <span class="op">=</span> <span class="va">total_biomass</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">mdl_variables</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter_all.html">filter_all</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/all_vars.html">all_vars</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html">is.finite</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/base/identity.html">identity</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">data_cleaned</span>
  
  <span class="va">data_cleaned</span>
<span class="op">}</span>

<span class="va">data_cleaned</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">data</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">clean_data</span><span class="op">(</span><span class="va">x</span>, <span class="va">dt_start</span>, <span class="va">dt_end</span>, <span class="fl">66000</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></code></pre></div>
</div>
<div id="determine-model-resolution-based-on-performance-in-simple-total_biomass-model" class="section level2">
<h2>
<span class="header-section-number">8.3</span> Determine model resolution based on performance in simple <code>total_biomass</code> model<a class="anchor" aria-label="anchor" href="#determine-model-resolution-based-on-performance-in-simple-total_biomass-model"><i class="fas fa-link"></i></a>
</h2>
<p>As we want to correct for the influence of <code>total_biomass</code> on the measured response by the radars, we will test the performance of a simple model using just <code>dist_radar</code> to correct for range-biased measurement error and <code>total_biomass</code> for the resolutions we have generated composte PPIs for so far (500m, 1000m and 2000m).</p>
<p>Let’s start with a calculation of the RMSE.</p>
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">resolution_models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/mclapply.html">mcmapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/gamboost.html">mboost</a></span><span class="op">(</span><span class="va">VIR</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">dist_radar</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">total_biomass</span><span class="op">)</span>, 
                                                       data <span class="op">=</span> <span class="va">dataset</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/control.html">boost_control</a></span><span class="op">(</span>mstop <span class="op">=</span> <span class="fl">10000</span>, trace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,
                              dataset <span class="op">=</span> <span class="va">data_cleaned</span>, SIMPLIFY <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">resolution_models</span>, file <span class="op">=</span> <span class="st">"data/models/resolution_models.RDS"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">resolution_models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/models/resolution_models.RDS"</span><span class="op">)</span>
<span class="va">RMSE</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">error</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">error</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">resolution_models</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">RMSE</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##     500m    1000m    2000m 
## 1.209230 1.212941 1.222400</code></pre>
<p>We can also use percentage of <a href="https://doi.org/10.1016/S0304-3800(00)00354-9">deviance explained</a></p>
<div class="sourceCode" id="cb143"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">deviance_explained</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">observed</span>, <span class="va">predicted</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">predicted</span>
  <span class="va">o</span> <span class="op">&lt;-</span> <span class="va">observed</span>
  <span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">observed</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">observed</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Intercept</span>
  <span class="va">total.deviance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">o</span> <span class="op">-</span> <span class="va">i</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">o</span> <span class="op">-</span> <span class="va">i</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">observed</span><span class="op">)</span>  <span class="co"># Deviance from an intercept-only model</span>
  <span class="va">resid.deviance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">o</span> <span class="op">-</span> <span class="va">p</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">o</span> <span class="op">-</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">observed</span><span class="op">)</span>  <span class="co"># Deviance from the fitted model</span>
  <span class="op">(</span><span class="va">total.deviance</span> <span class="op">-</span> <span class="va">resid.deviance</span><span class="op">)</span> <span class="op">/</span> <span class="va">total.deviance</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/mapply.html">mapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">model</span><span class="op">)</span> <span class="op">{</span> <span class="fu">deviance_explained</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">VIR</span>, <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html">predict</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>, data <span class="op">=</span> <span class="va">data_cleaned</span>, model <span class="op">=</span> <span class="va">resolution_models</span><span class="op">)</span></code></pre></div>
<pre><code>##      500m     1000m     2000m 
## 0.2376405 0.2378637 0.2384314</code></pre>
<p>Turns out most models perform quite similarly. However, to make the link between birds and the habitat they take off from as strong as possible, it makes sense to continue just with the 500m model.</p>
<div class="sourceCode" id="cb145"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_cleaned</span> <span class="op">&lt;-</span> <span class="va">data_cleaned</span><span class="op">$</span><span class="va">`500m`</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">data_cleaned</span>, file <span class="op">=</span> <span class="st">"data/models/data_cleaned.RDS"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">resolution_models</span><span class="op">)</span></code></pre></div>
</div>
<div id="check-for-correlations-among-predictors" class="section level2">
<h2>
<span class="header-section-number">8.4</span> Check for correlations among predictors<a class="anchor" aria-label="anchor" href="#check-for-correlations-among-predictors"><i class="fas fa-link"></i></a>
</h2>
<p>We have to see if variables are strongly correlated and thus unfit for being included in the same model, so we calculate Spearman correlation coefficients for all numerical predictors. As this is ecological data, some degree of correlation is of course inevitable for most variables.</p>
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mdl_variables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"VIR"</span>, <span class="st">"dist_radar"</span>, <span class="st">"datetime"</span>, <span class="st">"total_biomass"</span>, <span class="st">"agricultural"</span>, <span class="st">"semiopen"</span>, <span class="st">"forests"</span>, <span class="st">"wetlands"</span>, <span class="st">"waterbodies"</span>, <span class="st">"urban"</span>, 
                   <span class="st">"dist_urban"</span>, <span class="st">"human_pop"</span>, <span class="st">"disturb_pot"</span>, <span class="st">"pixel"</span>, <span class="st">"coverage"</span>, <span class="st">"class"</span><span class="op">)</span>
<span class="va">predictors</span> <span class="op">&lt;-</span> <span class="va">mdl_variables</span><span class="op">[</span><span class="op">!</span><span class="va">mdl_variables</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"VIR"</span>, <span class="st">"datetime"</span>, <span class="st">"pixel"</span>, <span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"coverage"</span>, <span class="st">"class"</span><span class="op">)</span><span class="op">]</span>
<span class="va">corr_radar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://indrajeetpatil.github.io/ggstatsplot/reference/ggcorrmat.html">ggcorrmat</a></span><span class="op">(</span><span class="va">data_cleaned</span>, output <span class="op">=</span> <span class="st">"plot"</span>, type <span class="op">=</span> <span class="st">"spearman"</span>, cor.vars <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">predictors</span><span class="op">)</span>, colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2166AC"</span>, <span class="st">"#F7F7F7"</span>, <span class="st">"#B2182B"</span><span class="op">)</span><span class="op">)</span>
<span class="va">corr_radar</span></code></pre></div>
<div class="inline-figure"><img src="08.Model-fireworks-disturbance_files/figure-html/check_for_correlations-1.png" width="100%"></div>
<p>So obviously there is correlation between the disturbance proxies and between <code>agricultural</code> and other land use proportions. For the disturbance proxies it would make sense to determine which is most performant (including all does not make sense), but we can continue using the <code>agricultural</code> predictor as boosted models do not suffer from multicollinearity problems like traditional (e.g.) GAMs.</p>
</div>
<div id="correlated-land-use-proportions" class="section level2">
<h2>
<span class="header-section-number">8.5</span> Correlated land use proportions<a class="anchor" aria-label="anchor" href="#correlated-land-use-proportions"><i class="fas fa-link"></i></a>
</h2>
<p>While we’re at it, let’s see what the distributions of values are for the different land use proportions.</p>
<div class="sourceCode" id="cb147"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_cleaned</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">agricultural</span>, <span class="va">semiopen</span>, <span class="va">forests</span>, <span class="va">wetlands</span>, <span class="va">waterbodies</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"landuse"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, y <span class="op">=</span> <span class="va">landuse</span>, fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stat</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/ggridges/reference/geom_ridgeline_gradient.html">geom_density_ridges_gradient</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">1</span>, rel_min_height <span class="op">=</span> <span class="fl">0.0</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"LU Prop."</span>, option <span class="op">=</span> <span class="st">"C"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Distribution of land use proportions in modelling dataset"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Land use proportion"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Land use class"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="08.Model-fireworks-disturbance_files/figure-html/show_correlated_land_use-1.png" width="672"></div>
<p>As can be expected in The Netherlands, the dominant land use class is clearly <code>agricultural</code> with the most prominent peak at full PPI pixel coverage (values close to 1) and all other land use classes peaking very strongly at low proportions. This essentially means that when one of the other land use classes increases in proportion, this will almost always come at the cost of the proportion of <code>agricultural</code> and vice versa.</p>
</div>
<div id="determine-the-most-suitable-proxy-for-disturbance" class="section level2">
<h2>
<span class="header-section-number">8.6</span> Determine the most suitable proxy for disturbance<a class="anchor" aria-label="anchor" href="#determine-the-most-suitable-proxy-for-disturbance"><i class="fas fa-link"></i></a>
</h2>
<p>Now we will compare the disturbance proxies in a similar fashion to how we compared the performance of the model using different PPI resolutions, by calculating deviance explained and RMSE.</p>
<div class="sourceCode" id="cb148"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fm_dist_urban</span> <span class="op">&lt;-</span> <span class="va">VIR</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">dist_radar</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">total_biomass</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">semiopen</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">forests</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">wetlands</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">waterbodies</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">agricultural</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">dist_urban</span><span class="op">)</span>
<span class="va">fm_human_pop</span> <span class="op">&lt;-</span> <span class="va">VIR</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">dist_radar</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">total_biomass</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">semiopen</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">forests</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">wetlands</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">waterbodies</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">agricultural</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">human_pop</span><span class="op">)</span>
<span class="va">fm_disturb_pot</span> <span class="op">&lt;-</span> <span class="va">VIR</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">dist_radar</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">total_biomass</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">semiopen</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">forests</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">wetlands</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">waterbodies</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">agricultural</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/baselearners.html">bbs</a></span><span class="op">(</span><span class="va">disturb_pot</span><span class="op">)</span>
<span class="va">formulas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">fm_dist_urban</span>, <span class="va">fm_human_pop</span>, <span class="va">fm_disturb_pot</span><span class="op">)</span>

<span class="va">disturbance_models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/mclapply.html">mcmapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">formula</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/gamboost.html">mboost</a></span><span class="op">(</span><span class="va">formula</span>, data <span class="op">=</span> <span class="va">data_cleaned</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/control.html">boost_control</a></span><span class="op">(</span>mstop <span class="op">=</span> <span class="fl">10000</span>, trace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>, 
                               formula <span class="op">=</span> <span class="va">formulas</span>, SIMPLIFY <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">disturbance_models</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dist_urban"</span>, <span class="st">"human_pop"</span>, <span class="st">"disturb_pot"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">disturbance_models</span>, file <span class="op">=</span> <span class="st">"data/models/disturbance_models.RDS"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb149"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">disturbance_models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/models/disturbance_models.RDS"</span><span class="op">)</span>
<span class="va">RMSE</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">error</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">error</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">}</span>
<span class="va">rmse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">disturbance_models</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">RMSE</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">d2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html">mapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">model</span><span class="op">)</span> <span class="op">{</span> <span class="fu">deviance_explained</span><span class="op">(</span><span class="va">data_cleaned</span><span class="op">$</span><span class="va">VIR</span>, <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html">predict</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>, model <span class="op">=</span> <span class="va">disturbance_models</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"RMSE"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">rmse</span><span class="op">)</span>, <span class="st">"D2"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">d2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left"></th>
<th align="right">RMSE</th>
<th align="right">D2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">dist_urban</td>
<td align="right">1.110643</td>
<td align="right">0.3568815</td>
</tr>
<tr class="even">
<td align="left">human_pop</td>
<td align="right">1.115877</td>
<td align="right">0.3508063</td>
</tr>
<tr class="odd">
<td align="left">disturb_pot</td>
<td align="right">1.118576</td>
<td align="right">0.3476619</td>
</tr>
</tbody>
</table></div>
</div>
<p>It is clear <code>dist_urban</code> performs the best, though just by a slight margin. As it is probably the most interpretable proxy from a policy perspective, we can continue using it without any regrets.</p>
<div class="sourceCode" id="cb150"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">disturbance_models</span><span class="op">$</span><span class="va">dist_urban</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">model</span>, file <span class="op">=</span> <span class="st">"data/models/model.RDS"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">disturbance_models</span><span class="op">)</span></code></pre></div>
</div>
<div id="determine-the-optimal-number-of-boosting-steps" class="section level2">
<h2>
<span class="header-section-number">8.7</span> Determine the optimal number of boosting steps<a class="anchor" aria-label="anchor" href="#determine-the-optimal-number-of-boosting-steps"><i class="fas fa-link"></i></a>
</h2>
<p>The main hyperparameter to be tuned for the boosted GAMs using <code>mboost</code> is the number of boosting iterations/steps. By stopping boosting before model performance (measured using cross-validation) worsens, we can avoid overfitting. We limit this test of model performance for a maximum of 50,000 boosts.</p>
<div class="sourceCode" id="cb151"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_boosts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/gamboost.html">mboost</a></span><span class="op">(</span><span class="va">fm_dist_urban</span>, data <span class="op">=</span> <span class="va">data_cleaned</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/control.html">boost_control</a></span><span class="op">(</span>mstop <span class="op">=</span> <span class="fl">50000</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">model_boosts</span>, file <span class="op">=</span> <span class="st">"data/models/model_boosts.RDS"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb152"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_boosts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/models/model_boosts.RDS"</span><span class="op">)</span>
<span class="va">cv10f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/cvrisk.html">cv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/model.extract.html">model.weights</a></span><span class="op">(</span><span class="va">model_boosts</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"kfold"</span>, B <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="va">cvm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/cvrisk.html">cvrisk</a></span><span class="op">(</span><span class="va">model_boosts</span>, folds <span class="op">=</span> <span class="va">cv10f</span>, papply <span class="op">=</span> <span class="va">lapply</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">cvm</span>, file <span class="op">=</span> <span class="st">"data/models/cvm_boosts.RDS"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb153"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cvm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/models/cvm_boosts.RDS"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/mboost/man/plot.html">plot</a></span><span class="op">(</span><span class="va">cvm</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="08.Model-fireworks-disturbance_files/figure-html/plot_boosting_steps-1.png" width="672"></div>
<p>We can see that model performance improves very little beyond a few thousand boosting iterations. As we have to quantify model uncertainty using bootstrapping techniques, it makes little computational sense to push much beyond 10000 boosts, as that would just make the bootstrapping procedure last much longer.</p>
</div>
<div id="variable-importance" class="section level2">
<h2>
<span class="header-section-number">8.8</span> Variable importance<a class="anchor" aria-label="anchor" href="#variable-importance"><i class="fas fa-link"></i></a>
</h2>
<p>We can quantify the importance of variables within our model using the <code>varimp</code> function which returns variable importance, a measure of the total improvement to model deviance a variable is responsible for.</p>
<div class="sourceCode" id="cb154"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/mboost/man/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/mboost/man/varimp.html">varimp</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="08.Model-fireworks-disturbance_files/figure-html/variable%20importance-1.png" width="672"></div>
</div>
<div id="model-marginal-effects" class="section level2">
<h2>
<span class="header-section-number">8.9</span> Model marginal effects<a class="anchor" aria-label="anchor" href="#model-marginal-effects"><i class="fas fa-link"></i></a>
</h2>
<p>Let’s quickly visualise marginal effects of this model, showing how individual variables influence model outcome with all other variables held constant.</p>
<div class="sourceCode" id="cb155"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/mboost/man/plot.html">plot</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="08.Model-fireworks-disturbance_files/figure-html/show_marginal_effects-1.png" width="672"></div>
</div>
<div id="spatial-autocorrelation" class="section level2">
<h2>
<span class="header-section-number">8.10</span> Spatial autocorrelation<a class="anchor" aria-label="anchor" href="#spatial-autocorrelation"><i class="fas fa-link"></i></a>
</h2>
<p>Model residuals should not show strong autocorrelation as then the independency of errors assumption is violated (see for example <a href="https://doi.org/10.1186/s41610-019-0118-3">this</a>). Additionally, a model with strong autocorrelation in the residuals suggests that it lacks a spatial component within the predictors. As it is computationally too difficult to calculate the spatial autocorrelation for the entire dataset at once, we subsample 25% of datapoints for these calculations. Results may thus vary to some degree.</p>
<div class="sourceCode" id="cb156"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">data_cleaned</span>
<span class="va">df</span><span class="op">$</span><span class="va">residual</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span>

<span class="va">df</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">dist_radar</span> <span class="op">&lt;</span> <span class="fl">66000</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">df_sample</span>

<span class="va">correlogram</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pgirmess/man/correlog.html">correlog</a></span><span class="op">(</span><span class="va">df_sample</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span>, <span class="va">df_sample</span><span class="op">[</span>, <span class="st">"residual"</span><span class="op">]</span>, method <span class="op">=</span> <span class="st">"Moran"</span>, nbclass <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">correlogram</span> , file <span class="op">=</span> <span class="st">"data/models/correlogram.RDS"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb157"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">correlogram</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/models/correlogram.RDS"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/mboost/man/plot.html">plot</a></span><span class="op">(</span><span class="va">correlogram</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="08.Model-fireworks-disturbance_files/figure-html/plot_model_residual_autocorrelation-1.png" width="672"></div>
<p>This shows there’s some spatial autocorrelation in residuals remaining. We use a plot of residuals to assess where this occurs and if this indicates our model is missing some important spatial effect, or if there is another explanation.</p>
<p><em>Unfortunately, due to <a href="https://github.com/rstudio/bookdown/issues/15#issuecomment-573776659">the way <code>leaflet</code> stores maps it produces</a>, we cannot plot them here using K-M knitting to generate this document. Run these chunks interactively and they should work fine.</em> So, here we’ll have to resort to a static representation of the model residuals.</p>
<div class="sourceCode" id="cb158"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">data_cleaned</span>
<span class="va">df</span><span class="op">$</span><span class="va">residual</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mboost/man/methods.html">predict.mboost</a></span><span class="op">(</span><span class="va">model</span>, newdata <span class="op">=</span> <span class="va">data_cleaned</span><span class="op">)</span>
<span class="va">ppi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/processed/composite-ppis/500m/201712312305.RDS"</span><span class="op">)</span>
 
<span class="va">ppi</span><span class="op">$</span><span class="va">data</span><span class="op">@</span><span class="va">data</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">pixel</span>, <span class="va">preds</span>, <span class="va">residual</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"pixel"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">ppi</span><span class="op">$</span><span class="va">data</span><span class="op">@</span><span class="va">data</span>
<span class="va">ppi</span><span class="op">$</span><span class="va">data</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">VIR_log</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">ppi</span><span class="op">$</span><span class="va">data</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">VIR</span><span class="op">)</span>
<span class="va">ppi</span><span class="op">$</span><span class="va">data</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">total_biomass_log</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">ppi</span><span class="op">$</span><span class="va">data</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">total_biomass</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span>

<span class="va">pal_resid</span> <span class="op">&lt;-</span> <span class="fu">colorspace</span><span class="fu">::</span><span class="fu"><a href="https://colorspace.R-Forge.R-project.org//reference/hcl_palettes.html">diverging_hcl</a></span><span class="op">(</span><span class="fl">50</span>, <span class="st">"Blue-Red 3"</span>, power <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">z_lims_resid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>
<span class="va">palette_resid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/colorNumeric.html">colorNumeric</a></span><span class="op">(</span><span class="va">pal_resid</span>, na.color <span class="op">=</span> <span class="st">"#00000005"</span>, domain <span class="op">=</span> <span class="va">z_lims_resid</span><span class="op">)</span>
<span class="va">raster_resid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html">as</a></span><span class="op">(</span><span class="va">ppi</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="st">"residual"</span><span class="op">]</span>, <span class="st">"RasterLayer"</span><span class="op">)</span>
<span class="va">raster_resid</span><span class="op">[</span><span class="va">raster_resid</span> <span class="op">&lt;=</span> <span class="va">z_lims_resid</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">z_lims_resid</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="va">raster_resid</span><span class="op">[</span><span class="va">raster_resid</span> <span class="op">&gt;=</span> <span class="va">z_lims_resid</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">z_lims_resid</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></code></pre></div>
<div class="sourceCode" id="cb159"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html">leaflet</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html">addTiles</a></span><span class="op">(</span>group <span class="op">=</span> <span class="st">"OSM (default)"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addRasterImage.html">addRasterImage</a></span><span class="op">(</span><span class="va">raster_resid</span>, colors <span class="op">=</span> <span class="va">palette_resid</span>, layerId <span class="op">=</span> <span class="st">"resid"</span>, group <span class="op">=</span> <span class="st">"resid"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/leafem/man/addImageQuery.html">addImageQuery</a></span><span class="op">(</span><span class="va">raster_resid</span>, layerId <span class="op">=</span> <span class="st">"resid"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addLegend.html">addLegend</a></span><span class="op">(</span>pal <span class="op">=</span> <span class="va">palette_resid</span>, values <span class="op">=</span> <span class="va">z_lims_resid</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/leaflet.opacity/man/addOpacitySlider.html">addOpacitySlider</a></span><span class="op">(</span>layerId <span class="op">=</span> <span class="st">"resid"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/identity.html">identity</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb160"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">raster_resid</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_raster</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">residual</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_distiller</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"div"</span>, palette <span class="op">=</span> <span class="st">"RdBu"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_dark</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="08.Model-fireworks-disturbance_files/figure-html/plot_model_residuals_static-1.png" width="672"></div>
<p>The plot shows how residuals become larger as the distance from the radars increases, and this is a more pronounced effect in the domain of the Den Helder radar. This effect is partially a consequence of radar range-bias and using a single <code>distance to radar</code> vs. 2 for each radar separately. You can see how this results in mostly ‘overprediction’ within the Herwijnen radar domain at long distances and ‘underprediction’ of <code>VIR</code> at long distances within the domain of Den Helder.</p>
<p>To illustrate this, we can limit the calculation of residual spatial autocorrelation to datapoints that are substantially closer to the radar. This should then result in Moran’s I values substantially closer to 0.</p>
<div class="sourceCode" id="cb161"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">data_cleaned</span>
<span class="va">df</span><span class="op">$</span><span class="va">residual</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span>

<span class="va">df</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">dist_radar</span> <span class="op">&lt;</span> <span class="fl">50000</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">df_sample</span>

<span class="va">correlogram</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pgirmess/man/correlog.html">correlog</a></span><span class="op">(</span><span class="va">df_sample</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span>, <span class="va">df_sample</span><span class="op">[</span>, <span class="st">"residual"</span><span class="op">]</span>, method <span class="op">=</span> <span class="st">"Moran"</span>, nbclass <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">correlogram</span> , file <span class="op">=</span> <span class="st">"data/models/correlogram_limited_domain.RDS"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb162"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">correlogram</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/models/correlogram_limited_domain.RDS"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/mboost/man/plot.html">plot</a></span><span class="op">(</span><span class="va">correlogram</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="08.Model-fireworks-disturbance_files/figure-html/plot_residual_autocorrelation_limited_domain-1.png" width="672"></div>
<p>As indeed is the case.</p>
<p>To illustrate this even better, we can calculate local Moran’s I values to see where exactly spatial autocorrelation occurs.</p>
<div class="sourceCode" id="cb163"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html">as</a></span><span class="op">(</span><span class="va">ppi</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="st">"residual"</span><span class="op">]</span>, <span class="st">"RasterLayer"</span><span class="op">)</span>
<span class="va">local_sa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/usdm/man/lisa.html">lisa</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">r</span>, d1 <span class="op">=</span> <span class="fl">0</span>, d2 <span class="op">=</span> <span class="fl">1500</span>, statistic <span class="op">=</span> <span class="st">"I"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">local_sa</span>, file <span class="op">=</span> <span class="st">"data/models/local_sa.RDS"</span><span class="op">)</span></code></pre></div>
<p><em>Unfortunately, due to <a href="https://github.com/rstudio/bookdown/issues/15#issuecomment-573776659">the way <code>leaflet</code> stores maps it produces</a>, we cannot plot them here using K-M knitting to generate this document. Run these chunks interactively and they should work fine.</em> So, here we’ll have to resort to a static representation of the local Moran’s I.</p>
<div class="sourceCode" id="cb164"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">local_sa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/models/local_sa.RDS"</span><span class="op">)</span>
<span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">local_sa</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>`local_sa`<span class="op">=</span> <span class="va">`layer`</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_raster</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">local_sa</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>, oob <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org//reference/oob.html">squish</a></span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="08.Model-fireworks-disturbance_files/figure-html/plot_local_moran_i_static-1.png" width="672"></div>
<div class="sourceCode" id="cb165"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># local_sa &lt;- readRDS("data/models/local_sa.RDS")</span>
<span class="co"># Only works interactively: mapview(local_sa)</span></code></pre></div>
<p>We can see - indeed - that spatial autocorrelation in the residuals is strongest at distance from the radar and thankfully does not occur in areas that contain areas of scarce land use types (eg forests). While some degree of spatial autocorrelation in residuals is present, this indicates it does not affect our interpretation of results.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="composite-all-ppis.html"><span class="header-section-number">7</span> Composite all PPIs</a></div>
<div class="next"><a href="quantifying-model-uncertainty.html"><span class="header-section-number">9</span> Quantifying model uncertainty</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#modelling-fireworks-disturbance"><span class="header-section-number">8</span> Modelling fireworks disturbance</a></li>
<li><a class="nav-link" href="#processing-environment-7"><span class="header-section-number">8.1</span> Processing environment</a></li>
<li><a class="nav-link" href="#preparing-a-dataset-for-modelling"><span class="header-section-number">8.2</span> Preparing a dataset for modelling</a></li>
<li><a class="nav-link" href="#determine-model-resolution-based-on-performance-in-simple-total_biomass-model"><span class="header-section-number">8.3</span> Determine model resolution based on performance in simple total_biomass model</a></li>
<li><a class="nav-link" href="#check-for-correlations-among-predictors"><span class="header-section-number">8.4</span> Check for correlations among predictors</a></li>
<li><a class="nav-link" href="#correlated-land-use-proportions"><span class="header-section-number">8.5</span> Correlated land use proportions</a></li>
<li><a class="nav-link" href="#determine-the-most-suitable-proxy-for-disturbance"><span class="header-section-number">8.6</span> Determine the most suitable proxy for disturbance</a></li>
<li><a class="nav-link" href="#determine-the-optimal-number-of-boosting-steps"><span class="header-section-number">8.7</span> Determine the optimal number of boosting steps</a></li>
<li><a class="nav-link" href="#variable-importance"><span class="header-section-number">8.8</span> Variable importance</a></li>
<li><a class="nav-link" href="#model-marginal-effects"><span class="header-section-number">8.9</span> Model marginal effects</a></li>
<li><a class="nav-link" href="#spatial-autocorrelation"><span class="header-section-number">8.10</span> Spatial autocorrelation</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/barthoekstra/fireworks/blob/master/08.Model-fireworks-disturbance.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/barthoekstra/fireworks/edit/master/08.Model-fireworks-disturbance.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Fireworks</strong>" was written by Bart Hoekstra. It was last built on 2021-03-22.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
