<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>3 Annotating land use | Fireworks</title>
<meta name="author" content="Bart Hoekstra">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.4.9002/tabs.js"></script><script src="libs/bs3compat-0.2.4.9002/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Fireworks</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li class="book-part">Weather radar data</li>
<li><a class="" href="selecting-firework-take-off-moment.html"><span class="header-section-number">1</span> Selecting firework take-off moment</a></li>
<li><a class="" href="radar-data-preprocessing.html"><span class="header-section-number">2</span> Radar Data Preprocessing</a></li>
<li class="book-part">Land use</li>
<li><a class="active" href="annotating-land-use.html"><span class="header-section-number">3</span> Annotating land use</a></li>
<li class="book-part">Sovon counts</li>
<li><a class="" href="annotating-count-areas.html"><span class="header-section-number">4</span> Annotating count areas</a></li>
<li><a class="" href="processing-count-results.html"><span class="header-section-number">5</span> Processing count results</a></li>
<li><a class="" href="apply-processing-to-all-ppis.html"><span class="header-section-number">6</span> Apply processing to all PPIs</a></li>
<li><a class="" href="composite-all-ppis.html"><span class="header-section-number">7</span> Composite all PPIs</a></li>
<li class="book-part">Fireworks disturbance</li>
<li><a class="" href="modelling-fireworks-disturbance.html"><span class="header-section-number">8</span> Modelling fireworks disturbance</a></li>
<li><a class="" href="quantifying-model-uncertainty.html"><span class="header-section-number">9</span> Quantifying model uncertainty</a></li>
<li class="book-part">Figures</li>
<li><a class="" href="figure-1-data-overview.html"><span class="header-section-number">10</span> Figure 1: Data overview</a></li>
<li><a class="" href="figure-2-model-output.html"><span class="header-section-number">11</span> Figure 2: Model output</a></li>
<li><a class="" href="figure-3-species-composition.html"><span class="header-section-number">12</span> Figure 3: Species composition</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="generating-vps-for-den-helder-radar.html"><span class="header-section-number">13</span> Generating vertical profiles for Den Helder radar</a></li>
<li class="book-part">Other</li>
<li><a class="" href="references.html"><span class="header-section-number">14</span> References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/barthoekstra/fireworks">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="annotating-land-use" class="section level1">
<h1>
<span class="header-section-number">3</span> Annotating land use<a class="anchor" aria-label="anchor" href="#annotating-land-use"><i class="fas fa-link"></i></a>
</h1>
<p>In this study we aim to quantify the response to fireworks across different bird communities, for which we use take-off habitat as a proxy. In this notebook we will classify land use, and a variety of factors that can serve as a proxy for the severity of fireworks disturbance, such as the distance to the nearest residential area for each of the PPI ‘pixels’.</p>
<p>The land use is based on the <a href="https://land.copernicus.eu/pan-european/corine-land-cover">CORINE Land Cover</a> dataset and specifically the <a href="https://land.copernicus.eu/pan-european/corine-land-cover/clc2018">2018 version</a> (<code>CLC2018</code>), which should be most relevant for the 2017-2018 fireworks event.</p>
<div id="processing-environment-2" class="section level2">
<h2>
<span class="header-section-number">3.1</span> Processing environment<a class="anchor" aria-label="anchor" href="#processing-environment-2"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster">raster</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/">stars</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/">ggpubr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sjmgarnier/viridis">viridis</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/mapview">mapview</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="converting-the-land-use-map" class="section level2">
<h2>
<span class="header-section-number">3.2</span> Converting the land use map<a class="anchor" aria-label="anchor" href="#converting-the-land-use-map"><i class="fas fa-link"></i></a>
</h2>
<p>To start, we need to convert the land use map to the same 1) resolution, and 2) extent of the radar PPIs as we can then simply ‘overlay’ both rasters on top of each other and merge them. We load the PPIs and extract the CRS information contained in the <code>proj4</code> strings.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ppi_hrw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/processed/corrected_ppi_hrw.RDS"</span><span class="op">)</span>
<span class="va">ppi_dhl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/processed/corrected_ppi_dhl.RDS"</span><span class="op">)</span>

<span class="va">ppi_proj4_hrw</span> <span class="op">&lt;-</span> <span class="va">ppi_hrw</span><span class="op">$</span><span class="va">data</span><span class="op">@</span><span class="va">proj4string</span>
<span class="va">ppi_proj4_dhl</span> <span class="op">&lt;-</span> <span class="va">ppi_dhl</span><span class="op">$</span><span class="va">data</span><span class="op">@</span><span class="va">proj4string</span></code></pre></div>
<p>And we load and prepare the land use map it’s all about. To aid the classification process, we also load the legend of land use classes contained in the entire <code>CLC2018</code> dataset, otherwise the classes will remain anonymous numbers.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">landuse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span><span class="op">(</span><span class="st">"data/raw/landuse/clc2018_clc2018_v2018_20_raster100m/CLC2018_CLC2018_V2018_20.tif"</span><span class="op">)</span>
<span class="va">landuse_classes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/raw/landuse/clc2018_clc2018_v2018_20_raster100m/Legend/CLC2018_CLC2018_V2018_20_QGIS.txt"</span>,
                            col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"landuse_id"</span>, <span class="st">"r"</span>, <span class="st">"g"</span>, <span class="st">"b"</span>, <span class="st">"x"</span>, <span class="st">"landuse_class"</span><span class="op">)</span>, header <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"landuse_id"</span>, <span class="st">"landuse_class"</span><span class="op">)</span>,<span class="op">]</span></code></pre></div>
<div id="cropping-the-land-use-map" class="section level3">
<h3>
<span class="header-section-number">3.2.1</span> Cropping the land use map<a class="anchor" aria-label="anchor" href="#cropping-the-land-use-map"><i class="fas fa-link"></i></a>
</h3>
<p>As the <code>CLC2018</code> dataset is so large it does not fit in memory at all in the steps below, so we have to crop the raster dataset for further processing. Even then, it still requires a beefy machine to process these files. First, we calculate a bounding box for the landuse raster based on the bounding boxes of the radar data.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">padding</span> <span class="op">&lt;-</span> <span class="fl">25000</span>  <span class="co"># Padding in m to make sure we crop out of the land use map with a wide margin to compensate for edge-effects later</span>
<span class="va">bbox_meters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">ppi_dhl</span><span class="op">$</span><span class="va">data</span><span class="op">@</span><span class="va">bbox</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">padding</span>  <span class="co"># Assuming the PPI range of DHL and HRW are the same</span>

<span class="va">bbox_hrw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="op">-</span><span class="va">bbox_meters</span>, ymin <span class="op">=</span> <span class="op">-</span><span class="va">bbox_meters</span>, xmax <span class="op">=</span> <span class="va">bbox_meters</span>, ymax <span class="op">=</span> <span class="va">bbox_meters</span><span class="op">)</span>, crs <span class="op">=</span> <span class="va">ppi_proj4_hrw</span><span class="op">)</span>
<span class="va">bbox_dhl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="op">-</span><span class="va">bbox_meters</span>, ymin <span class="op">=</span> <span class="op">-</span><span class="va">bbox_meters</span>, xmax <span class="op">=</span> <span class="va">bbox_meters</span>, ymax <span class="op">=</span> <span class="va">bbox_meters</span><span class="op">)</span>, crs <span class="op">=</span> <span class="va">ppi_proj4_dhl</span><span class="op">)</span>

<span class="va">bbox_hrw</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html">st_as_sfc</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html">crs</a></span><span class="op">(</span><span class="va">landuse</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="va">st_bbox</span> <span class="op">-&gt;</span> <span class="va">bbox_landuse_hrw</span>

<span class="va">bbox_dhl</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html">st_as_sfc</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html">crs</a></span><span class="op">(</span><span class="va">landuse</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="va">st_bbox</span> <span class="op">-&gt;</span> <span class="va">bbox_landuse_dhl</span></code></pre></div>
<p>We can now crop and plot the land use maps centered on the radar sites, with a meter padding surrounding the extent of the radar data.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ext_hrw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">bbox_landuse_hrw</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bbox_landuse_hrw</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bbox_landuse_hrw</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bbox_landuse_hrw</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">ext_dhl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">bbox_landuse_dhl</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bbox_landuse_dhl</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bbox_landuse_dhl</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bbox_landuse_dhl</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>

<span class="va">landuse_crop_hrw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/crop.html">crop</a></span><span class="op">(</span><span class="va">landuse</span>, <span class="va">ext_hrw</span><span class="op">)</span>
<span class="va">landuse_crop_dhl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/crop.html">crop</a></span><span class="op">(</span><span class="va">landuse</span>, <span class="va">ext_dhl</span><span class="op">)</span>

<span class="va">sea_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/match.html">match</a></span><span class="op">(</span><span class="st">'Sea and ocean'</span>, <span class="va">landuse_classes</span><span class="op">$</span><span class="va">landuse_class</span><span class="op">)</span>
<span class="va">landuse_crop_hrw</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">landuse_crop_hrw</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">landuse_classes</span><span class="op">[</span><span class="va">sea_id</span>, <span class="st">"landuse_id"</span><span class="op">]</span>  <span class="co"># Convert Sea that is set to NaN</span>
<span class="va">landuse_crop_dhl</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">landuse_crop_dhl</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">landuse_classes</span><span class="op">[</span><span class="va">sea_id</span>, <span class="st">"landuse_id"</span><span class="op">]</span></code></pre></div>
<p>And plot the result:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>pty <span class="op">=</span> <span class="st">"s"</span>, mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/image.html">image</a></span><span class="op">(</span><span class="va">landuse_crop_hrw</span>, main <span class="op">=</span> <span class="st">"Herwijnen"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/image.html">image</a></span><span class="op">(</span><span class="va">landuse_crop_dhl</span>, main <span class="op">=</span> <span class="st">"Den Helder"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03.Annotate-land-use_files/figure-html/plot_cropped_landuse_maps-1.png" width="672"></div>
</div>
<div id="reprojecting-the-land-use-map" class="section level3">
<h3>
<span class="header-section-number">3.2.2</span> Reprojecting the land use map<a class="anchor" aria-label="anchor" href="#reprojecting-the-land-use-map"><i class="fas fa-link"></i></a>
</h3>
<p>Now that the land use map is cropped, we can start the reprojection to the CRS of the radar PPI. As we’re dealing with categorical data, we set <code>method = "ngb"</code> to use nearest neighbour interpolation. Despite using interpolation, this reprojection does not change the resolution from the base of the <code>CLC2018</code> dataset to that of the PPI, so we’ll have to do that next.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">landuse_hrw_reprojected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/projectRaster.html">projectRaster</a></span><span class="op">(</span><span class="va">landuse_crop_hrw</span>, crs <span class="op">=</span> <span class="va">ppi_proj4_hrw</span>, method <span class="op">=</span> <span class="st">"ngb"</span><span class="op">)</span>
<span class="va">landuse_dhl_reprojected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/projectRaster.html">projectRaster</a></span><span class="op">(</span><span class="va">landuse_crop_dhl</span>, crs <span class="op">=</span> <span class="va">ppi_proj4_dhl</span>, method <span class="op">=</span> <span class="st">"ngb"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">levels</a></span><span class="op">(</span><span class="va">landuse_hrw_reprojected</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">levels</a></span><span class="op">(</span><span class="va">landuse_crop_hrw</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">levels</a></span><span class="op">(</span><span class="va">landuse_dhl_reprojected</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">levels</a></span><span class="op">(</span><span class="va">landuse_crop_dhl</span><span class="op">)</span></code></pre></div>
<p>If the reprojection went successful, the CRS of the reprojected land use map and the radar PPI should be the same.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/compareCRS.html">compareCRS</a></span><span class="op">(</span><span class="va">ppi_hrw</span><span class="op">$</span><span class="va">data</span><span class="op">@</span><span class="va">proj4string</span>, <span class="va">landuse_hrw_reprojected</span><span class="op">@</span><span class="va">crs</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/compareCRS.html">compareCRS</a></span><span class="op">(</span><span class="va">ppi_dhl</span><span class="op">$</span><span class="va">data</span><span class="op">@</span><span class="va">proj4string</span>, <span class="va">landuse_dhl_reprojected</span><span class="op">@</span><span class="va">crs</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE
## [1] TRUE</code></pre>
<p>Apparently that is the case.</p>
</div>
<div id="reclassifying-land-use-types-to-functional-classes" class="section level3">
<h3>
<span class="header-section-number">3.2.3</span> Reclassifying land use types to functional classes<a class="anchor" aria-label="anchor" href="#reclassifying-land-use-types-to-functional-classes"><i class="fas fa-link"></i></a>
</h3>
<p>The <code>CLC2018</code> dataset contains a total of 44 land use classes. For our purpose, we reduce these 44 to 5 classes with more biologically relevant groupings, specifically:</p>
<ol style="list-style-type: decimal">
<li>Urban area</li>
<li>Agricultural area</li>
<li>Semi-open area</li>
<li>Forests</li>
<li>Wetlands</li>
<li>Water bodies</li>
</ol>
<p>The following table is used to convert/reclassify the classes contained within the <code>CLC2018</code> dataset, with the original land use classes under <code>landuse_class</code> and how they will be reclassified under <code>landuse_target</code>. We also indicate whether these areas are inhabited (inhabited = 1), or uninhabited (inhabited = 0). In The Netherlands inhabited areas are classified as “Discontinuous urban fabric” in the <code>CLC2018</code> dataset, all other areas we set to uninhabited.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">landuse_classes</span> <span class="op">%&lt;&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>landuse_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>
    <span class="va">landuse_id</span> <span class="op">&gt;=</span> <span class="fl">100</span> <span class="op">&amp;</span> <span class="va">landuse_id</span> <span class="op">&lt;</span> <span class="fl">200</span> <span class="op">~</span> <span class="st">"Urban area"</span>,
    <span class="va">landuse_id</span> <span class="op">&gt;=</span> <span class="fl">200</span> <span class="op">&amp;</span> <span class="va">landuse_id</span> <span class="op">&lt;=</span> <span class="fl">213</span> <span class="op">~</span> <span class="st">"Agricultural area"</span>,
    <span class="va">landuse_id</span> <span class="op">&gt;=</span> <span class="fl">221</span> <span class="op">&amp;</span> <span class="va">landuse_id</span> <span class="op">&lt;=</span> <span class="fl">223</span> <span class="op">~</span> <span class="st">"Semi-open area"</span>,
    <span class="va">landuse_id</span> <span class="op">&gt;=</span> <span class="fl">231</span> <span class="op">&amp;</span> <span class="va">landuse_id</span> <span class="op">&lt;=</span> <span class="fl">243</span> <span class="op">~</span> <span class="st">"Agricultural area"</span>,
    <span class="va">landuse_id</span> <span class="op">&gt;=</span> <span class="fl">244</span> <span class="op">&amp;</span> <span class="va">landuse_id</span> <span class="op">&lt;</span> <span class="fl">300</span> <span class="op">~</span> <span class="st">"Forests"</span>,
    <span class="va">landuse_id</span> <span class="op">&gt;=</span> <span class="fl">300</span> <span class="op">&amp;</span> <span class="va">landuse_id</span> <span class="op">&lt;=</span> <span class="fl">313</span> <span class="op">~</span> <span class="st">"Forests"</span>,
    <span class="va">landuse_id</span> <span class="op">&gt;=</span> <span class="fl">321</span> <span class="op">&amp;</span> <span class="va">landuse_id</span> <span class="op">&lt;=</span> <span class="fl">335</span> <span class="op">~</span> <span class="st">"Semi-open area"</span>,
    <span class="va">landuse_id</span> <span class="op">&gt;=</span> <span class="fl">400</span> <span class="op">&amp;</span> <span class="va">landuse_id</span> <span class="op">&lt;</span> <span class="fl">500</span> <span class="op">~</span> <span class="st">"Wetlands"</span>,
    <span class="va">landuse_id</span> <span class="op">&gt;=</span> <span class="fl">500</span> <span class="op">&amp;</span> <span class="va">landuse_id</span> <span class="op">&lt;</span> <span class="fl">999</span> <span class="op">~</span> <span class="st">"Water bodies"</span>,
    <span class="va">landuse_id</span> <span class="op">==</span> <span class="fl">999</span> <span class="op">~</span> <span class="st">"NODATA"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>landuse_target_id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>
    <span class="va">landuse_target</span> <span class="op">==</span> <span class="st">"Urban area"</span> <span class="op">~</span> <span class="fl">1</span>,
    <span class="va">landuse_target</span> <span class="op">==</span> <span class="st">"Agricultural area"</span> <span class="op">~</span> <span class="fl">2</span>,
    <span class="va">landuse_target</span> <span class="op">==</span> <span class="st">"Semi-open area"</span> <span class="op">~</span> <span class="fl">3</span>,
    <span class="va">landuse_target</span> <span class="op">==</span> <span class="st">"Forests"</span> <span class="op">~</span> <span class="fl">4</span>,
    <span class="va">landuse_target</span> <span class="op">==</span> <span class="st">"Wetlands"</span> <span class="op">~</span> <span class="fl">5</span>,
    <span class="va">landuse_target</span> <span class="op">==</span> <span class="st">"Water bodies"</span> <span class="op">~</span> <span class="fl">6</span>,
    <span class="va">landuse_target</span> <span class="op">==</span> <span class="st">"NODATA"</span> <span class="op">~</span> <span class="fl">9</span>
  <span class="op">)</span><span class="op">)</span>

<span class="va">landuse_classes</span><span class="op">$</span><span class="va">inhabited</span> <span class="op">&lt;-</span> <span class="fl">0</span>
<span class="va">landuse_classes</span><span class="op">$</span><span class="va">inhabited</span><span class="op">[</span><span class="va">landuse_classes</span><span class="op">$</span><span class="va">landuse_class</span> <span class="op">==</span> <span class="st">"Discontinuous urban fabric"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>

<span class="va">landuse_classes</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table style="width:100%;" class="table table-sm">
<colgroup>
<col width="7%">
<col width="60%">
<col width="12%">
<col width="12%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="right">landuse_id</th>
<th align="left">landuse_class</th>
<th align="left">landuse_target</th>
<th align="right">landuse_target_id</th>
<th align="right">inhabited</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">111</td>
<td align="left">Continuous urban fabric</td>
<td align="left">Urban area</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">112</td>
<td align="left">Discontinuous urban fabric</td>
<td align="left">Urban area</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">121</td>
<td align="left">Industrial or commercial units</td>
<td align="left">Urban area</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">122</td>
<td align="left">Road and rail networks and associated land</td>
<td align="left">Urban area</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">123</td>
<td align="left">Port areas</td>
<td align="left">Urban area</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">124</td>
<td align="left">Airports</td>
<td align="left">Urban area</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">131</td>
<td align="left">Mineral extraction sites</td>
<td align="left">Urban area</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">132</td>
<td align="left">Dump sites</td>
<td align="left">Urban area</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">133</td>
<td align="left">Construction sites</td>
<td align="left">Urban area</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">141</td>
<td align="left">Green urban areas</td>
<td align="left">Urban area</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">142</td>
<td align="left">Sport and leisure facilities</td>
<td align="left">Urban area</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">211</td>
<td align="left">Non-irrigated arable land</td>
<td align="left">Agricultural area</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">212</td>
<td align="left">Permanently irrigated land</td>
<td align="left">Agricultural area</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">213</td>
<td align="left">Rice fields</td>
<td align="left">Agricultural area</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">221</td>
<td align="left">Vineyards</td>
<td align="left">Semi-open area</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">222</td>
<td align="left">Fruit trees and berry plantations</td>
<td align="left">Semi-open area</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">223</td>
<td align="left">Olive groves</td>
<td align="left">Semi-open area</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">231</td>
<td align="left">Pastures</td>
<td align="left">Agricultural area</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">241</td>
<td align="left">Annual crops associated with permanent crops</td>
<td align="left">Agricultural area</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">242</td>
<td align="left">Complex cultivation patterns</td>
<td align="left">Agricultural area</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">243</td>
<td align="left">Land principally occupied by agriculture with significant areas of natural vegetation</td>
<td align="left">Agricultural area</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">244</td>
<td align="left">Agro-forestry areas</td>
<td align="left">Forests</td>
<td align="right">4</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">311</td>
<td align="left">Broad-leaved forest</td>
<td align="left">Forests</td>
<td align="right">4</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">312</td>
<td align="left">Coniferous forest</td>
<td align="left">Forests</td>
<td align="right">4</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">313</td>
<td align="left">Mixed forest</td>
<td align="left">Forests</td>
<td align="right">4</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">321</td>
<td align="left">Natural grasslands</td>
<td align="left">Semi-open area</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">322</td>
<td align="left">Moors and heathland</td>
<td align="left">Semi-open area</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">323</td>
<td align="left">Sclerophyllous vegetation</td>
<td align="left">Semi-open area</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">324</td>
<td align="left">Transitional woodland-shrub</td>
<td align="left">Semi-open area</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">331</td>
<td align="left">Beaches dunes sands</td>
<td align="left">Semi-open area</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">332</td>
<td align="left">Bare rocks</td>
<td align="left">Semi-open area</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">333</td>
<td align="left">Sparsely vegetated areas</td>
<td align="left">Semi-open area</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">334</td>
<td align="left">Burnt areas</td>
<td align="left">Semi-open area</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">335</td>
<td align="left">Glaciers and perpetual snow</td>
<td align="left">Semi-open area</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">411</td>
<td align="left">Inland marshes</td>
<td align="left">Wetlands</td>
<td align="right">5</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">412</td>
<td align="left">Peat bogs</td>
<td align="left">Wetlands</td>
<td align="right">5</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">421</td>
<td align="left">Salt marshes</td>
<td align="left">Wetlands</td>
<td align="right">5</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">422</td>
<td align="left">Salines</td>
<td align="left">Wetlands</td>
<td align="right">5</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">423</td>
<td align="left">Intertidal flats</td>
<td align="left">Wetlands</td>
<td align="right">5</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">511</td>
<td align="left">Water courses</td>
<td align="left">Water bodies</td>
<td align="right">6</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">512</td>
<td align="left">Water bodies</td>
<td align="left">Water bodies</td>
<td align="right">6</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">521</td>
<td align="left">Coastal lagoons</td>
<td align="left">Water bodies</td>
<td align="right">6</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">522</td>
<td align="left">Estuaries</td>
<td align="left">Water bodies</td>
<td align="right">6</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">523</td>
<td align="left">Sea and ocean</td>
<td align="left">Water bodies</td>
<td align="right">6</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">999</td>
<td align="left">NODATA</td>
<td align="left">NODATA</td>
<td align="right">9</td>
<td align="right">0</td>
</tr>
</tbody>
</table></div>
</div>
<p>With a sort-of ‘raster attribute table’ in place, we can now reclassify the detailed landuse classes to the broader categories listed above.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">landuse_dhl_reclassified</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">ratify</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/reclassify.html">reclassify</a></span><span class="op">(</span><span class="va">landuse_dhl_reprojected</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">landuse_classes</span><span class="op">$</span><span class="va">landuse_id</span>, <span class="va">landuse_classes</span><span class="op">$</span><span class="va">landuse_target_id</span><span class="op">)</span><span class="op">)</span>, count <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">landuse_hrw_reclassified</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">ratify</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/reclassify.html">reclassify</a></span><span class="op">(</span><span class="va">landuse_hrw_reprojected</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">landuse_classes</span><span class="op">$</span><span class="va">landuse_id</span>, <span class="va">landuse_classes</span><span class="op">$</span><span class="va">landuse_target_id</span><span class="op">)</span><span class="op">)</span>, count <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/writeRaster.html">writeRaster</a></span><span class="op">(</span><span class="va">landuse_dhl_reclassified</span>, <span class="st">"data/processed/landuse/landuse_dhl_reclassified.tif"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/writeRaster.html">writeRaster</a></span><span class="op">(</span><span class="va">landuse_hrw_reclassified</span>, <span class="st">"data/processed/landuse/landuse_hrw_reclassified.tif"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>This leaves us with the following count of ~100x100m cells per land use category</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cellcounts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">levels</a></span><span class="op">(</span><span class="va">landuse_hrw_reclassified</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="st">"COUNT"</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">levels</a></span><span class="op">(</span><span class="va">landuse_dhl_reclassified</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="st">"COUNT"</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">cellcounts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Herwijnen"</span>, <span class="st">"Den Helder"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">cellcounts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/unique.html">unique</a></span><span class="op">(</span><span class="va">landuse_classes</span><span class="op">$</span><span class="va">landuse_target</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">7</span><span class="op">]</span>
<span class="va">cellcounts</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left"></th>
<th align="right">Herwijnen</th>
<th align="right">Den Helder</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Urban area</td>
<td align="right">1860678</td>
<td align="right">809932</td>
</tr>
<tr class="even">
<td align="left">Agricultural area</td>
<td align="right">6256242</td>
<td align="right">3384907</td>
</tr>
<tr class="odd">
<td align="left">Semi-open area</td>
<td align="right">194271</td>
<td align="right">133709</td>
</tr>
<tr class="even">
<td align="left">Forests</td>
<td align="right">1437047</td>
<td align="right">498510</td>
</tr>
<tr class="odd">
<td align="left">Wetlands</td>
<td align="right">346616</td>
<td align="right">364301</td>
</tr>
<tr class="even">
<td align="left">Water bodies</td>
<td align="right">3851726</td>
<td align="right">8890353</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="resampling-the-land-use-map-to-a-lower-resolution" class="section level3">
<h3>
<span class="header-section-number">3.2.4</span> Resampling the land use map to a lower resolution<a class="anchor" aria-label="anchor" href="#resampling-the-land-use-map-to-a-lower-resolution"><i class="fas fa-link"></i></a>
</h3>
<p>The cellsize of the PPIs is 500x500 meters, but the land use map is much more finely detailed (~100x100m), so we need to resample the latter to derive a land use map at a 500x500 meter resolution as well.</p>
<p>As the resolution of the PPIs is so much higher than that of the land use map, we need to resample the latter to a lower resolution. Instead of classifying a single pixel in the PPI as belonging to a single land use class, we will do so using land use proportions. We therefore calculate the proportions belonging to each of the land use classes within an area of cells roughly the size of the PPI pixels. Subsequently we resample this to match 1:1 with the PPI pixels and store the land use proportions for each of the land use classes in the PPIs. This is done in the <code>calculate_land_use_proportion()</code> function below.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">calculate_land_use_proportion</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">raster</span>, <span class="va">reference_raster</span>, <span class="va">overwrite</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getValues.html">getValues</a></span><span class="op">(</span><span class="va">raster</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co"># classes: multidimensional logical array for the classes contained within the land use map</span>
  <span class="co"># 1 if a land use class is present on that position, 0 if not</span>
  <span class="va">classes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/layerize.html">layerize</a></span><span class="op">(</span><span class="va">raster</span>, filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"data/processed/landuse/layerize/"</span>, <span class="fu"><a href="https://rdrr.io/r/base/substitute.html">substitute</a></span><span class="op">(</span><span class="va">raster</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,
                      format <span class="op">=</span> <span class="st">"raster"</span>, bylayer <span class="op">=</span> <span class="cn">TRUE</span>, classes <span class="op">=</span> <span class="va">values</span>, overwrite <span class="op">=</span> <span class="va">overwrite</span><span class="op">)</span>
  <span class="co"># factor: nr of cells in both horizontal and vertical direction to aggregate</span>
  <span class="va">factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/dimensions.html">dim</a></span><span class="op">(</span><span class="va">raster</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/dimensions.html">dim</a></span><span class="op">(</span><span class="va">reference_raster</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
  <span class="co"># agg: aggregated version of classes (aggregation factor defined by factor) containing mean coverage by a class in a given area</span>
  <span class="co"># 1 corresponds with full coverage, 0 with no coverage of that class within the pixel at all</span>
  <span class="va">agg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">classes</span>, <span class="va">factor</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, fun <span class="op">=</span> <span class="va">mean</span><span class="op">)</span>
  <span class="co"># x: the agg and ppi pixels almost overlap exactly, but there is a teeny tiny difference which we can</span>
  <span class="co"># iron out by resampling once more.</span>
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/resample.html">resample</a></span><span class="op">(</span><span class="va">agg</span>, <span class="va">reference_raster</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>We can now calculate the proportions and will save these to some raster files for potential inspection in GIS software.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">landuse_hrw</span> <span class="op">&lt;-</span> <span class="fu">calculate_land_use_proportion</span><span class="op">(</span><span class="va">landuse_hrw_reclassified</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html">as</a></span><span class="op">(</span><span class="va">ppi_hrw</span><span class="op">$</span><span class="va">data</span>, <span class="st">"RasterLayer"</span><span class="op">)</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">landuse_dhl</span> <span class="op">&lt;-</span> <span class="fu">calculate_land_use_proportion</span><span class="op">(</span><span class="va">landuse_dhl_reclassified</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html">as</a></span><span class="op">(</span><span class="va">ppi_dhl</span><span class="op">$</span><span class="va">data</span>, <span class="st">"RasterLayer"</span><span class="op">)</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">landuse_hrw</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"urban"</span>, <span class="st">"agricultural"</span>, <span class="st">"semiopen"</span>, <span class="st">"forests"</span>, <span class="st">"wetlands"</span>, <span class="st">"waterbodies"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">landuse_dhl</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"urban"</span>, <span class="st">"agricultural"</span>, <span class="st">"semiopen"</span>, <span class="st">"forests"</span>, <span class="st">"wetlands"</span>, <span class="st">"waterbodies"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/writeRaster.html">writeRaster</a></span><span class="op">(</span><span class="va">landuse_hrw</span>, <span class="st">"data/processed/landuse/landuse_hrw.tif"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/writeRaster.html">writeRaster</a></span><span class="op">(</span><span class="va">landuse_dhl</span>, <span class="st">"data/processed/landuse/landuse_dhl.tif"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>By now the resampled land use raster should be very similar to the PPI raster, with the exception of — of course — the values contained within.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/compare.html">compareRaster</a></span><span class="op">(</span><span class="va">landuse_hrw</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html">as</a></span><span class="op">(</span><span class="va">ppi_hrw</span><span class="op">$</span><span class="va">data</span>, <span class="st">"RasterLayer"</span><span class="op">)</span>, extent <span class="op">=</span> <span class="cn">TRUE</span>, rowcol <span class="op">=</span> <span class="cn">TRUE</span>, crs <span class="op">=</span> <span class="cn">TRUE</span>, res <span class="op">=</span> <span class="cn">TRUE</span>, orig <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/compare.html">compareRaster</a></span><span class="op">(</span><span class="va">landuse_dhl</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html">as</a></span><span class="op">(</span><span class="va">ppi_dhl</span><span class="op">$</span><span class="va">data</span>, <span class="st">"RasterLayer"</span><span class="op">)</span>, extent <span class="op">=</span> <span class="cn">TRUE</span>, rowcol <span class="op">=</span> <span class="cn">TRUE</span>, crs <span class="op">=</span> <span class="cn">TRUE</span>, res <span class="op">=</span> <span class="cn">TRUE</span>, orig <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE
## [1] TRUE</code></pre>
<p>Ok, let’s save a copy of what we have so far.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">landuse_hrw</span>, <span class="st">"data/processed/landuse/landuse_hrw.RDS"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">landuse_dhl</span>, <span class="st">"data/processed/landuse/landuse_dhl.RDS"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="adding-land-use-classifications-to-the-ppis" class="section level2">
<h2>
<span class="header-section-number">3.3</span> Adding land use classifications to the PPIs<a class="anchor" aria-label="anchor" href="#adding-land-use-classifications-to-the-ppis"><i class="fas fa-link"></i></a>
</h2>
<p>With the land use rasters overlapping exactly with the PPIs, we can simply extract the values of the resampled land use rasters and add these as additional parameters to the PPIs.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">landuse_hrw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/processed/landuse/landuse_hrw.RDS"</span><span class="op">)</span>
<span class="va">landuse_dhl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/processed/landuse/landuse_dhl.RDS"</span><span class="op">)</span>

<span class="va">values_hrw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterToPoints.html">rasterToPoints</a></span><span class="op">(</span><span class="va">landuse_hrw</span>, spatial <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">values_dhl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterToPoints.html">rasterToPoints</a></span><span class="op">(</span><span class="va">landuse_dhl</span>, spatial <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">ppi_hrw</span><span class="op">$</span><span class="va">data</span><span class="op">@</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">ppi_hrw</span><span class="op">$</span><span class="va">data</span><span class="op">@</span><span class="va">data</span>, <span class="va">values_hrw</span><span class="op">@</span><span class="va">data</span><span class="op">)</span>
<span class="va">ppi_dhl</span><span class="op">$</span><span class="va">data</span><span class="op">@</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">ppi_dhl</span><span class="op">$</span><span class="va">data</span><span class="op">@</span><span class="va">data</span>, <span class="va">values_dhl</span><span class="op">@</span><span class="va">data</span><span class="op">)</span></code></pre></div>
</div>
<div id="calculate-distance-to-nearest-urban-area" class="section level2">
<h2>
<span class="header-section-number">3.4</span> Calculate distance to nearest urban area<a class="anchor" aria-label="anchor" href="#calculate-distance-to-nearest-urban-area"><i class="fas fa-link"></i></a>
</h2>
<p>We can use the distance to the nearest inhabited urban area as a proxy for disturbance. To calculate this, we reclassify the raster to cells containing inhabited urban area and everything else. For every cell on the raster that is not a cell we have just classified as inhabited urban area, we will calculate the distance (in meters) to the nearest cell classified as inhabited urban area. We classify a PPI cell as uninhabited if the proportion of its constituent cells (at a finer resolution) that is inhabited is <code>&gt; 0.95</code>.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dhl_inhabited</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">ratify</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/reclassify.html">reclassify</a></span><span class="op">(</span><span class="va">landuse_dhl_reprojected</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">landuse_classes</span><span class="op">$</span><span class="va">landuse_id</span>, <span class="va">landuse_classes</span><span class="op">$</span><span class="va">inhabited</span><span class="op">)</span><span class="op">)</span>, count <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">hrw_inhabited</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">ratify</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/reclassify.html">reclassify</a></span><span class="op">(</span><span class="va">landuse_hrw_reprojected</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">landuse_classes</span><span class="op">$</span><span class="va">landuse_id</span>, <span class="va">landuse_classes</span><span class="op">$</span><span class="va">inhabited</span><span class="op">)</span><span class="op">)</span>, count <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">dhl_inhabited</span> <span class="op">&lt;-</span> <span class="fu">calculate_land_use_proportion</span><span class="op">(</span><span class="va">dhl_inhabited</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html">as</a></span><span class="op">(</span><span class="va">ppi_dhl</span><span class="op">$</span><span class="va">data</span>, <span class="st">"RasterLayer"</span><span class="op">)</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">hrw_inhabited</span> <span class="op">&lt;-</span> <span class="fu">calculate_land_use_proportion</span><span class="op">(</span><span class="va">hrw_inhabited</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html">as</a></span><span class="op">(</span><span class="va">ppi_hrw</span><span class="op">$</span><span class="va">data</span>, <span class="st">"RasterLayer"</span><span class="op">)</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">dhl_inhabited</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"uninhabited"</span>, <span class="st">"inhabited"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">hrw_inhabited</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"uninhabited"</span>, <span class="st">"inhabited"</span><span class="op">)</span>

<span class="va">dist_dhl</span> <span class="op">&lt;-</span> <span class="va">dhl_inhabited</span>
<span class="va">dist_dhl</span><span class="op">[</span><span class="va">dist_dhl</span><span class="op">$</span><span class="va">uninhabited</span> <span class="op">&gt;</span> <span class="fl">0.95</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">dist_dhl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/distance.html">distance</a></span><span class="op">(</span><span class="va">dist_dhl</span><span class="op">$</span><span class="va">inhabited</span><span class="op">)</span>

<span class="va">dist_hrw</span> <span class="op">&lt;-</span> <span class="va">hrw_inhabited</span>
<span class="va">dist_hrw</span><span class="op">[</span><span class="va">dist_hrw</span><span class="op">$</span><span class="va">uninhabited</span> <span class="op">&gt;</span> <span class="fl">0.95</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">dist_hrw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/distance.html">distance</a></span><span class="op">(</span><span class="va">dist_hrw</span><span class="op">$</span><span class="va">inhabited</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/raster/man/writeRaster.html">writeRaster</a></span><span class="op">(</span><span class="va">dist_hrw</span>, <span class="st">"data/processed/landuse/dist_urban_hrw.tif"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/writeRaster.html">writeRaster</a></span><span class="op">(</span><span class="va">dist_dhl</span>, <span class="st">"data/processed/landuse/dist_urban_dhl.tif"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>And we add these values to the PPIs again.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">values_dist_hrw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterToPoints.html">rasterToPoints</a></span><span class="op">(</span><span class="va">dist_hrw</span>, spatial <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">values_dist_dhl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterToPoints.html">rasterToPoints</a></span><span class="op">(</span><span class="va">dist_dhl</span>, spatial <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">ppi_hrw</span><span class="op">$</span><span class="va">data</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">dist_urban</span> <span class="op">&lt;-</span> <span class="va">values_dist_hrw</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">layer</span>
<span class="va">ppi_dhl</span><span class="op">$</span><span class="va">data</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">dist_urban</span> <span class="op">&lt;-</span> <span class="va">values_dist_dhl</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">layer</span></code></pre></div>
</div>
<div id="add-population-density" class="section level2">
<h2>
<span class="header-section-number">3.5</span> Add population density<a class="anchor" aria-label="anchor" href="#add-population-density"><i class="fas fa-link"></i></a>
</h2>
<p>Another proxy for disturbance to explore is simply the number of humans living in a certain area. The Dutch Central Bureau of Statistics (CBS) annually publishes <a href="https://www.cbs.nl/nl-nl/dossier/nederland-regionaal/geografische-data/kaart-van-500-meter-bij-500-meter-met-statistieken">a dataset</a> containing the number of inhabitants organized in 500x500m grid cells. We will now add this to the PPIs as well.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cbs_maps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"data/raw/population-density/2019-CBS_VK500_2018_v1/CBS_VK500_2018_v1.shp"</span><span class="op">)</span></code></pre></div>
<pre><code>## Reading layer `CBS_VK500_2018_v1' from data source `/mnt/fireworks/raw/population-density/2019-CBS_VK500_2018_v1/CBS_VK500_2018_v1.shp' using driver `ESRI Shapefile'
## Simple feature collection with 151108 features and 31 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: 13000 ymin: 306500 xmax: 278500 ymax: 619500
## proj4string:    +proj=sterea +lat_0=52.15616055555555 +lon_0=5.38763888888889 +k=0.9999079 +x_0=155000 +y_0=463000 +ellps=bessel +units=m +no_defs</code></pre>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cbs_hrw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">cbs_maps</span>, <span class="va">ppi_hrw</span><span class="op">$</span><span class="va">data</span><span class="op">@</span><span class="va">proj4string</span><span class="op">)</span>
<span class="va">cbs_dhl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">cbs_maps</span>, <span class="va">ppi_dhl</span><span class="op">$</span><span class="va">data</span><span class="op">@</span><span class="va">proj4string</span><span class="op">)</span>

<span class="co"># Template for the rasterization following the standard 500x500m resolution of the CBS grid</span>
<span class="va">template_hrw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_as_stars.html">st_as_stars</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="va">cbs_hrw</span><span class="op">[</span><span class="st">"INWONER"</span><span class="op">]</span><span class="op">)</span>, values <span class="op">=</span> <span class="cn">NA_real_</span>, dx <span class="op">=</span> <span class="fl">500</span>, dy <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>
<span class="va">template_dhl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_as_stars.html">st_as_stars</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="va">cbs_dhl</span><span class="op">[</span><span class="st">"INWONER"</span><span class="op">]</span><span class="op">)</span>, values <span class="op">=</span> <span class="cn">NA_real_</span>, dx <span class="op">=</span> <span class="fl">500</span>, dy <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>

<span class="co"># Now rasterize</span>
<span class="va">pop_density_rasterized_hrw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html">as</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_rasterize.html">st_rasterize</a></span><span class="op">(</span><span class="va">cbs_hrw</span><span class="op">[</span><span class="st">"INWONER"</span><span class="op">]</span>, template <span class="op">=</span> <span class="va">template_hrw</span><span class="op">)</span>, <span class="st">"Raster"</span><span class="op">)</span>
<span class="va">pop_density_rasterized_dhl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html">as</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_rasterize.html">st_rasterize</a></span><span class="op">(</span><span class="va">cbs_dhl</span><span class="op">[</span><span class="st">"INWONER"</span><span class="op">]</span>, template <span class="op">=</span> <span class="va">template_dhl</span><span class="op">)</span>, <span class="st">"Raster"</span><span class="op">)</span>

<span class="co"># Set negative or NA raster values to 0</span>
<span class="va">pop_density_rasterized_hrw</span><span class="op">[</span><span class="va">pop_density_rasterized_hrw</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>
<span class="va">pop_density_rasterized_dhl</span><span class="op">[</span><span class="va">pop_density_rasterized_dhl</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>

<span class="co"># Now aggregate by summing up values in cells to 'cover' the values that fit in a PPI pixel</span>
<span class="va">factor_hrw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/dimensions.html">dim</a></span><span class="op">(</span><span class="va">pop_density_rasterized_hrw</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/dimensions.html">dim</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html">as</a></span><span class="op">(</span><span class="va">ppi_hrw</span><span class="op">$</span><span class="va">data</span>, <span class="st">"RasterLayer"</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="va">factor_dhl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/dimensions.html">dim</a></span><span class="op">(</span><span class="va">pop_density_rasterized_dhl</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/dimensions.html">dim</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html">as</a></span><span class="op">(</span><span class="va">ppi_dhl</span><span class="op">$</span><span class="va">data</span>, <span class="st">"RasterLayer"</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="va">agg_hrw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">pop_density_rasterized_hrw</span>, <span class="va">factor_hrw</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, fun <span class="op">=</span> <span class="va">sum</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in .local(x, ...): all fact(s) were 1, nothing to aggregate</code></pre>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">agg_dhl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">pop_density_rasterized_dhl</span>, <span class="va">factor_dhl</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, fun <span class="op">=</span> <span class="va">sum</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in .local(x, ...): all fact(s) were 1, nothing to aggregate</code></pre>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Resample to make the PPI and CBS population grids line up 1:1</span>
<span class="va">pop_density_rasterized_hrw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/resample.html">resample</a></span><span class="op">(</span><span class="va">agg_hrw</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html">as</a></span><span class="op">(</span><span class="va">ppi_hrw</span><span class="op">$</span><span class="va">data</span>, <span class="st">"RasterLayer"</span><span class="op">)</span><span class="op">)</span>
<span class="va">pop_density_rasterized_dhl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/resample.html">resample</a></span><span class="op">(</span><span class="va">agg_dhl</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html">as</a></span><span class="op">(</span><span class="va">ppi_dhl</span><span class="op">$</span><span class="va">data</span>, <span class="st">"RasterLayer"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Once again, verify if the PPI pixels match up exactly with the CBS population grids</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/compare.html">compareRaster</a></span><span class="op">(</span><span class="va">pop_density_rasterized_hrw</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html">as</a></span><span class="op">(</span><span class="va">ppi_hrw</span><span class="op">$</span><span class="va">data</span>, <span class="st">"RasterLayer"</span><span class="op">)</span>, extent <span class="op">=</span> <span class="cn">TRUE</span>, rowcol <span class="op">=</span> <span class="cn">TRUE</span>, crs <span class="op">=</span> <span class="cn">TRUE</span>, res <span class="op">=</span> <span class="cn">TRUE</span>, orig <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/compare.html">compareRaster</a></span><span class="op">(</span><span class="va">pop_density_rasterized_dhl</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html">as</a></span><span class="op">(</span><span class="va">ppi_dhl</span><span class="op">$</span><span class="va">data</span>, <span class="st">"RasterLayer"</span><span class="op">)</span>, extent <span class="op">=</span> <span class="cn">TRUE</span>, rowcol <span class="op">=</span> <span class="cn">TRUE</span>, crs <span class="op">=</span> <span class="cn">TRUE</span>, res <span class="op">=</span> <span class="cn">TRUE</span>, orig <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE
## [1] TRUE</code></pre>
<p>Now as a final step we will calculate the total population within the neighborhood surrounding the PPI pixels, to get a more representative measure of disturbance potential in the surrounding area.</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">pop_hrw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/focal.html">focal</a></span><span class="op">(</span><span class="va">pop_density_rasterized_hrw</span>, w <span class="op">=</span> <span class="va">weights</span>, fun <span class="op">=</span> <span class="va">sum</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">pop_dhl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/focal.html">focal</a></span><span class="op">(</span><span class="va">pop_density_rasterized_dhl</span>, w <span class="op">=</span> <span class="va">weights</span>, fun <span class="op">=</span> <span class="va">sum</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">pop_hrw</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">pop_hrw</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>
<span class="va">pop_dhl</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">pop_dhl</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></code></pre></div>
<p>And add it to the PPIs.</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">values_pop_hrw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterToPoints.html">rasterToPoints</a></span><span class="op">(</span><span class="va">pop_hrw</span>, spatial <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">values_pop_dhl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterToPoints.html">rasterToPoints</a></span><span class="op">(</span><span class="va">pop_dhl</span>, spatial <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">ppi_hrw</span><span class="op">$</span><span class="va">data</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">human_pop</span> <span class="op">&lt;-</span> <span class="va">values_pop_hrw</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">layer</span>
<span class="va">ppi_dhl</span><span class="op">$</span><span class="va">data</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">human_pop</span> <span class="op">&lt;-</span> <span class="va">values_pop_dhl</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">layer</span></code></pre></div>
<p>And finally we save these PPIs again.</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">ppi_hrw</span>, file <span class="op">=</span> <span class="st">"data/processed/corrected_ppi_hrw_lu.RDS"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">ppi_dhl</span>, file <span class="op">=</span> <span class="st">"data/processed/corrected_ppi_dhl_lu.RDS"</span><span class="op">)</span></code></pre></div>
<div id="plotting-human-parameters-on-an-interactive-map" class="section level3">
<h3>
<span class="header-section-number">3.5.1</span> Plotting human parameters on an interactive map<a class="anchor" aria-label="anchor" href="#plotting-human-parameters-on-an-interactive-map"><i class="fas fa-link"></i></a>
</h3>
<p>We have now generated proxies for fireworks ‘severity’ for later modelling stages. Let’s plot them on an interactive map again for reference. <em>Unfortunately, due to <a href="https://github.com/rstudio/bookdown/issues/15#issuecomment-573776659">the way <code>leaflet</code> stores maps it produces</a>, we cannot plot them here using K-M knitting to generate this document. Run these chunks interactively and they should work fine.</em></p>
<div id="interactive-map-of-herwijnen" class="section level4">
<h4>
<span class="header-section-number">3.5.1.1</span> Interactive map of Herwijnen<a class="anchor" aria-label="anchor" href="#interactive-map-of-herwijnen"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">human_parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"urban"</span>, <span class="st">"agricultural"</span>, <span class="st">"semiopen"</span>, <span class="st">"forests"</span>, <span class="st">"wetlands"</span>, <span class="st">"waterbodies"</span>, <span class="st">"dist_urban"</span>, <span class="st">"human_pop"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html">mapview</a></span><span class="op">(</span><span class="va">ppi_hrw</span><span class="op">$</span><span class="va">data</span><span class="op">[</span>, , <span class="va">human_parameters</span><span class="op">]</span>, alpha.regions <span class="op">=</span> <span class="fl">0.6</span>, col.regions <span class="op">=</span> <span class="va">inferno</span>, maxpixels<span class="op">=</span><span class="fl">2000000</span>,
        na.color <span class="op">=</span> <span class="st">"#00000000"</span>, map.types <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CartoDB.Positron"</span>, <span class="st">"CartoDB.DarkMatter"</span>, <span class="st">"Esri.WorldImagery"</span><span class="op">)</span>,
        layer.name <span class="op">=</span> <span class="va">human_parameters</span><span class="op">)</span></code></pre></div>
</div>
<div id="interactive-map-of-den-helder" class="section level4">
<h4>
<span class="header-section-number">3.5.1.2</span> Interactive map of Den Helder<a class="anchor" aria-label="anchor" href="#interactive-map-of-den-helder"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html">mapview</a></span><span class="op">(</span><span class="va">ppi_dhl</span><span class="op">$</span><span class="va">data</span><span class="op">[</span>, , <span class="va">human_parameters</span><span class="op">]</span>, alpha.regions <span class="op">=</span> <span class="fl">0.6</span>, col.regions <span class="op">=</span> <span class="va">inferno</span>, maxpixels<span class="op">=</span><span class="fl">2000000</span>,
        na.color <span class="op">=</span> <span class="st">"#00000000"</span>, map.types <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CartoDB.Positron"</span>, <span class="st">"CartoDB.DarkMatter"</span>, <span class="st">"Esri.WorldImagery"</span><span class="op">)</span>,
        layer.name <span class="op">=</span> <span class="va">human_parameters</span><span class="op">)</span></code></pre></div>

</div>
</div>
</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="radar-data-preprocessing.html"><span class="header-section-number">2</span> Radar Data Preprocessing</a></div>
<div class="next"><a href="annotating-count-areas.html"><span class="header-section-number">4</span> Annotating count areas</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#annotating-land-use"><span class="header-section-number">3</span> Annotating land use</a></li>
<li><a class="nav-link" href="#processing-environment-2"><span class="header-section-number">3.1</span> Processing environment</a></li>
<li>
<a class="nav-link" href="#converting-the-land-use-map"><span class="header-section-number">3.2</span> Converting the land use map</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#cropping-the-land-use-map"><span class="header-section-number">3.2.1</span> Cropping the land use map</a></li>
<li><a class="nav-link" href="#reprojecting-the-land-use-map"><span class="header-section-number">3.2.2</span> Reprojecting the land use map</a></li>
<li><a class="nav-link" href="#reclassifying-land-use-types-to-functional-classes"><span class="header-section-number">3.2.3</span> Reclassifying land use types to functional classes</a></li>
<li><a class="nav-link" href="#resampling-the-land-use-map-to-a-lower-resolution"><span class="header-section-number">3.2.4</span> Resampling the land use map to a lower resolution</a></li>
</ul>
</li>
<li><a class="nav-link" href="#adding-land-use-classifications-to-the-ppis"><span class="header-section-number">3.3</span> Adding land use classifications to the PPIs</a></li>
<li><a class="nav-link" href="#calculate-distance-to-nearest-urban-area"><span class="header-section-number">3.4</span> Calculate distance to nearest urban area</a></li>
<li>
<a class="nav-link" href="#add-population-density"><span class="header-section-number">3.5</span> Add population density</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#plotting-human-parameters-on-an-interactive-map"><span class="header-section-number">3.5.1</span> Plotting human parameters on an interactive map</a></li></ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/barthoekstra/fireworks/blob/master/03.Annotate-land-use.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/barthoekstra/fireworks/edit/master/03.Annotate-land-use.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Fireworks</strong>" was written by Bart Hoekstra. It was last built on 2021-03-22.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
