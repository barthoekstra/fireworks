<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1 Selecting firework take-off moment | Fireworks</title>
  <meta name="description" content="Using ground-based bird counts and weather radar measurements to estimate numbers of birds aloft during NYE fireworks events." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="1 Selecting firework take-off moment | Fireworks" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Using ground-based bird counts and weather radar measurements to estimate numbers of birds aloft during NYE fireworks events." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1 Selecting firework take-off moment | Fireworks" />
  
  <meta name="twitter:description" content="Using ground-based bird counts and weather radar measurements to estimate numbers of birds aloft during NYE fireworks events." />
  

<meta name="author" content="Bart Hoekstra" />


<meta name="date" content="2020-02-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="02.Radar-data-preprocessing.html"/>
<script src="assets/jquery-2.2.3/jquery.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="assets/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="assets/plotly-binding-4.9.1/plotly.js"></script>
<script src="assets/typedarray-0.1/typedarray.min.js"></script>
<link href="assets/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="assets/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="assets/plotly-htmlwidgets-css-1.49.4/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="assets/plotly-main-1.49.4/plotly-latest.min.js"></script>
<link href="assets/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="assets/leaflet-1.3.1/leaflet.js"></script>
<link href="assets/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="assets/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="assets/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="assets/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="assets/leaflet-binding-2.0.3/leaflet.js"></script>
<script src="assets/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="assets/leaflet-providers-plugin-2.0.3/leaflet-providers-plugin.js"></script>
<script src="assets/VIR-1/data_stars_VIR7f2360.txt"></script>
<script src="assets/joda-0.0.1/joda.js"></script>
<link href="assets/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="assets/HomeButton-0.0.1/home-button.js"></script>
<script src="assets/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="assets/VID-1/data_stars_VID9253a6.txt"></script>
<script src="assets/R-1/data_stars_R3ea180.txt"></script>
<script src="assets/overlap-1/data_stars_overlap67d245.txt"></script>
<script src="assets/eta_sum-1/data_stars_eta_sum6e5f90.txt"></script>
<script src="assets/eta_sum_expected-1/data_stars_eta_sum_expected3c78ea.txt"></script>
<script src="assets/pop-1/data_stars_popc79db1.txt"></script>
<script src="assets/dist_urban-1/data_stars_dist_urban1274fd.txt"></script>
<script src="assets/landuse-1/data_stars_landuseb3812e.txt"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#abstract"><i class="fa fa-check"></i>Abstract</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-use-this-document"><i class="fa fa-check"></i>How to use this document</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#knit-it"><i class="fa fa-check"></i>Knit it</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#full-repro-mode"><i class="fa fa-check"></i>Full-reproduction mode</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="01.Selecting-take-off-moments.html"><a href="01.Selecting-take-off-moments.html"><i class="fa fa-check"></i><b>1</b> Selecting firework take-off moment</a><ul>
<li class="chapter" data-level="1.1" data-path="01.Selecting-take-off-moments.html"><a href="01.Selecting-take-off-moments.html#setting-up-the-processing-environment"><i class="fa fa-check"></i><b>1.1</b> Setting up the processing environment</a></li>
<li class="chapter" data-level="1.2" data-path="01.Selecting-take-off-moments.html"><a href="01.Selecting-take-off-moments.html#calculate-the-vertical-profiles"><i class="fa fa-check"></i><b>1.2</b> Calculate the vertical profiles</a></li>
<li class="chapter" data-level="1.3" data-path="01.Selecting-take-off-moments.html"><a href="01.Selecting-take-off-moments.html#generate-time-series-of-vertical-profiles"><i class="fa fa-check"></i><b>1.3</b> Generate time series of vertical profiles</a></li>
<li class="chapter" data-level="1.4" data-path="01.Selecting-take-off-moments.html"><a href="01.Selecting-take-off-moments.html#identifying-moment-of-take-off"><i class="fa fa-check"></i><b>1.4</b> Identifying moment of take-off</a></li>
<li class="chapter" data-level="" data-path="01.Selecting-take-off-moments.html"><a href="01.Selecting-take-off-moments.html#references"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html"><i class="fa fa-check"></i><b>2</b> Radar Data Preprocessing</a><ul>
<li class="chapter" data-level="2.1" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#setting-up-the-pre-processing-environment"><i class="fa fa-check"></i><b>2.1</b> Setting-up the pre-processing environment</a></li>
<li class="chapter" data-level="2.2" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#removing-electromagnetic-interference"><i class="fa fa-check"></i><b>2.2</b> Removing electromagnetic interference</a><ul>
<li class="chapter" data-level="2.2.1" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#verify-removal-of-rays-with-em-interference"><i class="fa fa-check"></i><b>2.2.1</b> Verify removal of rays with EM interference</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#filter-meteorology-using-the-depolarization-ratio"><i class="fa fa-check"></i><b>2.3</b> Filter meteorology using the depolarization ratio</a><ul>
<li class="chapter" data-level="2.3.1" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#verify-dpr-based-classification"><i class="fa fa-check"></i><b>2.3.1</b> Verify DPR-based classification</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#remove-classified-precipitation-from-polar-volumes"><i class="fa fa-check"></i><b>2.4</b> Remove classified precipitation from polar volumes</a></li>
<li class="chapter" data-level="2.5" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#filter-ground-clutter"><i class="fa fa-check"></i><b>2.5</b> Filter ground clutter</a><ul>
<li class="chapter" data-level="2.5.1" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#dynamic-clutter"><i class="fa fa-check"></i><b>2.5.1</b> Dynamic clutter</a></li>
<li class="chapter" data-level="2.5.2" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#static-clutter"><i class="fa fa-check"></i><b>2.5.2</b> Static clutter</a></li>
<li class="chapter" data-level="2.5.3" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#remove-dynamic-and-static-clutter"><i class="fa fa-check"></i><b>2.5.3</b> Remove dynamic and static clutter</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#range-bias-correction"><i class="fa fa-check"></i><b>2.6</b> Range-bias correction</a><ul>
<li class="chapter" data-level="2.6.1" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#range-corrected-ppi-of-herwijnen-radar"><i class="fa fa-check"></i><b>2.6.1</b> Range-corrected PPI of Herwijnen radar</a></li>
<li class="chapter" data-level="2.6.2" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#range-corrected-ppi-of-den-helder-radar"><i class="fa fa-check"></i><b>2.6.2</b> Range-corrected PPI of Den Helder radar</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#references-1"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="03.Annotate-PPI-with-land-use.html"><a href="03.Annotate-PPI-with-land-use.html"><i class="fa fa-check"></i><b>3</b> Annotating the PPIs with land use parameters</a><ul>
<li class="chapter" data-level="3.1" data-path="03.Annotate-PPI-with-land-use.html"><a href="03.Annotate-PPI-with-land-use.html#setting-up-the-annotation-environment"><i class="fa fa-check"></i><b>3.1</b> Setting up the annotation environment</a></li>
<li class="chapter" data-level="3.2" data-path="03.Annotate-PPI-with-land-use.html"><a href="03.Annotate-PPI-with-land-use.html#converting-the-land-use-map"><i class="fa fa-check"></i><b>3.2</b> Converting the land use map</a><ul>
<li class="chapter" data-level="3.2.1" data-path="03.Annotate-PPI-with-land-use.html"><a href="03.Annotate-PPI-with-land-use.html#cropping-the-land-use-map"><i class="fa fa-check"></i><b>3.2.1</b> Cropping the land use map</a></li>
<li class="chapter" data-level="3.2.2" data-path="03.Annotate-PPI-with-land-use.html"><a href="03.Annotate-PPI-with-land-use.html#reprojecting-the-land-use-map"><i class="fa fa-check"></i><b>3.2.2</b> Reprojecting the land use map</a></li>
<li class="chapter" data-level="3.2.3" data-path="03.Annotate-PPI-with-land-use.html"><a href="03.Annotate-PPI-with-land-use.html#resampling-the-land-use-map-to-a-lower-resolution"><i class="fa fa-check"></i><b>3.2.3</b> Resampling the land use map to a lower resolution</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="03.Annotate-PPI-with-land-use.html"><a href="03.Annotate-PPI-with-land-use.html#adding-land-use-classifications-to-the-ppis"><i class="fa fa-check"></i><b>3.3</b> Adding land use classifications to the PPIs</a></li>
<li class="chapter" data-level="3.4" data-path="03.Annotate-PPI-with-land-use.html"><a href="03.Annotate-PPI-with-land-use.html#classify-land-use-types-in-urban-vs.rural"><i class="fa fa-check"></i><b>3.4</b> Classify land use types in Urban vs. Rural</a></li>
<li class="chapter" data-level="3.5" data-path="03.Annotate-PPI-with-land-use.html"><a href="03.Annotate-PPI-with-land-use.html#calculate-distance-to-nearest-urban-area"><i class="fa fa-check"></i><b>3.5</b> Calculate distance to nearest urban area</a></li>
<li class="chapter" data-level="3.6" data-path="03.Annotate-PPI-with-land-use.html"><a href="03.Annotate-PPI-with-land-use.html#add-population-density"><i class="fa fa-check"></i><b>3.6</b> Add population density</a></li>
<li class="chapter" data-level="3.7" data-path="03.Annotate-PPI-with-land-use.html"><a href="03.Annotate-PPI-with-land-use.html#testing"><i class="fa fa-check"></i><b>3.7</b> Testing</a><ul>
<li class="chapter" data-level="3.7.1" data-path="03.Annotate-PPI-with-land-use.html"><a href="03.Annotate-PPI-with-land-use.html#plotting-total-vir-per-land-use-type"><i class="fa fa-check"></i><b>3.7.1</b> Plotting total VIR per land use type</a></li>
<li class="chapter" data-level="3.7.2" data-path="03.Annotate-PPI-with-land-use.html"><a href="03.Annotate-PPI-with-land-use.html#plotting-a-distance-to-urban-areas-effect-for-vir"><i class="fa fa-check"></i><b>3.7.2</b> Plotting a distance to urban areas effect for VIR</a></li>
<li class="chapter" data-level="3.7.3" data-path="03.Annotate-PPI-with-land-use.html"><a href="03.Annotate-PPI-with-land-use.html#plotting-it-all-on-an-interactive-map"><i class="fa fa-check"></i><b>3.7.3</b> Plotting it all on an interactive map</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Fireworks</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="selecting-firework-take-off-moment" class="section level1">
<h1><span class="header-section-number">1</span> Selecting firework take-off moment</h1>
<p>For this study we select the moment of ‘en masse’ take-off of birds at the turn of the year. To make sure birds are still fairly ‘close’ to the take-off habitat, we therefore pick the moment where the increase in <code>VIR</code> (Vertically Integrated Reflectivity) is the highest. Based on experience, one would expect this to occur between 00:05 and 00:15 on January 1st, as people tend to light the fireworks right after they have shared New Year’s wishes with each other.</p>
<div id="setting-up-the-processing-environment" class="section level2">
<h2><span class="header-section-number">1.1</span> Setting up the processing environment</h2>
<p>We use <code>vol2bird</code> included in the <a href="http://adokter.github.io/bioRad">bioRad package</a> <span class="citation">(Dokter et al. 2019)</span> to calculate the vertical profiles of reflectivity, from which we determine the exact take off moment of birds. This implies we assume birds take to the skies everywhere simultaneously, but that seems a realistic assumption given that the lighting of fireworks is synchronised by the local time, rather than the time of sunset/sunrise.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(bioRad)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="kw">Sys.setenv</span>(<span class="dt">TZ =</span> <span class="st">&quot;UTC&quot;</span>)</a></code></pre></div>
</div>
<div id="calculate-the-vertical-profiles" class="section level2">
<h2><span class="header-section-number">1.2</span> Calculate the vertical profiles</h2>
<p>We calculate vertical profiles for the period between December 31st, 2017 22:00 and 01:00 UTC on January 1st, 2018, which corresponds with 23:00 til 02:00 local Amsterdam time (UTC + 1). It is not necessary to generate so many <code>vp</code> files, but it gives a better temporal overview if we add some ‘temporal padding’ around the fireworks event.</p>
<p><em>Beware: to calculate the vertical profiles, a running instance of <a href="https://www.docker.com">Docker</a> is required. This code chunk will only run in <a href="A1.Full-reproduction-mode.html">full-reproduction mode</a>.</em></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">fireworks_scans &lt;-<span class="st"> </span><span class="kw">Sys.glob</span>(<span class="kw">file.path</span>(<span class="st">&quot;data/raw/pvol/fireworks-2017-2018&quot;</span>, <span class="st">&quot;*_ODIM.h5&quot;</span>))</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw">cat</span>(<span class="st">&quot;Files left to process: &quot;</span>, <span class="kw">length</span>(fireworks_scans), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">i =<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="cf">for</span> (scan <span class="cf">in</span> fireworks_scans) {</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">  <span class="cf">if</span> (i <span class="op">%%</span><span class="st"> </span><span class="dv">5</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">    <span class="kw">cat</span>(i, <span class="st">&quot;... &quot;</span>)</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">  }</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb3-9" data-line-number="9">  vpfile_out &lt;-<span class="st"> </span><span class="kw">sub</span>(<span class="st">&quot;raw/pvol/fireworks-2017-2018&quot;</span>, <span class="st">&quot;processed/vp/fireworks-2017-2018&quot;</span>, scan)</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">  <span class="kw">try</span>(<span class="kw">calculate_vp</span>(scan, <span class="dt">vpfile =</span> vpfile_out, <span class="dt">verbose =</span> <span class="ot">FALSE</span>, <span class="dt">mount =</span> <span class="kw">dirname</span>(fireworks_scans[<span class="dv">1</span>])))</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">  i =<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12">}</a></code></pre></div>
</div>
<div id="generate-time-series-of-vertical-profiles" class="section level2">
<h2><span class="header-section-number">1.3</span> Generate time series of vertical profiles</h2>
<p>We can now generate a time series of vertical profiles and plot the bird densities to get an idea of what was going on during NYE of 2017-2018.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">fw_hrw_vpts &lt;-<span class="st"> </span><span class="kw">Sys.glob</span>(<span class="kw">file.path</span>(<span class="st">&quot;data/processed/vp/fireworks-2017-2018&quot;</span>, <span class="st">&quot;*NL62*&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="st">  </span><span class="kw">read_vpfiles</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="st">  </span><span class="kw">bind_into_vpts</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="st">  </span><span class="kw">regularize_vpts</span>(<span class="dt">interval =</span> <span class="st">&quot;auto&quot;</span>)</a></code></pre></div>
<pre><code>## projecting on 300 seconds interval grid...</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">fw_dhl_vpts &lt;-<span class="st"> </span><span class="kw">Sys.glob</span>(<span class="kw">file.path</span>(<span class="st">&quot;data/processed/vp/fireworks-2017-2018&quot;</span>, <span class="st">&quot;*NL61*&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">  </span><span class="kw">read_vpfiles</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="st">  </span><span class="kw">bind_into_vpts</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="st">  </span><span class="kw">regularize_vpts</span>(<span class="dt">interval =</span> <span class="st">&quot;auto&quot;</span>)</a></code></pre></div>
<pre><code>## projecting on 300 seconds interval grid...</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">start &lt;-<span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2017-12-31 22:00:00&quot;</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">end &lt;-<span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2018-01-01 01:00:00&quot;</span>)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"></a>
<a class="sourceLine" id="cb8-4" data-line-number="4">indexes_hrw &lt;-<span class="st"> </span><span class="kw">which</span>(fw_hrw_vpts<span class="op">$</span>datetime <span class="op">&gt;=</span><span class="st"> </span>start <span class="op">&amp;</span><span class="st"> </span>fw_hrw_vpts<span class="op">$</span>datetime <span class="op">&lt;=</span><span class="st"> </span>end)</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">indexes_dhl &lt;-<span class="st"> </span><span class="kw">which</span>(fw_dhl_vpts<span class="op">$</span>datetime <span class="op">&gt;=</span><span class="st"> </span>start <span class="op">&amp;</span><span class="st"> </span>fw_dhl_vpts<span class="op">$</span>datetime <span class="op">&lt;=</span><span class="st"> </span>end) <span class="co"># Should mostly be identical</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"></a>
<a class="sourceLine" id="cb8-7" data-line-number="7">title_hrw &lt;-<span class="st"> </span><span class="kw">expression</span>(<span class="st">&quot;Herwijnen: volume density [#/km&quot;</span><span class="op">^</span><span class="dv">3</span> <span class="op">*</span><span class="st"> &quot;]&quot;</span>)</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">title_dhl &lt;-<span class="st"> </span><span class="kw">expression</span>(<span class="st">&quot;Den Helder: volume density [#/km&quot;</span><span class="op">^</span><span class="dv">3</span> <span class="op">*</span><span class="st"> &quot;]&quot;</span>)</a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="kw">plot</span>(fw_hrw_vpts[indexes_hrw], <span class="dt">main =</span> title_hrw)</a></code></pre></div>
<p><img src="Fireworks_files/figure-html/generate_vp_timeseries-1.png" width="672" /></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">plot</span>(fw_dhl_vpts[indexes_dhl], <span class="dt">main =</span> title_dhl)</a></code></pre></div>
<p><img src="Fireworks_files/figure-html/generate_vp_timeseries-2.png" width="672" /></p>
<p>Both plots for Herwijnen and Den Helder show exactly what we would expect: fairly low densities of birds aloft leading up to midnight (23:00 CET), then suddenly a strong increase of birds right after midnight. For Herwijnen this peak is much more pronounced than for Den Helder, probably due to the different surroundings of the radar. As <code>vol2bird</code> only takes into account rangegates within 5-35km of the radar, in the case of Den Helder this contains a lot more sea surface, from which fewer birds can be expected to take off than from land.</p>
</div>
<div id="identifying-moment-of-take-off" class="section level2">
<h2><span class="header-section-number">1.4</span> Identifying moment of take-off</h2>
<p>We integrate the time series of vertical profiles, so we can calculate the <code>vir</code> derivatives and determine in what volume scan birds really take to the skies for each radar separately.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">integrated_hrw &lt;-<span class="st"> </span><span class="kw">integrate_profile</span>(fw_hrw_vpts)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">integrated_dhl &lt;-<span class="st"> </span><span class="kw">integrate_profile</span>(fw_dhl_vpts)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"></a>
<a class="sourceLine" id="cb10-4" data-line-number="4">integrated_hrw<span class="op">$</span>vir_deriv &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">NA</span>, <span class="kw">diff</span>(integrated_hrw<span class="op">$</span>vir, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">integrated_dhl<span class="op">$</span>vir_deriv &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">NA</span>, <span class="kw">diff</span>(integrated_dhl<span class="op">$</span>vir, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb10-6" data-line-number="6"></a>
<a class="sourceLine" id="cb10-7" data-line-number="7">integrated_hrw<span class="op">$</span>radar &lt;-<span class="st"> &quot;Herwijnen&quot;</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8">integrated_dhl<span class="op">$</span>radar &lt;-<span class="st"> &quot;Den Helder&quot;</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"></a>
<a class="sourceLine" id="cb10-10" data-line-number="10">integrated &lt;-<span class="st"> </span><span class="kw">rbind</span>(integrated_hrw, integrated_dhl)</a>
<a class="sourceLine" id="cb10-11" data-line-number="11"></a>
<a class="sourceLine" id="cb10-12" data-line-number="12">integrated_l &lt;-<span class="st"> </span>integrated <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span><span class="kw">c</span>(<span class="st">&quot;datetime&quot;</span>, <span class="st">&quot;radar&quot;</span>), <span class="dt">names_to =</span> <span class="st">&quot;variable&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="st">  </span><span class="kw">filter</span>(variable <span class="op">==</span><span class="st"> &quot;vir&quot;</span> <span class="op">|</span><span class="st"> </span>variable <span class="op">==</span><span class="st"> &quot;vir_deriv&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="st">  </span><span class="kw">filter</span>(datetime <span class="op">&gt;=</span><span class="st"> </span>start <span class="op">&amp;</span><span class="st"> </span>datetime <span class="op">&lt;=</span><span class="st"> </span>end)</a>
<a class="sourceLine" id="cb10-16" data-line-number="16"></a>
<a class="sourceLine" id="cb10-17" data-line-number="17">max_vir_deriv &lt;-<span class="st"> </span>integrated_l <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-18" data-line-number="18"><span class="st">  </span><span class="kw">group_by</span>(variable, radar) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-19" data-line-number="19"><span class="st">  </span><span class="kw">filter</span>(variable <span class="op">==</span><span class="st"> &quot;vir_deriv&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-20" data-line-number="20"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">max_value =</span> <span class="kw">max</span>(value), <span class="dt">datetime =</span> datetime[<span class="kw">which.max</span>(value)]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-21" data-line-number="21"><span class="st">  </span><span class="kw">arrange</span>(radar)  <span class="co"># Sort so order remains the same</span></a>
<a class="sourceLine" id="cb10-22" data-line-number="22"></a>
<a class="sourceLine" id="cb10-23" data-line-number="23"><span class="kw">theme_set</span>(<span class="kw">theme_bw</span>())</a>
<a class="sourceLine" id="cb10-24" data-line-number="24"><span class="kw">ggplot</span>(integrated_l, <span class="kw">aes</span>(<span class="dt">x =</span> datetime)) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-25" data-line-number="25"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> value, <span class="dt">colour =</span> radar, <span class="dt">linetype =</span> variable)) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-26" data-line-number="26"><span class="st">  </span><span class="kw">scale_x_datetime</span>(<span class="dt">breaks =</span> <span class="st">&quot;10 min&quot;</span>, <span class="dt">date_labels =</span> <span class="st">&quot;%H:%M&quot;</span>, <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-27" data-line-number="27"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-28" data-line-number="28"><span class="st">  </span><span class="kw">scale_linetype_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;Line type&quot;</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;VIR&quot;</span>, <span class="kw">expression</span>(<span class="kw">paste</span>(Delta,<span class="st">&quot;VIR/scan&quot;</span>)))) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-29" data-line-number="29"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Time series of Vertically Integrated Reflectivities (VIR)&quot;</span>,</a>
<a class="sourceLine" id="cb10-30" data-line-number="30">       <span class="dt">subtitle =</span> <span class="st">&quot;NYE 2017-2018&quot;</span>,</a>
<a class="sourceLine" id="cb10-31" data-line-number="31">       <span class="dt">x =</span> <span class="st">&quot;Time (CET)&quot;</span>,</a>
<a class="sourceLine" id="cb10-32" data-line-number="32">       <span class="dt">y =</span> <span class="st">&quot;VIR&quot;</span>,</a>
<a class="sourceLine" id="cb10-33" data-line-number="33">       <span class="dt">colour =</span> <span class="st">&quot;Radar&quot;</span>,</a>
<a class="sourceLine" id="cb10-34" data-line-number="34">       <span class="dt">linetype =</span> <span class="st">&quot;Linetype&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-35" data-line-number="35"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">-90</span>),</a>
<a class="sourceLine" id="cb10-36" data-line-number="36">        <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="Fireworks_files/figure-html/identify_takeoff-1.png" width="672" /></p>
<p>The plot shows <span class="math inline">\(\Delta VIR/{scan}\)</span> peaks earlier for the Den Helder radar than for Herwijnen, but both at roughly the same level of 1066 and 991 respectively.</p>
<p>We can now identify which scans ‘contain’ the moment of take-off. The datetime values correspond with the start times of the scans and the filenames of the polar volume files.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">max_vir_deriv[, <span class="dv">2</span><span class="op">:</span><span class="dv">4</span>]</a></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">radar</th>
<th align="right">max_value</th>
<th align="left">datetime</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Den Helder</td>
<td align="right">1066.0071</td>
<td align="left">2017-12-31 23:05:04</td>
</tr>
<tr class="even">
<td align="left">Herwijnen</td>
<td align="right">991.1317</td>
<td align="left">2017-12-31 23:10:04</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">pvol_folder &lt;-<span class="st"> &quot;data/raw/pvol/fireworks-2017-2018/&quot;</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">hrw_dt_str &lt;-<span class="st"> </span><span class="kw">strftime</span>(max_vir_deriv[[<span class="dv">2</span>, <span class="dv">4</span>]], <span class="dt">format =</span> <span class="st">&quot;%Y%m%d%H%M&quot;</span>)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">dhl_dt_str &lt;-<span class="st"> </span><span class="kw">strftime</span>(max_vir_deriv[[<span class="dv">1</span>, <span class="dv">4</span>]], <span class="dt">format =</span> <span class="st">&quot;%Y%m%d%H%M&quot;</span>)</a>
<a class="sourceLine" id="cb12-4" data-line-number="4"></a>
<a class="sourceLine" id="cb12-5" data-line-number="5">pvol_hrw_path &lt;-<span class="st"> </span><span class="kw">paste</span>(pvol_folder, <span class="st">&quot;RAD_NL62_VOL_NA_&quot;</span>, hrw_dt_str, <span class="st">&quot;_ODIM.h5&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">pvol_dhl_path &lt;-<span class="st"> </span><span class="kw">paste</span>(pvol_folder, <span class="st">&quot;RAD_NL61_VOL_NA_&quot;</span>, dhl_dt_str, <span class="st">&quot;_ODIM.h5&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb12-7" data-line-number="7"></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="kw">save</span>(pvol_hrw_path, pvol_dhl_path, <span class="dt">file =</span> <span class="st">&quot;data/processed/pvol_selection.RData&quot;</span>)</a></code></pre></div>
<p>So we will continue using the following files in this study:</p>
<ul>
<li><strong>Herwijnen</strong>: <code>RAD_NL62_VOL_NA_201712312310_ODIM.h5</code></li>
<li><strong>Den Helder</strong>: <code>RAD_NL61_VOL_NA_201712312305_ODIM.h5</code></li>
</ul>
</div>
<div id="references" class="section level2 unnumbered">
<h2>References</h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="02.Radar-data-preprocessing.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/lunr.js"></script>
<script src="assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/barthoekstra/fireworks/edit/master/01.Selecting-take-off-moments.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/barthoekstra/fireworks/blob/master/01.Selecting-take-off-moments.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true,
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
