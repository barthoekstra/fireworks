<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Processing count results | Fireworks</title>
  <meta name="description" content="Using ground-based bird counts and weather radar measurements to estimate numbers of birds aloft during NYE fireworks events." />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Processing count results | Fireworks" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Using ground-based bird counts and weather radar measurements to estimate numbers of birds aloft during NYE fireworks events." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Processing count results | Fireworks" />
  
  <meta name="twitter:description" content="Using ground-based bird counts and weather radar measurements to estimate numbers of birds aloft during NYE fireworks events." />
  

<meta name="author" content="Bart Hoekstra" />


<meta name="date" content="2020-10-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="04.Annotate-count-areas.html"/>
<link rel="next" href="06.Applying-annotations-to-all-PPIs.html"/>
<script src="assets/jquery-2.2.3/jquery.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="assets/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="assets/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="assets/typedarray-0.1/typedarray.min.js"></script>
<link href="assets/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="assets/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="assets/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="assets/plotly-main-1.52.2/plotly-latest.min.js"></script>
<link href="assets/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="assets/leaflet-1.3.1/leaflet.js"></script>
<link href="assets/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="assets/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="assets/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="assets/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="assets/leaflet-binding-2.0.3/leaflet.js"></script>
<script src="assets/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="assets/leaflet-providers-plugin-2.0.3/leaflet-providers-plugin.js"></script>
<script src="assets/layer.1-1/data_stars_layer16d1478.txt"></script>
<script src="assets/joda-0.0.1/joda.js"></script>
<script src="assets/joda-0.0.1/addImageQuery-bindings.js"></script>
<script src="assets/clipboard-0.0.1/setClipboardText.js"></script>
<link href="assets/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="assets/HomeButton-0.0.1/home-button.js"></script>
<script src="assets/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="assets/layer.2-1/data_stars_layer2eb4a93.txt"></script>
<script src="assets/layer.3-1/data_stars_layer317d950.txt"></script>
<script src="assets/layer.4-1/data_stars_layer4caf51d.txt"></script>
<script src="assets/layer.5-1/data_stars_layer580e295.txt"></script>
<script src="assets/layer.6-1/data_stars_layer6ef038d.txt"></script>
<script src="assets/layer.7-1/data_stars_layer7364f1b.txt"></script>
<script src="assets/layer.8-1/data_stars_layer884e0a1.txt"></script>
<script src="assets/layer.9-1/data_stars_layer97d5f83.txt"></script>
<script src="assets/layer.10-1/data_stars_layer10871da5.txt"></script>
<script src="assets/urban-1/data_stars_urban2bef87.txt"></script>
<script src="assets/agricultural-1/data_stars_agricultural293ad5.txt"></script>
<script src="assets/semiopen-1/data_stars_semiopen31d5c6.txt"></script>
<script src="assets/forests-1/data_stars_forestsdec7f1.txt"></script>
<script src="assets/wetlands-1/data_stars_wetlands86a0e3.txt"></script>
<script src="assets/waterbodies-1/data_stars_waterbodiesec61d2.txt"></script>
<script src="assets/dist_urban-1/data_stars_dist_urban961c43.txt"></script>
<script src="assets/human_pop-1/data_stars_human_pop6eaf30.txt"></script>
<script src="assets/kePrint-0.0.1/kePrint.js"></script>
<script src="assets/resid-1/data_stars_stars715e20.txt"></script>
<link href="assets/jquery-ui-1.10.3/jquery-ui-1.10.3.custom.min.css" rel="stylesheet" />
<script src="assets/jquery-ui-1.10.3/jquery-ui-1.10.3.custom.min.js"></script>
<link href="assets/opacity-1.0.0/Control.Opacity.css" rel="stylesheet" />
<script src="assets/opacity-1.0.0/Control.Opacity.js"></script>
<script src="assets/local_sa-1/data_stars_local_sa6eb47d.txt"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#abstract"><i class="fa fa-check"></i>Abstract</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-use-this-document"><i class="fa fa-check"></i>How to use this document</a></li>
</ul></li>
<li class="part"><span><b>I Weather radar data</b></span></li>
<li class="chapter" data-level="1" data-path="01.Selecting-take-off-moments.html"><a href="01.Selecting-take-off-moments.html"><i class="fa fa-check"></i><b>1</b> Selecting firework take-off moment</a><ul>
<li class="chapter" data-level="1.1" data-path="01.Selecting-take-off-moments.html"><a href="01.Selecting-take-off-moments.html#processing-environment"><i class="fa fa-check"></i><b>1.1</b> Processing environment</a></li>
<li class="chapter" data-level="1.2" data-path="01.Selecting-take-off-moments.html"><a href="01.Selecting-take-off-moments.html#calculate-the-vertical-profiles"><i class="fa fa-check"></i><b>1.2</b> Calculate the vertical profiles</a></li>
<li class="chapter" data-level="1.3" data-path="01.Selecting-take-off-moments.html"><a href="01.Selecting-take-off-moments.html#generate-time-series-of-vertical-profiles"><i class="fa fa-check"></i><b>1.3</b> Generate time series of vertical profiles</a></li>
<li class="chapter" data-level="1.4" data-path="01.Selecting-take-off-moments.html"><a href="01.Selecting-take-off-moments.html#identifying-moment-of-take-off"><i class="fa fa-check"></i><b>1.4</b> Identifying moment of take-off</a></li>
<li class="chapter" data-level="1.5" data-path="01.Selecting-take-off-moments.html"><a href="01.Selecting-take-off-moments.html#determining-maximum-range-from-radar-to-detect-birds"><i class="fa fa-check"></i><b>1.5</b> Determining maximum range from radar to detect birds</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html"><i class="fa fa-check"></i><b>2</b> Radar Data Preprocessing</a><ul>
<li class="chapter" data-level="2.1" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#processing-environment-1"><i class="fa fa-check"></i><b>2.1</b> Processing environment</a></li>
<li class="chapter" data-level="2.2" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#removing-electromagnetic-interference"><i class="fa fa-check"></i><b>2.2</b> Removing electromagnetic interference</a></li>
<li class="chapter" data-level="2.3" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#filter-meteorology-using-the-depolarization-ratio"><i class="fa fa-check"></i><b>2.3</b> Filter meteorology using the depolarization ratio</a></li>
<li class="chapter" data-level="2.4" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#remove-classified-precipitation-from-polar-volumes"><i class="fa fa-check"></i><b>2.4</b> Remove classified precipitation from polar volumes</a></li>
<li class="chapter" data-level="2.5" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#filter-ground-clutter"><i class="fa fa-check"></i><b>2.5</b> Filter ground clutter</a></li>
<li class="chapter" data-level="2.6" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#range-bias-correction"><i class="fa fa-check"></i><b>2.6</b> Range-bias correction</a></li>
<li class="chapter" data-level="2.7" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#keep-biologymeteorology-classification"><i class="fa fa-check"></i><b>2.7</b> Keep biology/meteorology classification</a></li>
<li class="chapter" data-level="2.8" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#distance-to-radar"><i class="fa fa-check"></i><b>2.8</b> Distance to radar</a></li>
<li class="chapter" data-level="2.9" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#spatial-coordinates"><i class="fa fa-check"></i><b>2.9</b> Spatial coordinates</a></li>
<li class="chapter" data-level="2.10" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#visualising-range-bias-correction"><i class="fa fa-check"></i><b>2.10</b> Visualising range-bias correction</a></li>
<li class="chapter" data-level="2.11" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#preprocess-additional-scans"><i class="fa fa-check"></i><b>2.11</b> Preprocess additional scans</a></li>
</ul></li>
<li class="part"><span><b>II Land use</b></span></li>
<li class="chapter" data-level="3" data-path="03.Annotate-land-use.html"><a href="03.Annotate-land-use.html"><i class="fa fa-check"></i><b>3</b> Annotating land use</a><ul>
<li class="chapter" data-level="3.1" data-path="03.Annotate-land-use.html"><a href="03.Annotate-land-use.html#processing-environment-2"><i class="fa fa-check"></i><b>3.1</b> Processing environment</a></li>
<li class="chapter" data-level="3.2" data-path="03.Annotate-land-use.html"><a href="03.Annotate-land-use.html#converting-the-land-use-map"><i class="fa fa-check"></i><b>3.2</b> Converting the land use map</a></li>
<li class="chapter" data-level="3.3" data-path="03.Annotate-land-use.html"><a href="03.Annotate-land-use.html#adding-land-use-classifications-to-the-ppis"><i class="fa fa-check"></i><b>3.3</b> Adding land use classifications to the PPIs</a></li>
<li class="chapter" data-level="3.4" data-path="03.Annotate-land-use.html"><a href="03.Annotate-land-use.html#calculate-distance-to-nearest-urban-area"><i class="fa fa-check"></i><b>3.4</b> Calculate distance to nearest urban area</a></li>
<li class="chapter" data-level="3.5" data-path="03.Annotate-land-use.html"><a href="03.Annotate-land-use.html#add-population-density"><i class="fa fa-check"></i><b>3.5</b> Add population density</a></li>
</ul></li>
<li class="part"><span><b>III Sovon counts</b></span></li>
<li class="chapter" data-level="4" data-path="04.Annotate-count-areas.html"><a href="04.Annotate-count-areas.html"><i class="fa fa-check"></i><b>4</b> Annotating count areas</a><ul>
<li class="chapter" data-level="4.1" data-path="04.Annotate-count-areas.html"><a href="04.Annotate-count-areas.html#processing-environment-3"><i class="fa fa-check"></i><b>4.1</b> Processing environment</a></li>
<li class="chapter" data-level="4.2" data-path="04.Annotate-count-areas.html"><a href="04.Annotate-count-areas.html#annotate-ppis-with-waterbird-area-codes"><i class="fa fa-check"></i><b>4.2</b> Annotate PPIs with waterbird area codes</a></li>
<li class="chapter" data-level="4.3" data-path="04.Annotate-count-areas.html"><a href="04.Annotate-count-areas.html#annotate-ppis-with-point-transect-counts"><i class="fa fa-check"></i><b>4.3</b> Annotate PPIs with point-transect-counts</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="05.Processing-count-results.html"><a href="05.Processing-count-results.html"><i class="fa fa-check"></i><b>5</b> Processing count results</a><ul>
<li class="chapter" data-level="5.1" data-path="05.Processing-count-results.html"><a href="05.Processing-count-results.html#processing-environment-4"><i class="fa fa-check"></i><b>5.1</b> Processing environment</a></li>
<li class="chapter" data-level="5.2" data-path="05.Processing-count-results.html"><a href="05.Processing-count-results.html#loading-the-sovon-count-data"><i class="fa fa-check"></i><b>5.2</b> Loading the Sovon count data</a></li>
<li class="chapter" data-level="5.3" data-path="05.Processing-count-results.html"><a href="05.Processing-count-results.html#filteringpreprocessing-species-names"><i class="fa fa-check"></i><b>5.3</b> Filtering/preprocessing species names</a></li>
<li class="chapter" data-level="5.4" data-path="05.Processing-count-results.html"><a href="05.Processing-count-results.html#adding-vernacular-family-names"><i class="fa fa-check"></i><b>5.4</b> Adding vernacular family names</a></li>
<li class="chapter" data-level="5.5" data-path="05.Processing-count-results.html"><a href="05.Processing-count-results.html#linking-life-history-traits-to-species"><i class="fa fa-check"></i><b>5.5</b> Linking life-history traits to species</a></li>
<li class="chapter" data-level="5.6" data-path="05.Processing-count-results.html"><a href="05.Processing-count-results.html#calculating-total-bird-biomass"><i class="fa fa-check"></i><b>5.6</b> Calculating total bird biomass</a></li>
<li class="chapter" data-level="5.7" data-path="05.Processing-count-results.html"><a href="05.Processing-count-results.html#calculating-proportions-across-bird-families"><i class="fa fa-check"></i><b>5.7</b> Calculating proportions across bird families</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="06.Applying-annotations-to-all-PPIs.html"><a href="06.Applying-annotations-to-all-PPIs.html"><i class="fa fa-check"></i><b>6</b> Apply processing to all PPIs</a><ul>
<li class="chapter" data-level="6.1" data-path="06.Applying-annotations-to-all-PPIs.html"><a href="06.Applying-annotations-to-all-PPIs.html#processing-environment-5"><i class="fa fa-check"></i><b>6.1</b> Processing environment</a></li>
<li class="chapter" data-level="6.2" data-path="06.Applying-annotations-to-all-PPIs.html"><a href="06.Applying-annotations-to-all-PPIs.html#load-the-reference-ppis"><i class="fa fa-check"></i><b>6.2</b> Load the reference PPIs</a></li>
<li class="chapter" data-level="6.3" data-path="06.Applying-annotations-to-all-PPIs.html"><a href="06.Applying-annotations-to-all-PPIs.html#add-biomass-to-reference-ppis"><i class="fa fa-check"></i><b>6.3</b> Add biomass to reference PPIs</a></li>
<li class="chapter" data-level="6.4" data-path="06.Applying-annotations-to-all-PPIs.html"><a href="06.Applying-annotations-to-all-PPIs.html#copy-annotations-from-reference-ppis-to-other-ppis"><i class="fa fa-check"></i><b>6.4</b> Copy annotations from reference PPIs to other PPIs</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="07.Composite-all-PPIs.html"><a href="07.Composite-all-PPIs.html"><i class="fa fa-check"></i><b>7</b> Composite all PPIs</a><ul>
<li class="chapter" data-level="7.1" data-path="07.Composite-all-PPIs.html"><a href="07.Composite-all-PPIs.html#processing-environment-6"><i class="fa fa-check"></i><b>7.1</b> Processing environment</a></li>
<li class="chapter" data-level="7.2" data-path="07.Composite-all-PPIs.html"><a href="07.Composite-all-PPIs.html#generating-the-composite-ppis"><i class="fa fa-check"></i><b>7.2</b> Generating the composite PPIs</a></li>
<li class="chapter" data-level="7.3" data-path="07.Composite-all-PPIs.html"><a href="07.Composite-all-PPIs.html#visualising-the-composites"><i class="fa fa-check"></i><b>7.3</b> Visualising the composites</a></li>
</ul></li>
<li class="part"><span><b>IV Fireworks disturbance</b></span></li>
<li class="chapter" data-level="8" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html"><i class="fa fa-check"></i><b>8</b> Modelling fireworks disturbance</a><ul>
<li class="chapter" data-level="8.1" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#processing-environment-7"><i class="fa fa-check"></i><b>8.1</b> Processing environment</a></li>
<li class="chapter" data-level="8.2" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#preparing-a-dataset-for-modelling"><i class="fa fa-check"></i><b>8.2</b> Preparing a dataset for modelling</a></li>
<li class="chapter" data-level="8.3" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#determine-model-resolution-based-on-performance-in-simple-total_biomass-model"><i class="fa fa-check"></i><b>8.3</b> Determine model resolution based on performance in simple <code>total_biomass</code> model</a></li>
<li class="chapter" data-level="8.4" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#check-for-correlations-among-predictors"><i class="fa fa-check"></i><b>8.4</b> Check for correlations among predictors</a></li>
<li class="chapter" data-level="8.5" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#correlated-land-use-proportions"><i class="fa fa-check"></i><b>8.5</b> Correlated land use proportions</a></li>
<li class="chapter" data-level="8.6" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#determine-the-most-suitable-proxy-for-disturbance"><i class="fa fa-check"></i><b>8.6</b> Determine the most suitable proxy for disturbance</a></li>
<li class="chapter" data-level="8.7" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#determine-the-optimal-number-of-boosting-steps"><i class="fa fa-check"></i><b>8.7</b> Determine the optimal number of boosting steps</a></li>
<li class="chapter" data-level="8.8" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#variable-importance"><i class="fa fa-check"></i><b>8.8</b> Variable importance</a></li>
<li class="chapter" data-level="8.9" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#model-marginal-effects"><i class="fa fa-check"></i><b>8.9</b> Model marginal effects</a></li>
<li class="chapter" data-level="8.10" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#spatial-autocorrelation"><i class="fa fa-check"></i><b>8.10</b> Spatial autocorrelation</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="09.Quantifying-model-uncertainty.html"><a href="09.Quantifying-model-uncertainty.html"><i class="fa fa-check"></i><b>9</b> Quantifying model uncertainty</a><ul>
<li class="chapter" data-level="9.1" data-path="09.Quantifying-model-uncertainty.html"><a href="09.Quantifying-model-uncertainty.html#processing-environment-8"><i class="fa fa-check"></i><b>9.1</b> Processing environment</a></li>
<li class="chapter" data-level="9.2" data-path="09.Quantifying-model-uncertainty.html"><a href="09.Quantifying-model-uncertainty.html#load-the-constructed-model"><i class="fa fa-check"></i><b>9.2</b> Load the constructed model</a></li>
<li class="chapter" data-level="9.3" data-path="09.Quantifying-model-uncertainty.html"><a href="09.Quantifying-model-uncertainty.html#bootstrapped-uncertainty-analysis"><i class="fa fa-check"></i><b>9.3</b> Bootstrapped uncertainty analysis</a></li>
<li class="chapter" data-level="9.4" data-path="09.Quantifying-model-uncertainty.html"><a href="09.Quantifying-model-uncertainty.html#recombine-bootstrapped-results"><i class="fa fa-check"></i><b>9.4</b> Recombine bootstrapped results</a></li>
</ul></li>
<li class="part"><span><b>V Figures</b></span></li>
<li class="chapter" data-level="10" data-path="10.Figures-1-Data-overview.html"><a href="10.Figures-1-Data-overview.html"><i class="fa fa-check"></i><b>10</b> Figure 1: Data overview</a><ul>
<li class="chapter" data-level="10.1" data-path="10.Figures-1-Data-overview.html"><a href="10.Figures-1-Data-overview.html#processing-environment-9"><i class="fa fa-check"></i><b>10.1</b> Processing environment</a></li>
<li class="chapter" data-level="10.2" data-path="10.Figures-1-Data-overview.html"><a href="10.Figures-1-Data-overview.html#workflow"><i class="fa fa-check"></i><b>10.2</b> Workflow</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="10.Figures-2-Model.html"><a href="10.Figures-2-Model.html"><i class="fa fa-check"></i><b>11</b> Figure 2: Model output</a><ul>
<li class="chapter" data-level="11.1" data-path="10.Figures-2-Model.html"><a href="10.Figures-2-Model.html#processing-environment-10"><i class="fa fa-check"></i><b>11.1</b> Processing environment</a></li>
<li class="chapter" data-level="11.2" data-path="10.Figures-2-Model.html"><a href="10.Figures-2-Model.html#variable-importance-1"><i class="fa fa-check"></i><b>11.2</b> Variable importance</a></li>
<li class="chapter" data-level="11.3" data-path="10.Figures-2-Model.html"><a href="10.Figures-2-Model.html#visualise-marginal-effects"><i class="fa fa-check"></i><b>11.3</b> Visualise marginal effects</a></li>
<li class="chapter" data-level="11.4" data-path="10.Figures-2-Model.html"><a href="10.Figures-2-Model.html#all-marginal-effects"><i class="fa fa-check"></i><b>11.4</b> All marginal effects</a></li>
</ul></li>
<li class="part"><span><b>VI Visualizations</b></span></li>
<li class="chapter" data-level="12" data-path="10.Figures-3-Species-composition.html"><a href="10.Figures-3-Species-composition.html"><i class="fa fa-check"></i><b>12</b> Visualizing species composition</a></li>
<li class="part"><span><b>VII Appendix</b></span></li>
<li class="chapter" data-level="13" data-path="A1.Generating-VPs-for-Den-Helder-radar.html"><a href="A1.Generating-VPs-for-Den-Helder-radar.html"><i class="fa fa-check"></i><b>13</b> Generating vertical profiles for Den Helder radar</a></li>
<li class="part"><span><b>VIII Other</b></span></li>
<li class="chapter" data-level="14" data-path="References.html"><a href="References.html"><i class="fa fa-check"></i><b>14</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Fireworks</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="processing-count-results" class="section level1">
<h1><span class="header-section-number">5</span> Processing count results</h1>
<p>For now, we are interested in calculating the following parameters for the count results:</p>
<ol style="list-style-type: decimal">
<li>The number of birds within every PPI pixel.</li>
<li>The average mass of the birds within every PPI pixel.</li>
</ol>
<p>We can derive the total numbers of birds comparatively easily from the bird counts by Sovon, but to calculate the average mass of the birds we need to link a database of life-history traits. For the latter we first need to translate the vernacular (modern) names of bird species (used by Sovon) to the scientific ones, so we can link both.</p>
<div id="processing-environment-4" class="section level2">
<h2><span class="header-section-number">5.1</span> Processing environment</h2>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" data-line-number="1"><span class="kw">library</span>(rgbif)</a>
<a class="sourceLine" id="cb104-2" data-line-number="2"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb104-3" data-line-number="3"><span class="kw">library</span>(readxl)</a>
<a class="sourceLine" id="cb104-4" data-line-number="4"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb104-5" data-line-number="5"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb104-6" data-line-number="6"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb104-7" data-line-number="7"><span class="kw">library</span>(kableExtra)</a></code></pre></div>
</div>
<div id="loading-the-sovon-count-data" class="section level2">
<h2><span class="header-section-number">5.2</span> Loading the Sovon count data</h2>
<p>The count data is spread over a few sheets in an <code>xlsx</code> file, which we load here. For clarity, we rename all the columns to English and we filter out all counts (i.e. areas) where birds are not positively identified to species level. Although it would be possible to ‘fill’ these uncertain counts based on proportions, determining how to do that is not necessary for our purposes. Instead, we will just remove these counts altogether. Finally, subspecies identifiers for these species are removed, as we assume variation is limited and the database of life-history traits does not contain parameters for subspecies separately.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" data-line-number="1">sovon_data &lt;-<span class="st"> &quot;data/raw/sovon/tel_dec_jan_1718.xlsx&quot;</span></a>
<a class="sourceLine" id="cb105-2" data-line-number="2"></a>
<a class="sourceLine" id="cb105-3" data-line-number="3">data &lt;-<span class="st"> </span><span class="kw">data.frame</span>()</a>
<a class="sourceLine" id="cb105-4" data-line-number="4">sheets &lt;-<span class="st"> </span><span class="kw">excel_sheets</span>(sovon_data)</a>
<a class="sourceLine" id="cb105-5" data-line-number="5">sheets &lt;-<span class="st"> </span>sheets[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)]  <span class="co"># Sheet 1 and 5 contain PTT and roost counts respectively, so we ignore these for now, as they have to be processed differently</span></a>
<a class="sourceLine" id="cb105-6" data-line-number="6"></a>
<a class="sourceLine" id="cb105-7" data-line-number="7"><span class="co"># Explicit column types to suppress warnings thrown because of lacking euring codes for records with no birds</span></a>
<a class="sourceLine" id="cb105-8" data-line-number="8">coltypes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;numeric&quot;</span>, <span class="st">&quot;text&quot;</span>, <span class="st">&quot;numeric&quot;</span>, <span class="st">&quot;numeric&quot;</span>, <span class="st">&quot;numeric&quot;</span>, <span class="st">&quot;numeric&quot;</span>, <span class="st">&quot;numeric&quot;</span>, <span class="st">&quot;numeric&quot;</span>, <span class="st">&quot;text&quot;</span>, <span class="st">&quot;numeric&quot;</span>, <span class="st">&quot;numeric&quot;</span>, <span class="st">&quot;numeric&quot;</span>)</a>
<a class="sourceLine" id="cb105-9" data-line-number="9"></a>
<a class="sourceLine" id="cb105-10" data-line-number="10"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(sheets)) {</a>
<a class="sourceLine" id="cb105-11" data-line-number="11">  data &lt;-<span class="st"> </span><span class="kw">rbind</span>(data, <span class="kw">read_excel</span>(sovon_data, <span class="dt">sheet =</span> sheets[i], <span class="dt">col_types =</span> coltypes))</a>
<a class="sourceLine" id="cb105-12" data-line-number="12">}</a>
<a class="sourceLine" id="cb105-13" data-line-number="13"></a>
<a class="sourceLine" id="cb105-14" data-line-number="14">data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb105-15" data-line-number="15"><span class="st">  </span><span class="kw">drop_na</span>() <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># A few rows somehow contain no birds or species &#39;geen vogels&#39;</span></a>
<a class="sourceLine" id="cb105-16" data-line-number="16"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">count_id =</span> TELLING_ID, <span class="dt">area_nr =</span> GEBIEDSCODE, <span class="dt">year =</span> JAAR, <span class="dt">month =</span> MAAND, <span class="dt">day =</span> DAG, <span class="dt">start_time =</span> BEGINTIJD, <span class="dt">end_time =</span> EINDTIJD,</a>
<a class="sourceLine" id="cb105-17" data-line-number="17">         <span class="st">&quot;euring&quot;</span> =<span class="st"> &quot;EURING&quot;</span>, <span class="dt">species =</span> SOORT, <span class="dt">number =</span> Aantal, <span class="dt">xcoor =</span> XCOOR, <span class="dt">ycoor =</span> YCOOR) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb105-18" data-line-number="18"><span class="st">  </span><span class="kw">group_by</span>(area_nr) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb105-19" data-line-number="19"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">any</span>(<span class="kw">str_ends</span>(species, <span class="st">&quot;spec.&quot;</span>))) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># Filter out all counts with unidentified birds</span></a>
<a class="sourceLine" id="cb105-20" data-line-number="20"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">any</span>(<span class="kw">length</span>(<span class="kw">str_subset</span>(species, <span class="st">&quot; of &quot;</span>)) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># Filter out all counts with either/or totals</span></a>
<a class="sourceLine" id="cb105-21" data-line-number="21"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">any</span>(<span class="kw">str_starts</span>(species, <span class="st">&quot;hybride&quot;</span>))) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># Filter out all counts with hybrids</span></a>
<a class="sourceLine" id="cb105-22" data-line-number="22"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb105-23" data-line-number="23"><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb105-24" data-line-number="24"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">species =</span> <span class="kw">str_split</span>(species, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">(&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_trim</span>()) -&gt;<span class="st"> </span>wb_data  <span class="co"># And remove all subspecies identifications</span></a>
<a class="sourceLine" id="cb105-25" data-line-number="25"></a>
<a class="sourceLine" id="cb105-26" data-line-number="26"><span class="kw">head</span>(wb_data, <span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb105-27" data-line-number="27"><span class="st">  </span><span class="kw">kable</span>(<span class="dt">format =</span> <span class="st">&quot;html&quot;</span>, <span class="dt">col.names =</span> <span class="kw">colnames</span>(wb_data)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb105-28" data-line-number="28"><span class="st">  </span><span class="kw">kable_styling</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb105-29" data-line-number="29"><span class="st">  </span>kableExtra<span class="op">::</span><span class="kw">scroll_box</span>(<span class="dt">width =</span> <span class="st">&quot;100%&quot;</span>, <span class="dt">height =</span> <span class="st">&quot;400px&quot;</span>)</a></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:400px; overflow-x: scroll; width:100%; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
count_id
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
area_nr
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
year
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
month
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
day
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
start_time
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
end_time
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
euring
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
species
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
number
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
xcoor
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ycoor
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1060908
</td>
<td style="text-align:left;">
BR1111
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1045
</td>
<td style="text-align:right;">
1108
</td>
<td style="text-align:right;">
1610
</td>
<td style="text-align:left;">
Grauwe Gans
</td>
<td style="text-align:right;">
280
</td>
<td style="text-align:right;">
127723
</td>
<td style="text-align:right;">
426233
</td>
</tr>
<tr>
<td style="text-align:right;">
1060908
</td>
<td style="text-align:left;">
BR1111
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1045
</td>
<td style="text-align:right;">
1108
</td>
<td style="text-align:right;">
1700
</td>
<td style="text-align:left;">
Nijlgans
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
127723
</td>
<td style="text-align:right;">
426233
</td>
</tr>
<tr>
<td style="text-align:right;">
1060909
</td>
<td style="text-align:left;">
BR1112
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1108
</td>
<td style="text-align:right;">
1126
</td>
<td style="text-align:right;">
1610
</td>
<td style="text-align:left;">
Grauwe Gans
</td>
<td style="text-align:right;">
76
</td>
<td style="text-align:right;">
125082
</td>
<td style="text-align:right;">
426701
</td>
</tr>
<tr>
<td style="text-align:right;">
1060909
</td>
<td style="text-align:left;">
BR1112
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1108
</td>
<td style="text-align:right;">
1126
</td>
<td style="text-align:right;">
1661
</td>
<td style="text-align:left;">
Grote Canadese Gans
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
125082
</td>
<td style="text-align:right;">
426701
</td>
</tr>
<tr>
<td style="text-align:right;">
1060909
</td>
<td style="text-align:left;">
BR1112
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1108
</td>
<td style="text-align:right;">
1126
</td>
<td style="text-align:right;">
1700
</td>
<td style="text-align:left;">
Nijlgans
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
125082
</td>
<td style="text-align:right;">
426701
</td>
</tr>
<tr>
<td style="text-align:right;">
1060906
</td>
<td style="text-align:left;">
BR1122
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1020
</td>
<td style="text-align:right;">
1037
</td>
<td style="text-align:right;">
1610
</td>
<td style="text-align:left;">
Grauwe Gans
</td>
<td style="text-align:right;">
250
</td>
<td style="text-align:right;">
125313
</td>
<td style="text-align:right;">
426061
</td>
</tr>
<tr>
<td style="text-align:right;">
1060906
</td>
<td style="text-align:left;">
BR1122
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1020
</td>
<td style="text-align:right;">
1037
</td>
<td style="text-align:right;">
1619
</td>
<td style="text-align:left;">
Soepgans
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
125313
</td>
<td style="text-align:right;">
426061
</td>
</tr>
<tr>
<td style="text-align:right;">
1060906
</td>
<td style="text-align:left;">
BR1122
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1020
</td>
<td style="text-align:right;">
1037
</td>
<td style="text-align:right;">
1661
</td>
<td style="text-align:left;">
Grote Canadese Gans
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
125313
</td>
<td style="text-align:right;">
426061
</td>
</tr>
<tr>
<td style="text-align:right;">
1060911
</td>
<td style="text-align:left;">
BR1130
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1145
</td>
<td style="text-align:right;">
1200
</td>
<td style="text-align:right;">
1610
</td>
<td style="text-align:left;">
Grauwe Gans
</td>
<td style="text-align:right;">
200
</td>
<td style="text-align:right;">
121962
</td>
<td style="text-align:right;">
426420
</td>
</tr>
<tr>
<td style="text-align:right;">
1060911
</td>
<td style="text-align:left;">
BR1130
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1145
</td>
<td style="text-align:right;">
1200
</td>
<td style="text-align:right;">
1661
</td>
<td style="text-align:left;">
Grote Canadese Gans
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
121962
</td>
<td style="text-align:right;">
426420
</td>
</tr>
</tbody>
</table>
</div>
<p>Following this logic, we can process the PTT counts similarly and see which species are contained in those.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" data-line-number="1"><span class="kw">read_excel</span>(sovon_data, <span class="dt">sheet =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb106-2" data-line-number="2"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">count_id =</span> tellingid, <span class="dt">route =</span> route, <span class="dt">count_point =</span> telpunt, <span class="dt">season =</span> seizoen, <span class="dt">year =</span> teljaar, <span class="dt">month =</span> maand, </a>
<a class="sourceLine" id="cb106-3" data-line-number="3">         <span class="dt">day =</span> dag, <span class="dt">euring =</span> euring, <span class="dt">species =</span> soort, <span class="dt">number =</span> aantal, <span class="dt">xcoor =</span> xcoor, <span class="dt">ycoor =</span> ycoor) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb106-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(route, count_point) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb106-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">any</span>(<span class="kw">str_ends</span>(species, <span class="st">&quot;spec.&quot;</span>))) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># Filter out all counts with unidentified birds</span></a>
<a class="sourceLine" id="cb106-6" data-line-number="6"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">any</span>(<span class="kw">length</span>(<span class="kw">str_subset</span>(species, <span class="st">&quot; of &quot;</span>)) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># Filter out all counts with either/or totals</span></a>
<a class="sourceLine" id="cb106-7" data-line-number="7"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">any</span>(<span class="kw">str_starts</span>(species, <span class="st">&quot;hybride&quot;</span>))) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># Filter out all counts with hybrids</span></a>
<a class="sourceLine" id="cb106-8" data-line-number="8"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb106-9" data-line-number="9"><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb106-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">species =</span> <span class="kw">str_split</span>(species, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">(&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_trim</span>()) -&gt;<span class="st"> </span>ptt_data  <span class="co"># And remove all subspecies identifications</span></a>
<a class="sourceLine" id="cb106-11" data-line-number="11"></a>
<a class="sourceLine" id="cb106-12" data-line-number="12"><span class="kw">head</span>(ptt_data, <span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb106-13" data-line-number="13"><span class="st">  </span><span class="kw">kable</span>(<span class="dt">format =</span> <span class="st">&quot;html&quot;</span>, <span class="dt">col.names =</span> <span class="kw">colnames</span>(ptt_data)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb106-14" data-line-number="14"><span class="st">  </span><span class="kw">kable_styling</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb106-15" data-line-number="15"><span class="st">  </span>kableExtra<span class="op">::</span><span class="kw">scroll_box</span>(<span class="dt">width =</span> <span class="st">&quot;100%&quot;</span>, <span class="dt">height =</span> <span class="st">&quot;400px&quot;</span>)</a></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:400px; overflow-x: scroll; width:100%; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
count_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
route
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
count_point
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
season
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
year
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
month
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
day
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
euring
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
species
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
number
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
xcoor
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ycoor
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
80917
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
720
</td>
<td style="text-align:left;">
Aalscholver
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
246342
</td>
<td style="text-align:right;">
520763
</td>
</tr>
<tr>
<td style="text-align:right;">
80917
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
5920
</td>
<td style="text-align:left;">
Zilvermeeuw
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
246342
</td>
<td style="text-align:right;">
520763
</td>
</tr>
<tr>
<td style="text-align:right;">
80917
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
6700
</td>
<td style="text-align:left;">
Houtduif
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
246342
</td>
<td style="text-align:right;">
520763
</td>
</tr>
<tr>
<td style="text-align:right;">
80917
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
11870
</td>
<td style="text-align:left;">
Merel
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
246342
</td>
<td style="text-align:right;">
520763
</td>
</tr>
<tr>
<td style="text-align:right;">
80917
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
15630
</td>
<td style="text-align:left;">
Roek
</td>
<td style="text-align:right;">
24
</td>
<td style="text-align:right;">
246342
</td>
<td style="text-align:right;">
520763
</td>
</tr>
<tr>
<td style="text-align:right;">
80917
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
6700
</td>
<td style="text-align:left;">
Houtduif
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
246357
</td>
<td style="text-align:right;">
522178
</td>
</tr>
<tr>
<td style="text-align:right;">
80917
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
11870
</td>
<td style="text-align:left;">
Merel
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
246357
</td>
<td style="text-align:right;">
522178
</td>
</tr>
<tr>
<td style="text-align:right;">
80917
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
15600
</td>
<td style="text-align:left;">
Kauw
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
246357
</td>
<td style="text-align:right;">
522178
</td>
</tr>
<tr>
<td style="text-align:right;">
80917
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
15630
</td>
<td style="text-align:left;">
Roek
</td>
<td style="text-align:right;">
78
</td>
<td style="text-align:right;">
246357
</td>
<td style="text-align:right;">
522178
</td>
</tr>
<tr>
<td style="text-align:right;">
80917
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
14620
</td>
<td style="text-align:left;">
Pimpelmees
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
246692
</td>
<td style="text-align:right;">
523139
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="filteringpreprocessing-species-names" class="section level2">
<h2><span class="header-section-number">5.3</span> Filtering/preprocessing species names</h2>
<p>The following section is the result of an iterative process aimed at matching species in our count data with species in the database of life-history characteristics. Unfortunately, automatic tools only get us so far, a bit of tweaking has to be done by hand. To reduce manual corrections needed, <em>only species to which &gt;1% of the birds belong in a single count</em> have been corrected manually. In other words: if a species which cannot be matched always accounts for less than 1% of the total number of birds within a count, this species is discarded from the whole dataset.</p>
<p>Besides the 1% criteria, both the waterbird and PTT counts contain some exotics (e.g. ‘Helmparelhoen’/Helmeted guineafowl) for which our life-history characteristics dataset does not contain any measurements anyways (there are others that we do have measurements of), some species that are very unlikely to ever take flight during NYE (e.g. ‘Kip’/Domesticated chicken) and some mammals for which the same applies. We will remove these from the dataset manually.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" data-line-number="1">exotics &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Helmparelhoen&quot;</span>, <span class="st">&quot;Kaapse Casarca&quot;</span>, <span class="st">&quot;Manengans&quot;</span>, <span class="st">&quot;Ringtaling&quot;</span>, <span class="st">&quot;Buffelkopeend&quot;</span>, <span class="st">&quot;Kokardezaagbek&quot;</span>, <span class="st">&quot;Chileense Flamingo&quot;</span>,</a>
<a class="sourceLine" id="cb107-2" data-line-number="2">             <span class="st">&quot;Kaapse Taling&quot;</span>, <span class="st">&quot;Bahamapijlstaart&quot;</span>, <span class="st">&quot;Muskuseend&quot;</span>, <span class="st">&quot;Zwarte Zwaan&quot;</span>, <span class="st">&quot;Knobbelgans&quot;</span>, <span class="st">&quot;Zwaangans&quot;</span>)</a>
<a class="sourceLine" id="cb107-3" data-line-number="3">unlikely_flight_candidate &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Kip&quot;</span>)</a>
<a class="sourceLine" id="cb107-4" data-line-number="4">mammals &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Damhert&quot;</span>, <span class="st">&quot;Haas&quot;</span>, <span class="st">&quot;Ree&quot;</span>, <span class="st">&quot;Bever&quot;</span>, <span class="st">&quot;Bruine Rat&quot;</span>, <span class="st">&quot;Muskusrat&quot;</span>, <span class="st">&quot;Mol&quot;</span>, <span class="st">&quot;Vos&quot;</span>, <span class="st">&quot;Kat&quot;</span>, <span class="st">&quot;Otter&quot;</span>, <span class="st">&quot;Grijze Zeehond&quot;</span>, <span class="st">&quot;Konijn&quot;</span>,</a>
<a class="sourceLine" id="cb107-5" data-line-number="5">             <span class="st">&quot;Eekhoorn&quot;</span>, <span class="st">&quot;Edelhert&quot;</span>, <span class="st">&quot;Gewone Zeehond&quot;</span>, <span class="st">&quot;Wild Zwijn&quot;</span>, <span class="st">&quot;Steenmarter&quot;</span>, <span class="st">&quot;Moeflon&quot;</span>)</a>
<a class="sourceLine" id="cb107-6" data-line-number="6">input_error &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Steltstrandloper&quot;</span>)</a>
<a class="sourceLine" id="cb107-7" data-line-number="7">remove_species &lt;-<span class="st"> </span><span class="kw">c</span>(exotics, unlikely_flight_candidate, mammals, input_error)</a>
<a class="sourceLine" id="cb107-8" data-line-number="8"></a>
<a class="sourceLine" id="cb107-9" data-line-number="9">ptt_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb107-10" data-line-number="10"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>species <span class="op">%in%</span><span class="st"> </span>remove_species) -&gt;<span class="st"> </span>ptt_data</a>
<a class="sourceLine" id="cb107-11" data-line-number="11"></a>
<a class="sourceLine" id="cb107-12" data-line-number="12">wb_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb107-13" data-line-number="13"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>species <span class="op">%in%</span><span class="st"> </span>remove_species) -&gt;<span class="st"> </span>wb_data</a></code></pre></div>
<p>With all these species removed or adjusted, we can create a species lookup table. We fetch the scientific names and corresponding GBIF species IDs from the <a href="https://doi.org/10.15468/rjdpzy">Checklist Dutch Species Register</a>, which is the GBIF dataset with key <code>4dd32523-a3a3-43b7-84df-4cda02f15cf7</code>. We furthermore remove all unnecessary information, such as subspecies from the scientific names as well.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" data-line-number="1">unique_species &lt;-<span class="st"> </span><span class="kw">unique</span>(<span class="kw">c</span>(wb_data<span class="op">$</span>species, ptt_data<span class="op">$</span>species))</a>
<a class="sourceLine" id="cb108-2" data-line-number="2"></a>
<a class="sourceLine" id="cb108-3" data-line-number="3">build_species_lut &lt;-<span class="st"> </span><span class="cf">function</span>(specieslist, <span class="dt">datasetKey =</span> <span class="ot">NULL</span>, <span class="dt">class_name =</span> <span class="ot">NULL</span>) {</a>
<a class="sourceLine" id="cb108-4" data-line-number="4">  <span class="co"># As this function can possibly return many different records, we pick the scientific name and GBIF ID (nubKey) that are the most</span></a>
<a class="sourceLine" id="cb108-5" data-line-number="5">  <span class="co"># common in the returned results. This should most often result in an OK result of the name lookup function.</span></a>
<a class="sourceLine" id="cb108-6" data-line-number="6">  Mode &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb108-7" data-line-number="7">    ux &lt;-<span class="st"> </span><span class="kw">unique</span>(<span class="kw">na.omit</span>(x))</a>
<a class="sourceLine" id="cb108-8" data-line-number="8">    ux[<span class="kw">which.max</span>(<span class="kw">tabulate</span>(<span class="kw">match</span>(x, ux)))]</a>
<a class="sourceLine" id="cb108-9" data-line-number="9">  }</a>
<a class="sourceLine" id="cb108-10" data-line-number="10">  </a>
<a class="sourceLine" id="cb108-11" data-line-number="11">  n &lt;-<span class="st"> </span><span class="kw">length</span>(specieslist)</a>
<a class="sourceLine" id="cb108-12" data-line-number="12">  </a>
<a class="sourceLine" id="cb108-13" data-line-number="13">  species_lut &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">lookupname =</span> <span class="kw">character</span>(n), </a>
<a class="sourceLine" id="cb108-14" data-line-number="14">                            <span class="dt">scientificname =</span> <span class="kw">character</span>(n), </a>
<a class="sourceLine" id="cb108-15" data-line-number="15">                            <span class="dt">gbif_key =</span> <span class="kw">numeric</span>(n), <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb108-16" data-line-number="16">  </a>
<a class="sourceLine" id="cb108-17" data-line-number="17">  <span class="co"># Somehow the higherTaxonKey changes regularly, so we have to query this first</span></a>
<a class="sourceLine" id="cb108-18" data-line-number="18">  higherTaxonKey &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb108-19" data-line-number="19">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(class_name)) {</a>
<a class="sourceLine" id="cb108-20" data-line-number="20">    class_record &lt;-<span class="st"> </span><span class="kw">name_lookup</span>(class_name, <span class="dt">datasetKey =</span> datasetKey)</a>
<a class="sourceLine" id="cb108-21" data-line-number="21">    higherTaxonKey &lt;-<span class="st"> </span>class_record<span class="op">$</span>data<span class="op">$</span>classKey</a>
<a class="sourceLine" id="cb108-22" data-line-number="22">  }</a>
<a class="sourceLine" id="cb108-23" data-line-number="23">  </a>
<a class="sourceLine" id="cb108-24" data-line-number="24">  <span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(specieslist)) {</a>
<a class="sourceLine" id="cb108-25" data-line-number="25">    gbif_data &lt;-<span class="st"> </span><span class="kw">tryCatch</span>({</a>
<a class="sourceLine" id="cb108-26" data-line-number="26">      gbif &lt;-<span class="st"> </span><span class="kw">name_lookup</span>(specieslist[i], </a>
<a class="sourceLine" id="cb108-27" data-line-number="27">                          <span class="dt">datasetKey =</span> datasetKey, </a>
<a class="sourceLine" id="cb108-28" data-line-number="28">                          <span class="dt">higherTaxonKey =</span> higherTaxonKey, </a>
<a class="sourceLine" id="cb108-29" data-line-number="29">                          <span class="dt">return =</span> <span class="st">&quot;data&quot;</span>)</a>
<a class="sourceLine" id="cb108-30" data-line-number="30">      </a>
<a class="sourceLine" id="cb108-31" data-line-number="31">      <span class="kw">list</span>(<span class="kw">paste</span>(<span class="kw">str_split</span>(<span class="kw">Mode</span>(gbif<span class="op">$</span>scientificName), <span class="dt">pattern =</span> <span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]][<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dt">collapse =</span> <span class="st">&quot; &quot;</span>), <span class="kw">Mode</span>(gbif<span class="op">$</span>nubKey))</a>
<a class="sourceLine" id="cb108-32" data-line-number="32">    }, <span class="dt">error =</span> <span class="cf">function</span>(e) {</a>
<a class="sourceLine" id="cb108-33" data-line-number="33">      <span class="kw">list</span>(<span class="st">&quot;&quot;</span>, <span class="ot">NaN</span>)</a>
<a class="sourceLine" id="cb108-34" data-line-number="34">    })</a>
<a class="sourceLine" id="cb108-35" data-line-number="35">    </a>
<a class="sourceLine" id="cb108-36" data-line-number="36">    species_lut[i, ] &lt;-<span class="st"> </span><span class="kw">c</span>(specieslist[i], gbif_data[<span class="dv">1</span>], <span class="kw">as.numeric</span>(<span class="kw">as.character</span>(gbif_data[<span class="dv">2</span>])))</a>
<a class="sourceLine" id="cb108-37" data-line-number="37">  }</a>
<a class="sourceLine" id="cb108-38" data-line-number="38">  </a>
<a class="sourceLine" id="cb108-39" data-line-number="39">  <span class="kw">return</span>(species_lut)</a>
<a class="sourceLine" id="cb108-40" data-line-number="40">}</a>
<a class="sourceLine" id="cb108-41" data-line-number="41"></a>
<a class="sourceLine" id="cb108-42" data-line-number="42">species_lut &lt;-<span class="st"> </span><span class="kw">build_species_lut</span>(unique_species, <span class="dt">datasetKey =</span> <span class="st">&quot;4dd32523-a3a3-43b7-84df-4cda02f15cf7&quot;</span>, <span class="dt">class_name =</span> <span class="st">&quot;Aves&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: Unknown or uninitialised column: `scientificName`.</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" data-line-number="1"><span class="kw">head</span>(species_lut, <span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb110-2" data-line-number="2"><span class="st">  </span><span class="kw">kable</span>(<span class="dt">format =</span> <span class="st">&quot;html&quot;</span>, <span class="dt">col.names =</span> <span class="kw">colnames</span>(species_lut)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb110-3" data-line-number="3"><span class="st">  </span><span class="kw">kable_styling</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb110-4" data-line-number="4"><span class="st">  </span>kableExtra<span class="op">::</span><span class="kw">scroll_box</span>(<span class="dt">width =</span> <span class="st">&quot;100%&quot;</span>, <span class="dt">height =</span> <span class="st">&quot;400px&quot;</span>)</a></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:400px; overflow-x: scroll; width:100%; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
lookupname
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
scientificname
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
gbif_key
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Grauwe Gans
</td>
<td style="text-align:left;">
Anser anser
</td>
<td style="text-align:right;">
2498036
</td>
</tr>
<tr>
<td style="text-align:left;">
Nijlgans
</td>
<td style="text-align:left;">
Alopochen aegyptiaca
</td>
<td style="text-align:right;">
2498252
</td>
</tr>
<tr>
<td style="text-align:left;">
Grote Canadese Gans
</td>
<td style="text-align:left;">
Branta canadensis
</td>
<td style="text-align:right;">
5232437
</td>
</tr>
<tr>
<td style="text-align:left;">
Soepgans
</td>
<td style="text-align:left;">
Anser anser
</td>
<td style="text-align:right;">
9384117
</td>
</tr>
<tr>
<td style="text-align:left;">
Brandgans
</td>
<td style="text-align:left;">
Branta leucopsis
</td>
<td style="text-align:right;">
5232464
</td>
</tr>
<tr>
<td style="text-align:left;">
Knobbelzwaan
</td>
<td style="text-align:left;">
Cygnus olor
</td>
<td style="text-align:right;">
2498343
</td>
</tr>
<tr>
<td style="text-align:left;">
Kolgans
</td>
<td style="text-align:left;">
Anser albifrons
</td>
<td style="text-align:right;">
2498017
</td>
</tr>
<tr>
<td style="text-align:left;">
Canadese Gans
</td>
<td style="text-align:left;">
Branta hutchinsii
</td>
<td style="text-align:right;">
5232460
</td>
</tr>
<tr>
<td style="text-align:left;">
Toendrarietgans
</td>
<td style="text-align:left;">
Anser serrirostris
</td>
<td style="text-align:right;">
9455781
</td>
</tr>
<tr>
<td style="text-align:left;">
Kleine Zwaan
</td>
<td style="text-align:left;">
Cygnus bewickii
</td>
<td style="text-align:right;">
4409105
</td>
</tr>
</tbody>
</table>
</div>
<p>Finally, the lookup table also contains some scientific names which unfortunately will not match with the life-history characteristics dataset, so these too we will adjust manually.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" data-line-number="1"><span class="co"># Change to similar species which is in the LHT database</span></a>
<a class="sourceLine" id="cb111-2" data-line-number="2">species_lut[species_lut<span class="op">$</span>lookupname <span class="op">==</span><span class="st"> &quot;Toendrarietgans&quot;</span>, <span class="st">&quot;scientificname&quot;</span>] &lt;-<span class="st"> &quot;Anser fabalis&quot;</span>  <span class="co"># Taiga Bean Goose</span></a>
<a class="sourceLine" id="cb111-3" data-line-number="3">species_lut[species_lut<span class="op">$</span>lookupname <span class="op">==</span><span class="st"> &quot;Kleine Canadese Gans&quot;</span>, <span class="st">&quot;scientificname&quot;</span>] &lt;-<span class="st"> &quot;Branta leucopsis&quot;</span>  <span class="co"># Barnacle Goose</span></a>
<a class="sourceLine" id="cb111-4" data-line-number="4">species_lut[species_lut<span class="op">$</span>lookupname <span class="op">==</span><span class="st"> &quot;Kleine Barmsijs&quot;</span>, <span class="st">&quot;scientificname&quot;</span>] &lt;-<span class="st"> &quot;Acanthis flammea&quot;</span>  <span class="co"># Redpoll</span></a>
<a class="sourceLine" id="cb111-5" data-line-number="5">species_lut[species_lut<span class="op">$</span>lookupname <span class="op">==</span><span class="st"> &quot;Pontische Meeuw&quot;</span>, <span class="st">&quot;scientificname&quot;</span>] &lt;-<span class="st"> &quot;Larus argentatus&quot;</span>  <span class="co"># Herring Gull</span></a>
<a class="sourceLine" id="cb111-6" data-line-number="6">species_lut[species_lut<span class="op">$</span>lookupname <span class="op">==</span><span class="st"> &quot;Indische Gans&quot;</span>, <span class="st">&quot;scientificname&quot;</span>] &lt;-<span class="st"> &quot;Anser albifrons&quot;</span>  <span class="co"># Greater White-fronted Goose</span></a>
<a class="sourceLine" id="cb111-7" data-line-number="7">species_lut[species_lut<span class="op">$</span>lookupname <span class="op">==</span><span class="st"> &quot;Canadese Gans&quot;</span>, <span class="st">&quot;scientificname&quot;</span>] &lt;-<span class="st"> &quot;Branta canadensis&quot;</span>  <span class="co"># Canada Goose</span></a>
<a class="sourceLine" id="cb111-8" data-line-number="8"></a>
<a class="sourceLine" id="cb111-9" data-line-number="9"><span class="co"># Change scientific name for same species to match with the LHT database</span></a>
<a class="sourceLine" id="cb111-10" data-line-number="10">species_lut[species_lut<span class="op">$</span>lookupname <span class="op">==</span><span class="st"> &quot;Kleine Zwaan&quot;</span>, <span class="st">&quot;scientificname&quot;</span>] &lt;-<span class="st"> &quot;Cygnus columbianus&quot;</span>  <span class="co"># Bewick&#39;s Swan</span></a>
<a class="sourceLine" id="cb111-11" data-line-number="11">species_lut[species_lut<span class="op">$</span>lookupname <span class="op">==</span><span class="st"> &quot;Kokmeeuw&quot;</span>, <span class="st">&quot;scientificname&quot;</span>] &lt;-<span class="st"> &quot;Larus ridibundus&quot;</span>  <span class="co"># Black-headed Gull</span></a>
<a class="sourceLine" id="cb111-12" data-line-number="12">species_lut[species_lut<span class="op">$</span>lookupname <span class="op">==</span><span class="st"> &quot;Smient&quot;</span>, <span class="st">&quot;scientificname&quot;</span>] &lt;-<span class="st"> &quot;Mareca penelope&quot;</span>  <span class="co"># Wigeon</span></a>
<a class="sourceLine" id="cb111-13" data-line-number="13">species_lut[species_lut<span class="op">$</span>lookupname <span class="op">==</span><span class="st"> &quot;Krakeend&quot;</span>, <span class="st">&quot;scientificname&quot;</span>] &lt;-<span class="st"> &quot;Mareca strepera&quot;</span>  <span class="co"># Gadwall</span></a>
<a class="sourceLine" id="cb111-14" data-line-number="14">species_lut[species_lut<span class="op">$</span>lookupname <span class="op">==</span><span class="st"> &quot;Slobeend&quot;</span>, <span class="st">&quot;scientificname&quot;</span>] &lt;-<span class="st"> &quot;Spatula clypeata&quot;</span>  <span class="co"># Northern Shoveler</span></a>
<a class="sourceLine" id="cb111-15" data-line-number="15">species_lut[species_lut<span class="op">$</span>lookupname <span class="op">==</span><span class="st"> &quot;Winterkoning&quot;</span>, <span class="st">&quot;scientificname&quot;</span>] &lt;-<span class="st"> &quot;Troglodytes troglodytes&quot;</span>  <span class="co"># Wren</span></a>
<a class="sourceLine" id="cb111-16" data-line-number="16">species_lut[species_lut<span class="op">$</span>lookupname <span class="op">==</span><span class="st"> &quot;Grote Jager&quot;</span>, <span class="st">&quot;scientificname&quot;</span>] &lt;-<span class="st"> &quot;Catharacta skua&quot;</span>  <span class="co"># Great Skua</span></a>
<a class="sourceLine" id="cb111-17" data-line-number="17">species_lut[species_lut<span class="op">$</span>lookupname <span class="op">==</span><span class="st"> &quot;Roodborsttapuit&quot;</span>, <span class="st">&quot;scientificname&quot;</span>] &lt;-<span class="st"> &quot;Saxicola torquatus&quot;</span>  <span class="co"># Stonechat</span></a>
<a class="sourceLine" id="cb111-18" data-line-number="18">species_lut[species_lut<span class="op">$</span>lookupname <span class="op">==</span><span class="st"> &quot;Strandleeuwerik&quot;</span>, <span class="st">&quot;scientificname&quot;</span>] &lt;-<span class="st"> &quot;Eremophila alpestris&quot;</span>  <span class="co"># Horned Lark</span></a></code></pre></div>
</div>
<div id="adding-vernacular-family-names" class="section level2">
<h2><span class="header-section-number">5.4</span> Adding vernacular family names</h2>
<p>Fetching vernacular names of scientific families from GBIF is even more convoluted than the name lookup we have done above, so instead we have manually derived a list of vernacular names for families based on the generated species lookup table.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" data-line-number="1"><span class="kw">read_delim</span>(<span class="st">&quot;data/raw/sovon/familyvernacular_lut.csv&quot;</span>, <span class="dt">delim =</span> <span class="st">&quot;;&quot;</span>, <span class="dt">col_types =</span> <span class="kw">cols</span>(<span class="dt">lookupname =</span> <span class="kw">col_character</span>(), <span class="dt">familyvernacular =</span> <span class="kw">col_character</span>())) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb112-2" data-line-number="2"><span class="st">  </span><span class="kw">right_join</span>(species_lut, <span class="dt">by =</span> <span class="st">&quot;lookupname&quot;</span>) -&gt;<span class="st"> </span>species_lut</a></code></pre></div>
</div>
<div id="linking-life-history-traits-to-species" class="section level2">
<h2><span class="header-section-number">5.5</span> Linking life-history traits to species</h2>
<p>We use the <em>Life-history characteristics of European birds</em>-dataset <span class="citation">(Storchová and Hořák <a href="#ref-storchova_2018">2018</a>)</span> to calculate the mean mass of all birds in a PPI pixel. This dataset is stored on Dryad and we can <a href="https://doi.org/10.5061/dryad.n6k3n">download</a> it there. Unfortunately at the time of writing the <code>rdryad</code> package is severely out-of-date with the new Dryad API, so we cannot nicely automate this download yet. Anyways, the files should be downloaded manually and added to <code>data/raw/life-history-characteristics/</code>.</p>
<p>We calculate the mean of the mass of both sexed and unsexed birds and assume that represents the mean mass for a species.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" data-line-number="1"><span class="kw">read_tsv</span>(<span class="st">&quot;data/raw/life-history-characteristics/Life-history characteristics of European birds.txt&quot;</span>, </a>
<a class="sourceLine" id="cb113-2" data-line-number="2">         <span class="dt">col_types =</span> <span class="kw">cols_only</span>(<span class="st">&#39;Species&#39;</span> =<span class="st"> </span><span class="kw">col_character</span>(), <span class="st">&#39;WeightU_MEAN&#39;</span> =<span class="st"> </span><span class="kw">col_double</span>(), <span class="st">&#39;WeightM_MEAN&#39;</span> =<span class="st"> </span><span class="kw">col_double</span>(), <span class="st">&#39;WeightF_MEAN&#39;</span> =<span class="st"> </span><span class="kw">col_double</span>())) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb113-3" data-line-number="3"><span class="st">  </span>rowwise <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb113-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mean_weight =</span> <span class="kw">mean</span>(<span class="kw">c</span>(WeightU_MEAN, WeightF_MEAN, WeightM_MEAN))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb113-5" data-line-number="5"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(Species, mean_weight) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb113-6" data-line-number="6"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">species =</span> Species) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb113-7" data-line-number="7"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">any</span>(<span class="kw">str_ends</span>(species, <span class="st">&quot;ssp&quot;</span>))) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># Filter out birds not identified to species</span></a>
<a class="sourceLine" id="cb113-8" data-line-number="8"><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb113-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">species =</span> <span class="kw">paste</span>(<span class="kw">str_split</span>(species, <span class="dt">pattern =</span> <span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]][<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dt">collapse =</span> <span class="st">&quot; &quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb113-10" data-line-number="10"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb113-11" data-line-number="11"><span class="st">  </span><span class="kw">group_by</span>(species) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb113-12" data-line-number="12"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_weight =</span> <span class="kw">mean</span>(mean_weight), <span class="dt">.groups =</span> <span class="st">&quot;drop_last&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb113-13" data-line-number="13"><span class="st">  </span><span class="kw">drop_na</span>() -&gt;<span class="st"> </span>lhc</a>
<a class="sourceLine" id="cb113-14" data-line-number="14"></a>
<a class="sourceLine" id="cb113-15" data-line-number="15">lhc[lhc<span class="op">$</span>species <span class="op">==</span><span class="st"> &quot;Aquila nipalenis&quot;</span>, <span class="st">&quot;species&quot;</span>] &lt;-<span class="st"> &quot;Aquila nipalensis&quot;</span>  <span class="co"># Small error in dataset -&gt; notified author</span></a>
<a class="sourceLine" id="cb113-16" data-line-number="16"></a>
<a class="sourceLine" id="cb113-17" data-line-number="17"><span class="kw">head</span>(lhc, <span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb113-18" data-line-number="18"><span class="st">  </span><span class="kw">kable</span>(<span class="dt">format =</span> <span class="st">&quot;html&quot;</span>, <span class="dt">col.names =</span> <span class="kw">colnames</span>(lhc)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb113-19" data-line-number="19"><span class="st">  </span><span class="kw">kable_styling</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb113-20" data-line-number="20"><span class="st">  </span>kableExtra<span class="op">::</span><span class="kw">scroll_box</span>(<span class="dt">width =</span> <span class="st">&quot;100%&quot;</span>, <span class="dt">height =</span> <span class="st">&quot;400px&quot;</span>)</a></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:400px; overflow-x: scroll; width:100%; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
species
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
mean_weight
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Acanthis flammea
</td>
<td style="text-align:right;">
13.40
</td>
</tr>
<tr>
<td style="text-align:left;">
Accipiter brevipes
</td>
<td style="text-align:right;">
221.50
</td>
</tr>
<tr>
<td style="text-align:left;">
Accipiter gentilis
</td>
<td style="text-align:right;">
931.50
</td>
</tr>
<tr>
<td style="text-align:left;">
Accipiter nisus
</td>
<td style="text-align:right;">
204.00
</td>
</tr>
<tr>
<td style="text-align:left;">
Acridotheres cristatellus
</td>
<td style="text-align:right;">
124.35
</td>
</tr>
<tr>
<td style="text-align:left;">
Acridotheres tristis
</td>
<td style="text-align:right;">
124.35
</td>
</tr>
<tr>
<td style="text-align:left;">
Acrocephalus agricola
</td>
<td style="text-align:right;">
10.50
</td>
</tr>
<tr>
<td style="text-align:left;">
Acrocephalus arundinaceus
</td>
<td style="text-align:right;">
30.30
</td>
</tr>
<tr>
<td style="text-align:left;">
Acrocephalus dumetorum
</td>
<td style="text-align:right;">
12.00
</td>
</tr>
<tr>
<td style="text-align:left;">
Acrocephalus melanopogon
</td>
<td style="text-align:right;">
11.70
</td>
</tr>
</tbody>
</table>
</div>
<p>Now we can try to link the names once again with what can be found in GBIF.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" data-line-number="1">unique_species_lhc &lt;-<span class="st"> </span><span class="kw">unique</span>(lhc<span class="op">$</span>species)</a>
<a class="sourceLine" id="cb114-2" data-line-number="2"></a>
<a class="sourceLine" id="cb114-3" data-line-number="3">lhc_species_lut &lt;-<span class="st"> </span><span class="kw">build_species_lut</span>(unique_species_lhc, <span class="dt">dataset =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb114-4" data-line-number="4"></a>
<a class="sourceLine" id="cb114-5" data-line-number="5"><span class="kw">head</span>(lhc_species_lut, <span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb114-6" data-line-number="6"><span class="st">  </span><span class="kw">kable</span>(<span class="dt">format =</span> <span class="st">&quot;html&quot;</span>, <span class="dt">col.names =</span> <span class="kw">colnames</span>(lhc_species_lut)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb114-7" data-line-number="7"><span class="st">  </span><span class="kw">kable_styling</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb114-8" data-line-number="8"><span class="st">  </span>kableExtra<span class="op">::</span><span class="kw">scroll_box</span>(<span class="dt">width =</span> <span class="st">&quot;100%&quot;</span>, <span class="dt">height =</span> <span class="st">&quot;400px&quot;</span>)</a></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:400px; overflow-x: scroll; width:100%; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
lookupname
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
scientificname
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
gbif_key
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Acanthis flammea
</td>
<td style="text-align:left;">
Acanthis flammea
</td>
<td style="text-align:right;">
5231630
</td>
</tr>
<tr>
<td style="text-align:left;">
Accipiter brevipes
</td>
<td style="text-align:left;">
Accipiter brevipes
</td>
<td style="text-align:right;">
2480578
</td>
</tr>
<tr>
<td style="text-align:left;">
Accipiter gentilis
</td>
<td style="text-align:left;">
Accipiter gentilis
</td>
<td style="text-align:right;">
2480589
</td>
</tr>
<tr>
<td style="text-align:left;">
Accipiter nisus
</td>
<td style="text-align:left;">
Accipiter nisus
</td>
<td style="text-align:right;">
2480637
</td>
</tr>
<tr>
<td style="text-align:left;">
Acridotheres cristatellus
</td>
<td style="text-align:left;">
Acridotheres cristatellus
</td>
<td style="text-align:right;">
2489010
</td>
</tr>
<tr>
<td style="text-align:left;">
Acridotheres tristis
</td>
<td style="text-align:left;">
Acridotheres tristis
</td>
<td style="text-align:right;">
2489005
</td>
</tr>
<tr>
<td style="text-align:left;">
Acrocephalus agricola
</td>
<td style="text-align:left;">
Acrocephalus agricola
</td>
<td style="text-align:right;">
2493137
</td>
</tr>
<tr>
<td style="text-align:left;">
Acrocephalus arundinaceus
</td>
<td style="text-align:left;">
Acrocephalus arundinaceus
</td>
<td style="text-align:right;">
2493128
</td>
</tr>
<tr>
<td style="text-align:left;">
Acrocephalus dumetorum
</td>
<td style="text-align:left;">
Acrocephalus dumetorum
</td>
<td style="text-align:right;">
2493145
</td>
</tr>
<tr>
<td style="text-align:left;">
Acrocephalus melanopogon
</td>
<td style="text-align:left;">
Acrocephalus melanopogon
</td>
<td style="text-align:right;">
2493124
</td>
</tr>
</tbody>
</table>
</div>
<p>With the GBIF IDs/keys in place for both the life-history characteristics, as well as the Sovon counts, we can now link the datasets together. We start with the waterbirds.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" data-line-number="1">lhc <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb115-2" data-line-number="2"><span class="st">  </span><span class="kw">left_join</span>(lhc_species_lut, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;species&quot;</span> =<span class="st"> &quot;scientificname&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb115-3" data-line-number="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(species, mean_weight, gbif_key) -&gt;<span class="st"> </span>lhc</a>
<a class="sourceLine" id="cb115-4" data-line-number="4"></a>
<a class="sourceLine" id="cb115-5" data-line-number="5">wb_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb115-6" data-line-number="6"><span class="st">  </span><span class="kw">left_join</span>(species_lut, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;species&quot;</span> =<span class="st"> &quot;lookupname&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb115-7" data-line-number="7"><span class="st">  </span><span class="kw">left_join</span>(dplyr<span class="op">::</span><span class="kw">select</span>(lhc, mean_weight, gbif_key), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;gbif_key&quot;</span> =<span class="st"> &quot;gbif_key&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb115-8" data-line-number="8"><span class="st">  </span><span class="kw">left_join</span>(dplyr<span class="op">::</span><span class="kw">select</span>(lhc, mean_weight, species), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;scientificname&quot;</span> =<span class="st"> &quot;species&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb115-9" data-line-number="9"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(mean_weight.x)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb115-10" data-line-number="10"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">mean_weight =</span> mean_weight.y) -&gt;<span class="st"> </span>wb_data_lhc</a>
<a class="sourceLine" id="cb115-11" data-line-number="11"></a>
<a class="sourceLine" id="cb115-12" data-line-number="12"><span class="kw">head</span>(wb_data_lhc, <span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb115-13" data-line-number="13"><span class="st">  </span><span class="kw">kable</span>(<span class="dt">format =</span> <span class="st">&quot;html&quot;</span>, <span class="dt">col.names =</span> <span class="kw">colnames</span>(wb_data_lhc)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb115-14" data-line-number="14"><span class="st">  </span><span class="kw">kable_styling</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb115-15" data-line-number="15"><span class="st">  </span>kableExtra<span class="op">::</span><span class="kw">scroll_box</span>(<span class="dt">width =</span> <span class="st">&quot;100%&quot;</span>, <span class="dt">height =</span> <span class="st">&quot;400px&quot;</span>)</a></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:400px; overflow-x: scroll; width:100%; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
count_id
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
area_nr
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
year
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
month
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
day
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
start_time
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
end_time
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
euring
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
species
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
number
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
xcoor
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ycoor
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
familyvernacular
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
scientificname
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
gbif_key
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
mean_weight
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1060908
</td>
<td style="text-align:left;">
BR1111
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1045
</td>
<td style="text-align:right;">
1108
</td>
<td style="text-align:right;">
1610
</td>
<td style="text-align:left;">
Grauwe Gans
</td>
<td style="text-align:right;">
280
</td>
<td style="text-align:right;">
127723
</td>
<td style="text-align:right;">
426233
</td>
<td style="text-align:left;">
Geese
</td>
<td style="text-align:left;">
Anser anser
</td>
<td style="text-align:right;">
2498036
</td>
<td style="text-align:right;">
3347
</td>
</tr>
<tr>
<td style="text-align:right;">
1060908
</td>
<td style="text-align:left;">
BR1111
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1045
</td>
<td style="text-align:right;">
1108
</td>
<td style="text-align:right;">
1700
</td>
<td style="text-align:left;">
Nijlgans
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
127723
</td>
<td style="text-align:right;">
426233
</td>
<td style="text-align:left;">
Geese
</td>
<td style="text-align:left;">
Alopochen aegyptiaca
</td>
<td style="text-align:right;">
2498252
</td>
<td style="text-align:right;">
2270
</td>
</tr>
<tr>
<td style="text-align:right;">
1060909
</td>
<td style="text-align:left;">
BR1112
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1108
</td>
<td style="text-align:right;">
1126
</td>
<td style="text-align:right;">
1610
</td>
<td style="text-align:left;">
Grauwe Gans
</td>
<td style="text-align:right;">
76
</td>
<td style="text-align:right;">
125082
</td>
<td style="text-align:right;">
426701
</td>
<td style="text-align:left;">
Geese
</td>
<td style="text-align:left;">
Anser anser
</td>
<td style="text-align:right;">
2498036
</td>
<td style="text-align:right;">
3347
</td>
</tr>
<tr>
<td style="text-align:right;">
1060909
</td>
<td style="text-align:left;">
BR1112
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1108
</td>
<td style="text-align:right;">
1126
</td>
<td style="text-align:right;">
1661
</td>
<td style="text-align:left;">
Grote Canadese Gans
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
125082
</td>
<td style="text-align:right;">
426701
</td>
<td style="text-align:left;">
Geese
</td>
<td style="text-align:left;">
Branta canadensis
</td>
<td style="text-align:right;">
5232437
</td>
<td style="text-align:right;">
4635
</td>
</tr>
<tr>
<td style="text-align:right;">
1060909
</td>
<td style="text-align:left;">
BR1112
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1108
</td>
<td style="text-align:right;">
1126
</td>
<td style="text-align:right;">
1700
</td>
<td style="text-align:left;">
Nijlgans
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
125082
</td>
<td style="text-align:right;">
426701
</td>
<td style="text-align:left;">
Geese
</td>
<td style="text-align:left;">
Alopochen aegyptiaca
</td>
<td style="text-align:right;">
2498252
</td>
<td style="text-align:right;">
2270
</td>
</tr>
<tr>
<td style="text-align:right;">
1060906
</td>
<td style="text-align:left;">
BR1122
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1020
</td>
<td style="text-align:right;">
1037
</td>
<td style="text-align:right;">
1610
</td>
<td style="text-align:left;">
Grauwe Gans
</td>
<td style="text-align:right;">
250
</td>
<td style="text-align:right;">
125313
</td>
<td style="text-align:right;">
426061
</td>
<td style="text-align:left;">
Geese
</td>
<td style="text-align:left;">
Anser anser
</td>
<td style="text-align:right;">
2498036
</td>
<td style="text-align:right;">
3347
</td>
</tr>
<tr>
<td style="text-align:right;">
1060906
</td>
<td style="text-align:left;">
BR1122
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1020
</td>
<td style="text-align:right;">
1037
</td>
<td style="text-align:right;">
1619
</td>
<td style="text-align:left;">
Soepgans
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
125313
</td>
<td style="text-align:right;">
426061
</td>
<td style="text-align:left;">
Geese
</td>
<td style="text-align:left;">
Anser anser
</td>
<td style="text-align:right;">
9384117
</td>
<td style="text-align:right;">
3347
</td>
</tr>
<tr>
<td style="text-align:right;">
1060906
</td>
<td style="text-align:left;">
BR1122
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1020
</td>
<td style="text-align:right;">
1037
</td>
<td style="text-align:right;">
1661
</td>
<td style="text-align:left;">
Grote Canadese Gans
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
125313
</td>
<td style="text-align:right;">
426061
</td>
<td style="text-align:left;">
Geese
</td>
<td style="text-align:left;">
Branta canadensis
</td>
<td style="text-align:right;">
5232437
</td>
<td style="text-align:right;">
4635
</td>
</tr>
<tr>
<td style="text-align:right;">
1060911
</td>
<td style="text-align:left;">
BR1130
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1145
</td>
<td style="text-align:right;">
1200
</td>
<td style="text-align:right;">
1610
</td>
<td style="text-align:left;">
Grauwe Gans
</td>
<td style="text-align:right;">
200
</td>
<td style="text-align:right;">
121962
</td>
<td style="text-align:right;">
426420
</td>
<td style="text-align:left;">
Geese
</td>
<td style="text-align:left;">
Anser anser
</td>
<td style="text-align:right;">
2498036
</td>
<td style="text-align:right;">
3347
</td>
</tr>
<tr>
<td style="text-align:right;">
1060911
</td>
<td style="text-align:left;">
BR1130
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1145
</td>
<td style="text-align:right;">
1200
</td>
<td style="text-align:right;">
1661
</td>
<td style="text-align:left;">
Grote Canadese Gans
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
121962
</td>
<td style="text-align:right;">
426420
</td>
<td style="text-align:left;">
Geese
</td>
<td style="text-align:left;">
Branta canadensis
</td>
<td style="text-align:right;">
5232437
</td>
<td style="text-align:right;">
4635
</td>
</tr>
</tbody>
</table>
</div>
<p>And then the PTT counts.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" data-line-number="1">ptt_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb116-2" data-line-number="2"><span class="st">  </span><span class="kw">left_join</span>(species_lut, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;species&quot;</span> =<span class="st"> &quot;lookupname&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb116-3" data-line-number="3"><span class="st">  </span><span class="kw">left_join</span>(dplyr<span class="op">::</span><span class="kw">select</span>(lhc, mean_weight, gbif_key), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;gbif_key&quot;</span> =<span class="st"> &quot;gbif_key&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb116-4" data-line-number="4"><span class="st">  </span><span class="kw">left_join</span>(dplyr<span class="op">::</span><span class="kw">select</span>(lhc, mean_weight, species), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;scientificname&quot;</span> =<span class="st"> &quot;species&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb116-5" data-line-number="5"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(mean_weight.x)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb116-6" data-line-number="6"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">mean_weight =</span> mean_weight.y) -&gt;<span class="st"> </span>ptt_data_lhc</a>
<a class="sourceLine" id="cb116-7" data-line-number="7"></a>
<a class="sourceLine" id="cb116-8" data-line-number="8"><span class="kw">head</span>(ptt_data_lhc, <span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb116-9" data-line-number="9"><span class="st">  </span><span class="kw">kable</span>(<span class="dt">format =</span> <span class="st">&quot;html&quot;</span>, <span class="dt">col.names =</span> <span class="kw">colnames</span>(ptt_data_lhc)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb116-10" data-line-number="10"><span class="st">  </span><span class="kw">kable_styling</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb116-11" data-line-number="11"><span class="st">  </span>kableExtra<span class="op">::</span><span class="kw">scroll_box</span>(<span class="dt">width =</span> <span class="st">&quot;100%&quot;</span>, <span class="dt">height =</span> <span class="st">&quot;400px&quot;</span>)</a></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:400px; overflow-x: scroll; width:100%; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
count_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
route
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
count_point
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
season
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
year
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
month
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
day
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
euring
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
species
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
number
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
xcoor
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ycoor
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
familyvernacular
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
scientificname
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
gbif_key
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
mean_weight
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
80917
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
720
</td>
<td style="text-align:left;">
Aalscholver
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
246342
</td>
<td style="text-align:right;">
520763
</td>
<td style="text-align:left;">
Cormorants
</td>
<td style="text-align:left;">
Phalacrocorax carbo
</td>
<td style="text-align:right;">
2481890
</td>
<td style="text-align:right;">
2254.0
</td>
</tr>
<tr>
<td style="text-align:right;">
80917
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
5920
</td>
<td style="text-align:left;">
Zilvermeeuw
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
246342
</td>
<td style="text-align:right;">
520763
</td>
<td style="text-align:left;">
Gulls
</td>
<td style="text-align:left;">
Larus argentatus
</td>
<td style="text-align:right;">
2481139
</td>
<td style="text-align:right;">
1054.0
</td>
</tr>
<tr>
<td style="text-align:right;">
80917
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
6700
</td>
<td style="text-align:left;">
Houtduif
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
246342
</td>
<td style="text-align:right;">
520763
</td>
<td style="text-align:left;">
Pigeons
</td>
<td style="text-align:left;">
Columba palumbus
</td>
<td style="text-align:right;">
2495455
</td>
<td style="text-align:right;">
496.5
</td>
</tr>
<tr>
<td style="text-align:right;">
80917
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
11870
</td>
<td style="text-align:left;">
Merel
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
246342
</td>
<td style="text-align:right;">
520763
</td>
<td style="text-align:left;">
Thrushes
</td>
<td style="text-align:left;">
Turdus merula
</td>
<td style="text-align:right;">
2490719
</td>
<td style="text-align:right;">
97.0
</td>
</tr>
<tr>
<td style="text-align:right;">
80917
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
15630
</td>
<td style="text-align:left;">
Roek
</td>
<td style="text-align:right;">
24
</td>
<td style="text-align:right;">
246342
</td>
<td style="text-align:right;">
520763
</td>
<td style="text-align:left;">
Crows
</td>
<td style="text-align:left;">
Corvus frugilegus
</td>
<td style="text-align:right;">
2482513
</td>
<td style="text-align:right;">
459.0
</td>
</tr>
<tr>
<td style="text-align:right;">
80917
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
6700
</td>
<td style="text-align:left;">
Houtduif
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
246357
</td>
<td style="text-align:right;">
522178
</td>
<td style="text-align:left;">
Pigeons
</td>
<td style="text-align:left;">
Columba palumbus
</td>
<td style="text-align:right;">
2495455
</td>
<td style="text-align:right;">
496.5
</td>
</tr>
<tr>
<td style="text-align:right;">
80917
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
11870
</td>
<td style="text-align:left;">
Merel
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
246357
</td>
<td style="text-align:right;">
522178
</td>
<td style="text-align:left;">
Thrushes
</td>
<td style="text-align:left;">
Turdus merula
</td>
<td style="text-align:right;">
2490719
</td>
<td style="text-align:right;">
97.0
</td>
</tr>
<tr>
<td style="text-align:right;">
80917
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
15600
</td>
<td style="text-align:left;">
Kauw
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
246357
</td>
<td style="text-align:right;">
522178
</td>
<td style="text-align:left;">
Crows
</td>
<td style="text-align:left;">
Corvus monedula
</td>
<td style="text-align:right;">
2482473
</td>
<td style="text-align:right;">
236.0
</td>
</tr>
<tr>
<td style="text-align:right;">
80917
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
15630
</td>
<td style="text-align:left;">
Roek
</td>
<td style="text-align:right;">
78
</td>
<td style="text-align:right;">
246357
</td>
<td style="text-align:right;">
522178
</td>
<td style="text-align:left;">
Crows
</td>
<td style="text-align:left;">
Corvus frugilegus
</td>
<td style="text-align:right;">
2482513
</td>
<td style="text-align:right;">
459.0
</td>
</tr>
<tr>
<td style="text-align:right;">
80917
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
14620
</td>
<td style="text-align:left;">
Pimpelmees
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
246692
</td>
<td style="text-align:right;">
523139
</td>
<td style="text-align:left;">
Tits
</td>
<td style="text-align:left;">
Cyanistes caeruleus
</td>
<td style="text-align:right;">
2487879
</td>
<td style="text-align:right;">
11.5
</td>
</tr>
</tbody>
</table>
</div>
<p>Now we can verify if our <em>1% criteria</em> (see above) for species matching is met. We do this by calculating the proportions of birds belonging to a certain species out of the total numbers of birds counted within a count. This should result in an empty dataframe, which will stop the code chunk below from running if that is <em>not</em> the case.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" data-line-number="1">wb_data_lhc <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb117-2" data-line-number="2"><span class="st">  </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb117-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(count_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb117-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">total_birds_count =</span> <span class="kw">sum</span>(number)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb117-5" data-line-number="5"><span class="st">  </span><span class="kw">group_by</span>(count_id, species) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb117-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">proportion_species =</span> <span class="kw">sum</span>(number) <span class="op">/</span><span class="st"> </span>total_birds_count) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb117-7" data-line-number="7"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb117-8" data-line-number="8"><span class="st">  </span><span class="kw">arrange</span>(count_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb117-9" data-line-number="9"><span class="st">  </span><span class="kw">filter</span>((<span class="kw">is.na</span>(mean_weight) <span class="op">&amp;</span><span class="st"> </span>(proportion_species <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.01</span>))) -&gt;<span class="st"> </span>wb_data_lhc_verify</a>
<a class="sourceLine" id="cb117-10" data-line-number="10"></a>
<a class="sourceLine" id="cb117-11" data-line-number="11"><span class="kw">stopifnot</span>(<span class="kw">nrow</span>(wb_data_lhc_verify) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb117-12" data-line-number="12"><span class="kw">rm</span>(wb_data_lhc_verify)</a></code></pre></div>
<p>And once again, we can do the same for the PTT counts.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" data-line-number="1">ptt_data_lhc <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb118-2" data-line-number="2"><span class="st">  </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb118-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(count_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb118-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">total_birds_count =</span> <span class="kw">sum</span>(number)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb118-5" data-line-number="5"><span class="st">  </span><span class="kw">group_by</span>(count_id, species) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb118-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">proportion_species =</span> <span class="kw">sum</span>(number) <span class="op">/</span><span class="st"> </span>total_birds_count) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb118-7" data-line-number="7"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb118-8" data-line-number="8"><span class="st">  </span><span class="kw">arrange</span>(count_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb118-9" data-line-number="9"><span class="st">  </span><span class="kw">filter</span>((<span class="kw">is.na</span>(mean_weight) <span class="op">&amp;</span><span class="st"> </span>(proportion_species <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.01</span>))) -&gt;<span class="st"> </span>ptt_data_lhc_verify</a>
<a class="sourceLine" id="cb118-10" data-line-number="10"></a>
<a class="sourceLine" id="cb118-11" data-line-number="11"><span class="kw">stopifnot</span>(<span class="kw">nrow</span>(ptt_data_lhc_verify) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb118-12" data-line-number="12"><span class="kw">rm</span>(ptt_data_lhc_verify)</a></code></pre></div>
<p>With that out of the way we can <em>finally</em> remove the remaining empty rows and save the PTT and waterbird counts in their final form.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" data-line-number="1">ptt_data_lhc <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb119-2" data-line-number="2"><span class="st">  </span><span class="kw">drop_na</span>() -&gt;<span class="st"> </span>ptt_data</a>
<a class="sourceLine" id="cb119-3" data-line-number="3"></a>
<a class="sourceLine" id="cb119-4" data-line-number="4">wb_data_lhc <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb119-5" data-line-number="5"><span class="st">  </span><span class="kw">drop_na</span>() -&gt;<span class="st"> </span>wb_data</a></code></pre></div>
<p>And we save the data for further use.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" data-line-number="1"><span class="kw">saveRDS</span>(ptt_data, <span class="dt">file =</span> <span class="st">&quot;data/processed/sovon/ptt.RDS&quot;</span>)</a>
<a class="sourceLine" id="cb120-2" data-line-number="2"><span class="kw">saveRDS</span>(wb_data, <span class="dt">file =</span> <span class="st">&quot;data/processed/sovon/wb.RDS&quot;</span>)</a></code></pre></div>
</div>
<div id="calculating-total-bird-biomass" class="section level2">
<h2><span class="header-section-number">5.6</span> Calculating total bird biomass</h2>
<p>While we are at it, we will already calculate the total biomass contained within each of the count areas, so we can then add these values to the PPIs through the IDs of the count areas/routes. We use the waterbird count from January 2018, and the point-transect counts from 2017, as these are the best in terms of coverage.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1">wb_year &lt;-<span class="st"> </span><span class="dv">2018</span></a>
<a class="sourceLine" id="cb121-2" data-line-number="2">ptt_year &lt;-<span class="st"> </span><span class="dv">2017</span></a>
<a class="sourceLine" id="cb121-3" data-line-number="3"></a>
<a class="sourceLine" id="cb121-4" data-line-number="4">wb_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">area_nr =</span> <span class="kw">as.character</span>(area_nr)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-6" data-line-number="6"><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span>wb_year) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-7" data-line-number="7"><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">specific_biomass =</span> number <span class="op">*</span><span class="st"> </span>mean_weight) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-9" data-line-number="9"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-10" data-line-number="10"><span class="st">  </span><span class="kw">group_by</span>(area_nr, year) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-11" data-line-number="11"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_biomass =</span> <span class="kw">sum</span>(specific_biomass), <span class="dt">.groups =</span> <span class="st">&quot;drop_last&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-12" data-line-number="12"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-13" data-line-number="13"><span class="st">  </span><span class="kw">group_by</span>(area_nr) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># Below is only required if year-filter is NOT set, otherwise does nothing</span></a>
<a class="sourceLine" id="cb121-14" data-line-number="14"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_biomass =</span> <span class="kw">mean</span>(total_biomass), <span class="dt">.groups =</span> <span class="st">&quot;drop_last&quot;</span>) -&gt;<span class="st"> </span>wb_biomass</a>
<a class="sourceLine" id="cb121-15" data-line-number="15"></a>
<a class="sourceLine" id="cb121-16" data-line-number="16">ptt_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-17" data-line-number="17"><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span>ptt_year) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-18" data-line-number="18"><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-19" data-line-number="19"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">specific_biomass =</span> number <span class="op">*</span><span class="st"> </span>mean_weight) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-20" data-line-number="20"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-21" data-line-number="21"><span class="st">  </span><span class="kw">group_by</span>(route, year) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-22" data-line-number="22"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_biomass =</span> <span class="kw">sum</span>(specific_biomass), <span class="dt">.groups =</span> <span class="st">&quot;drop_last&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-23" data-line-number="23"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-24" data-line-number="24"><span class="st">  </span><span class="kw">group_by</span>(route) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># Below is only required if year-filter is NOT set, otherwise does nothing</span></a>
<a class="sourceLine" id="cb121-25" data-line-number="25"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_biomass =</span> <span class="kw">mean</span>(total_biomass), <span class="dt">.groups =</span> <span class="st">&quot;drop_last&quot;</span>) -&gt;<span class="st"> </span>ptt_biomass</a></code></pre></div>
<p>And now we will save these datasets of <code>total_biomass</code> as well.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" data-line-number="1"><span class="kw">saveRDS</span>(wb_biomass, <span class="dt">file =</span> <span class="st">&quot;data/processed/sovon/wb_biomass.RDS&quot;</span>)</a>
<a class="sourceLine" id="cb122-2" data-line-number="2"><span class="kw">saveRDS</span>(ptt_biomass, <span class="dt">file =</span> <span class="st">&quot;data/processed/sovon/ptt_biomass.RDS&quot;</span>)</a></code></pre></div>
</div>
<div id="calculating-proportions-across-bird-families" class="section level2">
<h2><span class="header-section-number">5.7</span> Calculating proportions across bird families</h2>
<p>Now that we have identified which families birds belong to, we can calculate the proportion of birds that belong to these families across all the PTT and waterbird counts. This can give an idea of the spatial composition of bird communities to illustrate analysis results with.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1">wb &lt;-<span class="st"> </span>wb_data</a>
<a class="sourceLine" id="cb123-2" data-line-number="2">ptt &lt;-<span class="st"> </span>ptt_data</a>
<a class="sourceLine" id="cb123-3" data-line-number="3">families &lt;-<span class="st"> </span><span class="kw">unique</span>(species_lut<span class="op">$</span>familyvernacular)</a>
<a class="sourceLine" id="cb123-4" data-line-number="4"></a>
<a class="sourceLine" id="cb123-5" data-line-number="5">wb <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">area_nr =</span> <span class="kw">as.character</span>(area_nr)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-7" data-line-number="7"><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span>wb_year) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-8" data-line-number="8"><span class="st">  </span><span class="kw">group_by</span>(area_nr, year) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">total_birds =</span> <span class="kw">sum</span>(number)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-10" data-line-number="10"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-11" data-line-number="11"><span class="st">  </span><span class="kw">group_by</span>(area_nr, year, familyvernacular) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">familyprop =</span> <span class="kw">sum</span>(number) <span class="op">/</span><span class="st"> </span>total_birds) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-13" data-line-number="13"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-14" data-line-number="14"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(area_nr, familyvernacular, familyprop) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-15" data-line-number="15"><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-16" data-line-number="16"><span class="st">  </span><span class="kw">arrange</span>(area_nr) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-17" data-line-number="17"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> familyvernacular, <span class="dt">values_from =</span> familyprop) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-18" data-line-number="18"><span class="st">  </span><span class="kw">replace</span>(<span class="kw">is.na</span>(.), <span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-19" data-line-number="19"><span class="st">  </span><span class="kw">identity</span>() -&gt;<span class="st"> </span>wb_props</a>
<a class="sourceLine" id="cb123-20" data-line-number="20"></a>
<a class="sourceLine" id="cb123-21" data-line-number="21">ptt <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-22" data-line-number="22"><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span>ptt_year) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-23" data-line-number="23"><span class="st">  </span><span class="kw">group_by</span>(route, year) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-24" data-line-number="24"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">total_birds =</span> <span class="kw">sum</span>(number)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-25" data-line-number="25"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-26" data-line-number="26"><span class="st">  </span><span class="kw">group_by</span>(route, year, familyvernacular) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-27" data-line-number="27"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">familyprop =</span> <span class="kw">sum</span>(number) <span class="op">/</span><span class="st"> </span>total_birds) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-28" data-line-number="28"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-29" data-line-number="29"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(route, familyvernacular, familyprop) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-30" data-line-number="30"><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-31" data-line-number="31"><span class="st">  </span><span class="kw">arrange</span>(route) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-32" data-line-number="32"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> familyvernacular, <span class="dt">values_from =</span> familyprop) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-33" data-line-number="33"><span class="st">  </span><span class="kw">replace</span>(<span class="kw">is.na</span>(.), <span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-34" data-line-number="34"><span class="st">  </span><span class="kw">identity</span>() -&gt;<span class="st"> </span>ptt_props</a></code></pre></div>
<p>And now we will save these datasets of family proportions as well.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" data-line-number="1"><span class="kw">saveRDS</span>(wb_props, <span class="dt">file =</span> <span class="st">&quot;data/processed/sovon/wb_props.RDS&quot;</span>)</a>
<a class="sourceLine" id="cb124-2" data-line-number="2"><span class="kw">saveRDS</span>(ptt_props, <span class="dt">file =</span> <span class="st">&quot;data/processed/sovon/ptt_props.RDS&quot;</span>)</a></code></pre></div>

</div>
</div>
<h3> References</h3>
<div id="refs" class="references">
<div id="ref-storchova_2018">
<p>Storchová, Lenka, and David Hořák. 2018. “Life-History Characteristics of European Birds.” <em>Global Ecology and Biogeography</em> 27 (4): 400–406. <a href="https://doi.org/10.1111/geb.12709">https://doi.org/10.1111/geb.12709</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="04.Annotate-count-areas.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="06.Applying-annotations-to-all-PPIs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/lunr.js"></script>
<script src="assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/barthoekstra/fireworks/edit/master/05.Processing-count-results.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/barthoekstra/fireworks/blob/master/05.Processing-count-results.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true,
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
