<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Composite all PPIs | Fireworks</title>
  <meta name="description" content="Using ground-based bird counts and weather radar measurements to estimate numbers of birds aloft during NYE fireworks events." />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Composite all PPIs | Fireworks" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Using ground-based bird counts and weather radar measurements to estimate numbers of birds aloft during NYE fireworks events." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Composite all PPIs | Fireworks" />
  
  <meta name="twitter:description" content="Using ground-based bird counts and weather radar measurements to estimate numbers of birds aloft during NYE fireworks events." />
  

<meta name="author" content="Bart Hoekstra" />


<meta name="date" content="2020-10-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="06.Applying-annotations-to-all-PPIs.html"/>
<link rel="next" href="08.Model-fireworks-disturbance.html"/>
<script src="assets/jquery-2.2.3/jquery.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="assets/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="assets/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="assets/typedarray-0.1/typedarray.min.js"></script>
<link href="assets/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="assets/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="assets/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="assets/plotly-main-1.52.2/plotly-latest.min.js"></script>
<link href="assets/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="assets/leaflet-1.3.1/leaflet.js"></script>
<link href="assets/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="assets/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="assets/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="assets/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="assets/leaflet-binding-2.0.3/leaflet.js"></script>
<script src="assets/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="assets/leaflet-providers-plugin-2.0.3/leaflet-providers-plugin.js"></script>
<script src="assets/layer.1-1/data_stars_layer11403c5.txt"></script>
<script src="assets/joda-0.0.1/joda.js"></script>
<script src="assets/joda-0.0.1/addImageQuery-bindings.js"></script>
<script src="assets/clipboard-0.0.1/setClipboardText.js"></script>
<link href="assets/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="assets/HomeButton-0.0.1/home-button.js"></script>
<script src="assets/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="assets/layer.2-1/data_stars_layer2ef1687.txt"></script>
<script src="assets/layer.3-1/data_stars_layer397ab21.txt"></script>
<script src="assets/layer.4-1/data_stars_layer4f39627.txt"></script>
<script src="assets/layer.5-1/data_stars_layer578154e.txt"></script>
<script src="assets/layer.6-1/data_stars_layer6f23d60.txt"></script>
<script src="assets/layer.7-1/data_stars_layer73ad4ce.txt"></script>
<script src="assets/layer.8-1/data_stars_layer85a6ec3.txt"></script>
<script src="assets/layer.9-1/data_stars_layer9fc9123.txt"></script>
<script src="assets/layer.10-1/data_stars_layer10e03bdc.txt"></script>
<script src="assets/urban-1/data_stars_urban1e075b.txt"></script>
<script src="assets/agricultural-1/data_stars_agriculturald521e8.txt"></script>
<script src="assets/semiopen-1/data_stars_semiopenf745b0.txt"></script>
<script src="assets/forests-1/data_stars_forests275461.txt"></script>
<script src="assets/wetlands-1/data_stars_wetlands62acf3.txt"></script>
<script src="assets/waterbodies-1/data_stars_waterbodiesca4782.txt"></script>
<script src="assets/dist_urban-1/data_stars_dist_urban570ad9.txt"></script>
<script src="assets/human_pop-1/data_stars_human_pop627d50.txt"></script>
<script src="assets/kePrint-0.0.1/kePrint.js"></script>
<script src="assets/resid-1/data_stars_stars62d918.txt"></script>
<link href="assets/jquery-ui-1.10.3/jquery-ui-1.10.3.custom.min.css" rel="stylesheet" />
<script src="assets/jquery-ui-1.10.3/jquery-ui-1.10.3.custom.min.js"></script>
<link href="assets/opacity-1.0.0/Control.Opacity.css" rel="stylesheet" />
<script src="assets/opacity-1.0.0/Control.Opacity.js"></script>
<script src="assets/local_sa-1/data_stars_local_saf48e6d.txt"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#abstract"><i class="fa fa-check"></i>Abstract</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-use-this-document"><i class="fa fa-check"></i>How to use this document</a></li>
</ul></li>
<li class="part"><span><b>I Weather radar data</b></span></li>
<li class="chapter" data-level="1" data-path="01.Selecting-take-off-moments.html"><a href="01.Selecting-take-off-moments.html"><i class="fa fa-check"></i><b>1</b> Selecting firework take-off moment</a><ul>
<li class="chapter" data-level="1.1" data-path="01.Selecting-take-off-moments.html"><a href="01.Selecting-take-off-moments.html#processing-environment"><i class="fa fa-check"></i><b>1.1</b> Processing environment</a></li>
<li class="chapter" data-level="1.2" data-path="01.Selecting-take-off-moments.html"><a href="01.Selecting-take-off-moments.html#calculate-the-vertical-profiles"><i class="fa fa-check"></i><b>1.2</b> Calculate the vertical profiles</a></li>
<li class="chapter" data-level="1.3" data-path="01.Selecting-take-off-moments.html"><a href="01.Selecting-take-off-moments.html#generate-time-series-of-vertical-profiles"><i class="fa fa-check"></i><b>1.3</b> Generate time series of vertical profiles</a></li>
<li class="chapter" data-level="1.4" data-path="01.Selecting-take-off-moments.html"><a href="01.Selecting-take-off-moments.html#identifying-moment-of-take-off"><i class="fa fa-check"></i><b>1.4</b> Identifying moment of take-off</a></li>
<li class="chapter" data-level="1.5" data-path="01.Selecting-take-off-moments.html"><a href="01.Selecting-take-off-moments.html#determining-maximum-range-from-radar-to-detect-birds"><i class="fa fa-check"></i><b>1.5</b> Determining maximum range from radar to detect birds</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html"><i class="fa fa-check"></i><b>2</b> Radar Data Preprocessing</a><ul>
<li class="chapter" data-level="2.1" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#processing-environment-1"><i class="fa fa-check"></i><b>2.1</b> Processing environment</a></li>
<li class="chapter" data-level="2.2" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#removing-electromagnetic-interference"><i class="fa fa-check"></i><b>2.2</b> Removing electromagnetic interference</a></li>
<li class="chapter" data-level="2.3" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#filter-meteorology-using-the-depolarization-ratio"><i class="fa fa-check"></i><b>2.3</b> Filter meteorology using the depolarization ratio</a></li>
<li class="chapter" data-level="2.4" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#remove-classified-precipitation-from-polar-volumes"><i class="fa fa-check"></i><b>2.4</b> Remove classified precipitation from polar volumes</a></li>
<li class="chapter" data-level="2.5" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#filter-ground-clutter"><i class="fa fa-check"></i><b>2.5</b> Filter ground clutter</a></li>
<li class="chapter" data-level="2.6" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#range-bias-correction"><i class="fa fa-check"></i><b>2.6</b> Range-bias correction</a></li>
<li class="chapter" data-level="2.7" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#keep-biologymeteorology-classification"><i class="fa fa-check"></i><b>2.7</b> Keep biology/meteorology classification</a></li>
<li class="chapter" data-level="2.8" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#distance-to-radar"><i class="fa fa-check"></i><b>2.8</b> Distance to radar</a></li>
<li class="chapter" data-level="2.9" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#spatial-coordinates"><i class="fa fa-check"></i><b>2.9</b> Spatial coordinates</a></li>
<li class="chapter" data-level="2.10" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#visualising-range-bias-correction"><i class="fa fa-check"></i><b>2.10</b> Visualising range-bias correction</a></li>
<li class="chapter" data-level="2.11" data-path="02.Radar-data-preprocessing.html"><a href="02.Radar-data-preprocessing.html#preprocess-additional-scans"><i class="fa fa-check"></i><b>2.11</b> Preprocess additional scans</a></li>
</ul></li>
<li class="part"><span><b>II Land use</b></span></li>
<li class="chapter" data-level="3" data-path="03.Annotate-land-use.html"><a href="03.Annotate-land-use.html"><i class="fa fa-check"></i><b>3</b> Annotating land use</a><ul>
<li class="chapter" data-level="3.1" data-path="03.Annotate-land-use.html"><a href="03.Annotate-land-use.html#processing-environment-2"><i class="fa fa-check"></i><b>3.1</b> Processing environment</a></li>
<li class="chapter" data-level="3.2" data-path="03.Annotate-land-use.html"><a href="03.Annotate-land-use.html#converting-the-land-use-map"><i class="fa fa-check"></i><b>3.2</b> Converting the land use map</a></li>
<li class="chapter" data-level="3.3" data-path="03.Annotate-land-use.html"><a href="03.Annotate-land-use.html#adding-land-use-classifications-to-the-ppis"><i class="fa fa-check"></i><b>3.3</b> Adding land use classifications to the PPIs</a></li>
<li class="chapter" data-level="3.4" data-path="03.Annotate-land-use.html"><a href="03.Annotate-land-use.html#calculate-distance-to-nearest-urban-area"><i class="fa fa-check"></i><b>3.4</b> Calculate distance to nearest urban area</a></li>
<li class="chapter" data-level="3.5" data-path="03.Annotate-land-use.html"><a href="03.Annotate-land-use.html#add-population-density"><i class="fa fa-check"></i><b>3.5</b> Add population density</a></li>
</ul></li>
<li class="part"><span><b>III Sovon counts</b></span></li>
<li class="chapter" data-level="4" data-path="04.Annotate-count-areas.html"><a href="04.Annotate-count-areas.html"><i class="fa fa-check"></i><b>4</b> Annotating count areas</a><ul>
<li class="chapter" data-level="4.1" data-path="04.Annotate-count-areas.html"><a href="04.Annotate-count-areas.html#processing-environment-3"><i class="fa fa-check"></i><b>4.1</b> Processing environment</a></li>
<li class="chapter" data-level="4.2" data-path="04.Annotate-count-areas.html"><a href="04.Annotate-count-areas.html#annotate-ppis-with-waterbird-area-codes"><i class="fa fa-check"></i><b>4.2</b> Annotate PPIs with waterbird area codes</a></li>
<li class="chapter" data-level="4.3" data-path="04.Annotate-count-areas.html"><a href="04.Annotate-count-areas.html#annotate-ppis-with-point-transect-counts"><i class="fa fa-check"></i><b>4.3</b> Annotate PPIs with point-transect-counts</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="05.Processing-count-results.html"><a href="05.Processing-count-results.html"><i class="fa fa-check"></i><b>5</b> Processing count results</a><ul>
<li class="chapter" data-level="5.1" data-path="05.Processing-count-results.html"><a href="05.Processing-count-results.html#processing-environment-4"><i class="fa fa-check"></i><b>5.1</b> Processing environment</a></li>
<li class="chapter" data-level="5.2" data-path="05.Processing-count-results.html"><a href="05.Processing-count-results.html#loading-the-sovon-count-data"><i class="fa fa-check"></i><b>5.2</b> Loading the Sovon count data</a></li>
<li class="chapter" data-level="5.3" data-path="05.Processing-count-results.html"><a href="05.Processing-count-results.html#filteringpreprocessing-species-names"><i class="fa fa-check"></i><b>5.3</b> Filtering/preprocessing species names</a></li>
<li class="chapter" data-level="5.4" data-path="05.Processing-count-results.html"><a href="05.Processing-count-results.html#adding-vernacular-family-names"><i class="fa fa-check"></i><b>5.4</b> Adding vernacular family names</a></li>
<li class="chapter" data-level="5.5" data-path="05.Processing-count-results.html"><a href="05.Processing-count-results.html#linking-life-history-traits-to-species"><i class="fa fa-check"></i><b>5.5</b> Linking life-history traits to species</a></li>
<li class="chapter" data-level="5.6" data-path="05.Processing-count-results.html"><a href="05.Processing-count-results.html#calculating-total-bird-biomass"><i class="fa fa-check"></i><b>5.6</b> Calculating total bird biomass</a></li>
<li class="chapter" data-level="5.7" data-path="05.Processing-count-results.html"><a href="05.Processing-count-results.html#calculating-proportions-across-bird-families"><i class="fa fa-check"></i><b>5.7</b> Calculating proportions across bird families</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="06.Applying-annotations-to-all-PPIs.html"><a href="06.Applying-annotations-to-all-PPIs.html"><i class="fa fa-check"></i><b>6</b> Apply processing to all PPIs</a><ul>
<li class="chapter" data-level="6.1" data-path="06.Applying-annotations-to-all-PPIs.html"><a href="06.Applying-annotations-to-all-PPIs.html#processing-environment-5"><i class="fa fa-check"></i><b>6.1</b> Processing environment</a></li>
<li class="chapter" data-level="6.2" data-path="06.Applying-annotations-to-all-PPIs.html"><a href="06.Applying-annotations-to-all-PPIs.html#load-the-reference-ppis"><i class="fa fa-check"></i><b>6.2</b> Load the reference PPIs</a></li>
<li class="chapter" data-level="6.3" data-path="06.Applying-annotations-to-all-PPIs.html"><a href="06.Applying-annotations-to-all-PPIs.html#add-biomass-to-reference-ppis"><i class="fa fa-check"></i><b>6.3</b> Add biomass to reference PPIs</a></li>
<li class="chapter" data-level="6.4" data-path="06.Applying-annotations-to-all-PPIs.html"><a href="06.Applying-annotations-to-all-PPIs.html#copy-annotations-from-reference-ppis-to-other-ppis"><i class="fa fa-check"></i><b>6.4</b> Copy annotations from reference PPIs to other PPIs</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="07.Composite-all-PPIs.html"><a href="07.Composite-all-PPIs.html"><i class="fa fa-check"></i><b>7</b> Composite all PPIs</a><ul>
<li class="chapter" data-level="7.1" data-path="07.Composite-all-PPIs.html"><a href="07.Composite-all-PPIs.html#processing-environment-6"><i class="fa fa-check"></i><b>7.1</b> Processing environment</a></li>
<li class="chapter" data-level="7.2" data-path="07.Composite-all-PPIs.html"><a href="07.Composite-all-PPIs.html#generating-the-composite-ppis"><i class="fa fa-check"></i><b>7.2</b> Generating the composite PPIs</a></li>
<li class="chapter" data-level="7.3" data-path="07.Composite-all-PPIs.html"><a href="07.Composite-all-PPIs.html#visualising-the-composites"><i class="fa fa-check"></i><b>7.3</b> Visualising the composites</a></li>
</ul></li>
<li class="part"><span><b>IV Fireworks disturbance</b></span></li>
<li class="chapter" data-level="8" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html"><i class="fa fa-check"></i><b>8</b> Modelling fireworks disturbance</a><ul>
<li class="chapter" data-level="8.1" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#processing-environment-7"><i class="fa fa-check"></i><b>8.1</b> Processing environment</a></li>
<li class="chapter" data-level="8.2" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#preparing-a-dataset-for-modelling"><i class="fa fa-check"></i><b>8.2</b> Preparing a dataset for modelling</a></li>
<li class="chapter" data-level="8.3" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#determine-model-resolution-based-on-performance-in-simple-total_biomass-model"><i class="fa fa-check"></i><b>8.3</b> Determine model resolution based on performance in simple <code>total_biomass</code> model</a></li>
<li class="chapter" data-level="8.4" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#check-for-correlations-among-predictors"><i class="fa fa-check"></i><b>8.4</b> Check for correlations among predictors</a></li>
<li class="chapter" data-level="8.5" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#correlated-land-use-proportions"><i class="fa fa-check"></i><b>8.5</b> Correlated land use proportions</a></li>
<li class="chapter" data-level="8.6" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#determine-the-most-suitable-proxy-for-disturbance"><i class="fa fa-check"></i><b>8.6</b> Determine the most suitable proxy for disturbance</a></li>
<li class="chapter" data-level="8.7" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#determine-the-optimal-number-of-boosting-steps"><i class="fa fa-check"></i><b>8.7</b> Determine the optimal number of boosting steps</a></li>
<li class="chapter" data-level="8.8" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#variable-importance"><i class="fa fa-check"></i><b>8.8</b> Variable importance</a></li>
<li class="chapter" data-level="8.9" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#model-marginal-effects"><i class="fa fa-check"></i><b>8.9</b> Model marginal effects</a></li>
<li class="chapter" data-level="8.10" data-path="08.Model-fireworks-disturbance.html"><a href="08.Model-fireworks-disturbance.html#spatial-autocorrelation"><i class="fa fa-check"></i><b>8.10</b> Spatial autocorrelation</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="09.Quantifying-model-uncertainty.html"><a href="09.Quantifying-model-uncertainty.html"><i class="fa fa-check"></i><b>9</b> Quantifying model uncertainty</a><ul>
<li class="chapter" data-level="9.1" data-path="09.Quantifying-model-uncertainty.html"><a href="09.Quantifying-model-uncertainty.html#processing-environment-8"><i class="fa fa-check"></i><b>9.1</b> Processing environment</a></li>
<li class="chapter" data-level="9.2" data-path="09.Quantifying-model-uncertainty.html"><a href="09.Quantifying-model-uncertainty.html#load-the-constructed-model"><i class="fa fa-check"></i><b>9.2</b> Load the constructed model</a></li>
<li class="chapter" data-level="9.3" data-path="09.Quantifying-model-uncertainty.html"><a href="09.Quantifying-model-uncertainty.html#bootstrapped-uncertainty-analysis"><i class="fa fa-check"></i><b>9.3</b> Bootstrapped uncertainty analysis</a></li>
<li class="chapter" data-level="9.4" data-path="09.Quantifying-model-uncertainty.html"><a href="09.Quantifying-model-uncertainty.html#recombine-bootstrapped-results"><i class="fa fa-check"></i><b>9.4</b> Recombine bootstrapped results</a></li>
</ul></li>
<li class="part"><span><b>V Figures</b></span></li>
<li class="chapter" data-level="10" data-path="10.Figures-1-Data-overview.html"><a href="10.Figures-1-Data-overview.html"><i class="fa fa-check"></i><b>10</b> Figure 1: Data overview</a><ul>
<li class="chapter" data-level="10.1" data-path="10.Figures-1-Data-overview.html"><a href="10.Figures-1-Data-overview.html#processing-environment-9"><i class="fa fa-check"></i><b>10.1</b> Processing environment</a></li>
<li class="chapter" data-level="10.2" data-path="10.Figures-1-Data-overview.html"><a href="10.Figures-1-Data-overview.html#workflow"><i class="fa fa-check"></i><b>10.2</b> Workflow</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="10.Figures-2-Model.html"><a href="10.Figures-2-Model.html"><i class="fa fa-check"></i><b>11</b> Figure 2: Model output</a><ul>
<li class="chapter" data-level="11.1" data-path="10.Figures-2-Model.html"><a href="10.Figures-2-Model.html#processing-environment-10"><i class="fa fa-check"></i><b>11.1</b> Processing environment</a></li>
<li class="chapter" data-level="11.2" data-path="10.Figures-2-Model.html"><a href="10.Figures-2-Model.html#variable-importance-1"><i class="fa fa-check"></i><b>11.2</b> Variable importance</a></li>
<li class="chapter" data-level="11.3" data-path="10.Figures-2-Model.html"><a href="10.Figures-2-Model.html#compare-groups"><i class="fa fa-check"></i><b>11.3</b> Compare groups</a></li>
<li class="chapter" data-level="11.4" data-path="10.Figures-2-Model.html"><a href="10.Figures-2-Model.html#visualise-marginal-effects"><i class="fa fa-check"></i><b>11.4</b> Visualise marginal effects</a></li>
<li class="chapter" data-level="11.5" data-path="10.Figures-2-Model.html"><a href="10.Figures-2-Model.html#all-marginal-effects"><i class="fa fa-check"></i><b>11.5</b> All marginal effects</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="10.Figures-3-Species-composition.html"><a href="10.Figures-3-Species-composition.html"><i class="fa fa-check"></i><b>12</b> Figure 3: Species composition</a><ul>
<li class="chapter" data-level="12.1" data-path="10.Figures-3-Species-composition.html"><a href="10.Figures-3-Species-composition.html#processing-environment-11"><i class="fa fa-check"></i><b>12.1</b> Processing environment</a></li>
<li class="chapter" data-level="12.2" data-path="10.Figures-3-Species-composition.html"><a href="10.Figures-3-Species-composition.html#characteristic-families"><i class="fa fa-check"></i><b>12.2</b> Characteristic families</a></li>
<li class="chapter" data-level="12.3" data-path="10.Figures-3-Species-composition.html"><a href="10.Figures-3-Species-composition.html#mean-habitat-biomass-and-weight"><i class="fa fa-check"></i><b>12.3</b> Mean habitat biomass and weight</a></li>
<li class="chapter" data-level="12.4" data-path="10.Figures-3-Species-composition.html"><a href="10.Figures-3-Species-composition.html#sorting-of-families-by-weight"><i class="fa fa-check"></i><b>12.4</b> Sorting of families by weight</a></li>
<li class="chapter" data-level="12.5" data-path="10.Figures-3-Species-composition.html"><a href="10.Figures-3-Species-composition.html#prepare-plot"><i class="fa fa-check"></i><b>12.5</b> Prepare plot</a></li>
</ul></li>
<li class="part"><span><b>VI Appendix</b></span></li>
<li class="chapter" data-level="13" data-path="A1.Generating-VPs-for-Den-Helder-radar.html"><a href="A1.Generating-VPs-for-Den-Helder-radar.html"><i class="fa fa-check"></i><b>13</b> Generating vertical profiles for Den Helder radar</a></li>
<li class="part"><span><b>VII Other</b></span></li>
<li class="chapter" data-level="14" data-path="References.html"><a href="References.html"><i class="fa fa-check"></i><b>14</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Fireworks</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="composite-all-ppis" class="section level1">
<h1><span class="header-section-number">7</span> Composite all PPIs</h1>
<p>With all the preprocessing done, we can now make composites of the PPIs to ‘solve’ the overlapping areas of the Den Helder and Herwijnen radars. While we’re at it, we will also render out these composites for <code>VIR</code>, to visualise the en-masse take-off of birds.</p>
<div id="processing-environment-6" class="section level2">
<h2><span class="header-section-number">7.1</span> Processing environment</h2>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1"><span class="kw">library</span>(bioRad)</a>
<a class="sourceLine" id="cb125-2" data-line-number="2"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb125-3" data-line-number="3"><span class="kw">library</span>(magick)</a>
<a class="sourceLine" id="cb125-4" data-line-number="4"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb125-5" data-line-number="5"><span class="kw">library</span>(viridis)</a>
<a class="sourceLine" id="cb125-6" data-line-number="6"><span class="kw">library</span>(dplyr)</a></code></pre></div>
</div>
<div id="generating-the-composite-ppis" class="section level2">
<h2><span class="header-section-number">7.2</span> Generating the composite PPIs</h2>
<p>We will loop over all the Herwijnen and Den Helder PPIs we have generated so far to create composite PPIs for all included parameters. We generate these composites at a 500m, 1000m and 2000m resolution to later test at which resolution the models perform best. Additionally we will save the composites as a bunch of .png files that we can then use separately or inclued in the animated GIF below.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" data-line-number="1"><span class="kw">source</span>(<span class="st">&quot;R/comp_ppi.R&quot;</span>)</a>
<a class="sourceLine" id="cb126-2" data-line-number="2">hrw_ppis &lt;-<span class="st"> </span><span class="kw">Sys.glob</span>(<span class="kw">file.path</span>(<span class="st">&quot;data/processed/final-ppis&quot;</span>, <span class="st">&quot;*NL62*&quot;</span>))</a>
<a class="sourceLine" id="cb126-3" data-line-number="3">dhl_ppis &lt;-<span class="st"> </span><span class="kw">Sys.glob</span>(<span class="kw">file.path</span>(<span class="st">&quot;data/processed/final-ppis&quot;</span>, <span class="st">&quot;*NL61*&quot;</span>))</a>
<a class="sourceLine" id="cb126-4" data-line-number="4"></a>
<a class="sourceLine" id="cb126-5" data-line-number="5">generate_composites &lt;-<span class="st"> </span><span class="cf">function</span>(hrw_ppis, dhl_ppis, res, maxrange) {</a>
<a class="sourceLine" id="cb126-6" data-line-number="6">  <span class="co"># Make a new empty PPI to store all composites in</span></a>
<a class="sourceLine" id="cb126-7" data-line-number="7">  template_ppi &lt;-<span class="st"> </span><span class="kw">readRDS</span>(hrw_ppis[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb126-8" data-line-number="8">  all &lt;-<span class="st"> </span>template_ppi<span class="op">$</span>data<span class="op">@</span>data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb126-9" data-line-number="9"><span class="st">    </span><span class="kw">filter</span>(<span class="kw">row_number</span>() <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb126-10" data-line-number="10">  </a>
<a class="sourceLine" id="cb126-11" data-line-number="11">  basemap &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb126-12" data-line-number="12">  </a>
<a class="sourceLine" id="cb126-13" data-line-number="13">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(hrw_ppis)) {</a>
<a class="sourceLine" id="cb126-14" data-line-number="14">    ppi_hrw &lt;-<span class="st"> </span><span class="kw">readRDS</span>(hrw_ppis[i])</a>
<a class="sourceLine" id="cb126-15" data-line-number="15">    ppi_dhl &lt;-<span class="st"> </span><span class="kw">readRDS</span>(dhl_ppis[i])</a>
<a class="sourceLine" id="cb126-16" data-line-number="16">    </a>
<a class="sourceLine" id="cb126-17" data-line-number="17">    <span class="co"># Set all columns to NA if further than maxrange from radar</span></a>
<a class="sourceLine" id="cb126-18" data-line-number="18">    ppi_hrw<span class="op">$</span>data<span class="op">@</span>data[ppi_hrw<span class="op">$</span>data<span class="op">@</span>data<span class="op">$</span>dist_radar <span class="op">&gt;</span><span class="st"> </span>maxrange, ] &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb126-19" data-line-number="19">    ppi_dhl<span class="op">$</span>data<span class="op">@</span>data[ppi_dhl<span class="op">$</span>data<span class="op">@</span>data<span class="op">$</span>dist_radar <span class="op">&gt;</span><span class="st"> </span>maxrange, ] &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb126-20" data-line-number="20">    </a>
<a class="sourceLine" id="cb126-21" data-line-number="21">    params &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;VIR&quot;</span>, <span class="st">&quot;VID&quot;</span>, <span class="st">&quot;R&quot;</span>, <span class="st">&quot;overlap&quot;</span>, <span class="st">&quot;eta_sum&quot;</span>, <span class="st">&quot;eta_sum_expected&quot;</span>, <span class="st">&quot;dist_radar&quot;</span>, <span class="st">&quot;class&quot;</span>,</a>
<a class="sourceLine" id="cb126-22" data-line-number="22">                <span class="st">&quot;urban&quot;</span>, <span class="st">&quot;agricultural&quot;</span>, <span class="st">&quot;semiopen&quot;</span>, <span class="st">&quot;forests&quot;</span>, <span class="st">&quot;wetlands&quot;</span>, <span class="st">&quot;waterbodies&quot;</span>, <span class="st">&quot;dist_urban&quot;</span>, <span class="st">&quot;human_pop&quot;</span>,</a>
<a class="sourceLine" id="cb126-23" data-line-number="23">                <span class="st">&quot;wb_area_id&quot;</span>, <span class="st">&quot;wb_area_nr&quot;</span>, <span class="st">&quot;ptt_route&quot;</span>, <span class="st">&quot;wb_area_ha&quot;</span>, <span class="st">&quot;wb_total_biomass&quot;</span>, <span class="st">&quot;ptt_total_biomass&quot;</span>, <span class="st">&quot;total_biomass&quot;</span>, </a>
<a class="sourceLine" id="cb126-24" data-line-number="24">                <span class="st">&quot;wb_weighted_mean_weight&quot;</span>, <span class="st">&quot;ptt_weighted_mean_weight&quot;</span>, <span class="st">&quot;weighted_mean_weight&quot;</span>)</a>
<a class="sourceLine" id="cb126-25" data-line-number="25">    <span class="co"># All mean methods except for factors and urban area (set to max), because we want to strictly filter out fireworks</span></a>
<a class="sourceLine" id="cb126-26" data-line-number="26">    methods &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;mean&quot;</span>, <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;min&quot;</span>, <span class="st">&quot;min&quot;</span>,</a>
<a class="sourceLine" id="cb126-27" data-line-number="27">                 <span class="st">&quot;max&quot;</span>, <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;mean&quot;</span>, </a>
<a class="sourceLine" id="cb126-28" data-line-number="28">                 <span class="st">&quot;factor&quot;</span>, <span class="st">&quot;factor&quot;</span>, <span class="st">&quot;factor&quot;</span>, <span class="st">&quot;factor&quot;</span>, <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;mean&quot;</span>,</a>
<a class="sourceLine" id="cb126-29" data-line-number="29">                 <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;mean&quot;</span>)</a>
<a class="sourceLine" id="cb126-30" data-line-number="30">    cppi &lt;-<span class="st"> </span><span class="kw">comp_ppi</span>(<span class="kw">list</span>(ppi_hrw, ppi_dhl), <span class="dt">param =</span> params, <span class="dt">method =</span> methods, <span class="dt">res =</span> <span class="kw">c</span>(res, res), <span class="dt">coverage =</span> <span class="st">&quot;count&quot;</span>)</a>
<a class="sourceLine" id="cb126-31" data-line-number="31">    </a>
<a class="sourceLine" id="cb126-32" data-line-number="32">    <span class="co"># Set rain and background pixels to NA</span></a>
<a class="sourceLine" id="cb126-33" data-line-number="33">    cppi<span class="op">$</span>data<span class="op">$</span>VIR[cppi<span class="op">$</span>data<span class="op">$</span>class <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb126-34" data-line-number="34">    </a>
<a class="sourceLine" id="cb126-35" data-line-number="35">    <span class="co"># Add coordinates</span></a>
<a class="sourceLine" id="cb126-36" data-line-number="36">    coords_cppi &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw">coordinates</span>(cppi<span class="op">$</span>data)</a>
<a class="sourceLine" id="cb126-37" data-line-number="37">    cppi<span class="op">$</span>data<span class="op">$</span>x &lt;-<span class="st"> </span>coords_cppi[, <span class="dv">1</span>]</a>
<a class="sourceLine" id="cb126-38" data-line-number="38">    cppi<span class="op">$</span>data<span class="op">$</span>y &lt;-<span class="st"> </span>coords_cppi[, <span class="dv">2</span>]</a>
<a class="sourceLine" id="cb126-39" data-line-number="39">    </a>
<a class="sourceLine" id="cb126-40" data-line-number="40">    <span class="co"># Add pixel ID</span></a>
<a class="sourceLine" id="cb126-41" data-line-number="41">    cppi<span class="op">$</span>data<span class="op">@</span>data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb126-42" data-line-number="42"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">pixel =</span> <span class="kw">row_number</span>()) -&gt;<span class="st"> </span>cppi<span class="op">$</span>data<span class="op">@</span>data</a>
<a class="sourceLine" id="cb126-43" data-line-number="43">    </a>
<a class="sourceLine" id="cb126-44" data-line-number="44">    <span class="co"># Solve different factors</span></a>
<a class="sourceLine" id="cb126-45" data-line-number="45">    solve_factors &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb126-46" data-line-number="46">      r &lt;-<span class="st"> </span>x[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb126-47" data-line-number="47">      <span class="cf">if</span> (<span class="kw">is.na</span>(x[<span class="dv">1</span>]) <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">is.na</span>(x[<span class="dv">2</span>])) { r &lt;-<span class="st"> </span><span class="ot">NA</span> }</a>
<a class="sourceLine" id="cb126-48" data-line-number="48">      <span class="cf">if</span> (<span class="kw">is.na</span>(x[<span class="dv">1</span>]) <span class="op">&amp;&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(x[<span class="dv">2</span>])) { r &lt;-<span class="st"> </span>x[<span class="dv">2</span>] }</a>
<a class="sourceLine" id="cb126-49" data-line-number="49">      <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.na</span>(x[<span class="dv">1</span>]) <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">is.na</span>(x[<span class="dv">2</span>])) { r &lt;-<span class="st"> </span>x[<span class="dv">1</span>] }</a>
<a class="sourceLine" id="cb126-50" data-line-number="50">      <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.na</span>(x[<span class="dv">1</span>]) <span class="op">&amp;&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(x[<span class="dv">2</span>])) {</a>
<a class="sourceLine" id="cb126-51" data-line-number="51">        <span class="cf">if</span> (x[<span class="dv">1</span>] <span class="op">!=</span><span class="st"> </span>x[<span class="dv">2</span>]) {</a>
<a class="sourceLine" id="cb126-52" data-line-number="52">          r &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb126-53" data-line-number="53">        } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb126-54" data-line-number="54">          r &lt;-<span class="st"> </span>x[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb126-55" data-line-number="55">        }</a>
<a class="sourceLine" id="cb126-56" data-line-number="56">      }</a>
<a class="sourceLine" id="cb126-57" data-line-number="57">      r</a>
<a class="sourceLine" id="cb126-58" data-line-number="58">    }</a>
<a class="sourceLine" id="cb126-59" data-line-number="59">    </a>
<a class="sourceLine" id="cb126-60" data-line-number="60">    <span class="cf">for</span> (j <span class="cf">in</span> <span class="kw">which</span>(methods <span class="op">==</span><span class="st"> &quot;factor&quot;</span>)) {</a>
<a class="sourceLine" id="cb126-61" data-line-number="61">      cppi<span class="op">$</span>data<span class="op">@</span>data[params[j]] &lt;-<span class="st"> </span><span class="kw">apply</span>(cppi<span class="op">$</span>data<span class="op">@</span>data[params[j]], <span class="dv">1</span>, solve_factors)</a>
<a class="sourceLine" id="cb126-62" data-line-number="62">    }</a>
<a class="sourceLine" id="cb126-63" data-line-number="63">    </a>
<a class="sourceLine" id="cb126-64" data-line-number="64">    <span class="kw">saveRDS</span>(cppi, <span class="dt">file =</span> <span class="kw">paste</span>(<span class="st">&quot;data/processed/composite-ppis/&quot;</span>, res, <span class="st">&quot;m/&quot;</span>, <span class="kw">strftime</span>(ppi_hrw<span class="op">$</span>datetime, <span class="dt">format =</span> <span class="st">&quot;%Y%m%d%H%M&quot;</span>), <span class="st">&quot;.RDS&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb126-65" data-line-number="65">    </a>
<a class="sourceLine" id="cb126-66" data-line-number="66">    cppi<span class="op">$</span>data<span class="op">@</span>data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb126-67" data-line-number="67"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">datetime =</span> <span class="kw">as.POSIXct</span>(ppi_hrw<span class="op">$</span>datetime)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb126-68" data-line-number="68"><span class="st">      </span><span class="kw">bind_rows</span>(all) -&gt;<span class="st"> </span>all</a>
<a class="sourceLine" id="cb126-69" data-line-number="69">    </a>
<a class="sourceLine" id="cb126-70" data-line-number="70">    <span class="cf">if</span> (i <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb126-71" data-line-number="71">      basemap &lt;-<span class="st"> </span><span class="kw">download_basemap</span>(cppi, <span class="dt">alpha =</span> <span class="fl">0.3</span>)</a>
<a class="sourceLine" id="cb126-72" data-line-number="72">    }</a>
<a class="sourceLine" id="cb126-73" data-line-number="73">    </a>
<a class="sourceLine" id="cb126-74" data-line-number="74">    cppi<span class="op">$</span>data<span class="op">$</span>VIR &lt;-<span class="st"> </span><span class="kw">log10</span>(cppi<span class="op">$</span>data<span class="op">$</span>VIR)</a>
<a class="sourceLine" id="cb126-75" data-line-number="75">    cppi<span class="op">$</span>data<span class="op">$</span>VIR[<span class="kw">is.na</span>(cppi<span class="op">$</span>data<span class="op">$</span>VIR)] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb126-76" data-line-number="76">    </a>
<a class="sourceLine" id="cb126-77" data-line-number="77">    bioRad<span class="op">::</span><span class="kw">map</span>(cppi, <span class="dt">map =</span> basemap, <span class="dt">radar_size =</span> <span class="dv">1</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="fl">3.1</span>, <span class="fl">6.8</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">51</span>, <span class="dv">54</span>), <span class="dt">zlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">4.5</span>),</a>
<a class="sourceLine" id="cb126-78" data-line-number="78">                <span class="dt">palette =</span> <span class="kw">viridis</span>(<span class="dv">256</span>, <span class="dt">option =</span> <span class="st">&quot;viridis&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.6</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb126-79" data-line-number="79"><span class="st">      </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Fireworks NYE 2017-2018&quot;</span>,</a>
<a class="sourceLine" id="cb126-80" data-line-number="80">           <span class="dt">subtitle =</span> <span class="kw">paste</span>(ppi_hrw<span class="op">$</span>datetime, <span class="st">&#39; UTC&#39;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb126-81" data-line-number="81"></a>
<a class="sourceLine" id="cb126-82" data-line-number="82">    <span class="kw">ggsave</span>(<span class="kw">paste</span>(<span class="st">&quot;data/plots/vir-ppis/&quot;</span>, res, <span class="st">&quot;m/&quot;</span>, <span class="kw">strftime</span>(ppi_hrw<span class="op">$</span>datetime, <span class="dt">format =</span> <span class="st">&quot;%Y%m%d%H%M&quot;</span>), <span class="st">&quot;.png&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb126-83" data-line-number="83">  }</a>
<a class="sourceLine" id="cb126-84" data-line-number="84">  </a>
<a class="sourceLine" id="cb126-85" data-line-number="85">  <span class="kw">saveRDS</span>(all, <span class="dt">file =</span> <span class="kw">paste</span>(<span class="st">&quot;data/processed/all_&quot;</span>, res, <span class="st">&quot;m.RDS&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb126-86" data-line-number="86">}</a>
<a class="sourceLine" id="cb126-87" data-line-number="87"></a>
<a class="sourceLine" id="cb126-88" data-line-number="88"><span class="co"># Somehow this often hangs despite ample memory available, in which case better executed serially.</span></a>
<a class="sourceLine" id="cb126-89" data-line-number="89"><span class="co"># r &lt;- parallel::mclapply(c(500, 1000, 2000), function(x) { generate_composites(hrw_ppis, dhl_ppis, res = x, maxrange = 66000)},</span></a>
<a class="sourceLine" id="cb126-90" data-line-number="90"><span class="co">#                         mc.cores = 3, mc.preschedule = FALSE)</span></a>
<a class="sourceLine" id="cb126-91" data-line-number="91">r &lt;-<span class="st"> </span>parallel<span class="op">::</span><span class="kw">mclapply</span>(<span class="kw">c</span>(<span class="dv">1000</span>, <span class="dv">2000</span>), <span class="cf">function</span>(x) { <span class="kw">generate_composites</span>(hrw_ppis, dhl_ppis, <span class="dt">res =</span> x, <span class="dt">maxrange =</span> <span class="dv">66000</span>)},</a>
<a class="sourceLine" id="cb126-92" data-line-number="92">                        <span class="dt">mc.cores =</span> <span class="dv">3</span>, <span class="dt">mc.preschedule =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
</div>
<div id="visualising-the-composites" class="section level2">
<h2><span class="header-section-number">7.3</span> Visualising the composites</h2>
<p>In order to run this <em>comparatively simple</em> conversion to a GIF of the PPIs, it may be necessary to increase the memory available to ImageMagick by changing the memory policy in <code>/etc/ImageMagick-6/policy.xml</code>. Additionally, we will reduce the resolution of the animated GIF and we’ll stick to the 1000m resolution PPIs.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" data-line-number="1">width &lt;-<span class="st"> </span><span class="dv">800</span></a>
<a class="sourceLine" id="cb127-2" data-line-number="2"></a>
<a class="sourceLine" id="cb127-3" data-line-number="3">composites &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="dt">path =</span> <span class="st">&quot;data/plots/vir-ppis/1000m/&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;*.png&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb127-4" data-line-number="4"></a>
<a class="sourceLine" id="cb127-5" data-line-number="5">process_image &lt;-<span class="st"> </span><span class="cf">function</span>(img_path) {</a>
<a class="sourceLine" id="cb127-6" data-line-number="6">  <span class="kw">image_read</span>(img_path) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb127-7" data-line-number="7"><span class="st">    </span><span class="kw">image_resize</span>(<span class="kw">geometry_size_pixels</span>(<span class="dt">width =</span> width)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb127-8" data-line-number="8"><span class="st">    </span><span class="kw">image_write</span>(<span class="dt">path =</span> <span class="kw">paste</span>(tools<span class="op">::</span><span class="kw">file_path_sans_ext</span>(img_path), <span class="st">&quot;.jpeg&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>), <span class="dt">format =</span> <span class="st">&quot;jpeg&quot;</span>)</a>
<a class="sourceLine" id="cb127-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb127-10" data-line-number="10"></a>
<a class="sourceLine" id="cb127-11" data-line-number="11"><span class="cf">for</span> (file <span class="cf">in</span> <span class="kw">list.files</span>(<span class="dt">path =</span> <span class="st">&quot;data/plots/vir-ppis/&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;*.png&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>)) {</a>
<a class="sourceLine" id="cb127-12" data-line-number="12">  <span class="kw">process_image</span>(file)</a>
<a class="sourceLine" id="cb127-13" data-line-number="13">}</a>
<a class="sourceLine" id="cb127-14" data-line-number="14"></a>
<a class="sourceLine" id="cb127-15" data-line-number="15"><span class="kw">list.files</span>(<span class="dt">path =</span> <span class="st">&quot;data/plots/vir-ppis/&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;*.jpeg&quot;</span>, <span class="dt">full.names =</span> T) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb127-16" data-line-number="16"><span class="st">  </span>purrr<span class="op">::</span><span class="kw">map</span>(image_read) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb127-17" data-line-number="17"><span class="st">  </span><span class="kw">image_join</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb127-18" data-line-number="18"><span class="st">  </span><span class="kw">image_animate</span>(<span class="dt">fps =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb127-19" data-line-number="19"><span class="st">  </span><span class="kw">image_write</span>(<span class="st">&quot;data/plots/vir-ppis/NYE-2017-2018.gif&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" data-line-number="1">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;data/plots/vir-ppis/NYE-2017-2018.gif&quot;</span>)</a></code></pre></div>
<div class="figure">
<img src="/mnt/volume_ams3_01/plots/vir-ppis/NYE-2017-2018.gif" alt="Animation of VIRs during NYE 2017-2018"  />
<p class="caption">
(#fig:composite_ppi_animation)Animation of VIRs during NYE 2017-2018
</p>
</div>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="06.Applying-annotations-to-all-PPIs.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="08.Model-fireworks-disturbance.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/lunr.js"></script>
<script src="assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/barthoekstra/fireworks/edit/master/07.Composite-all-PPIs.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/barthoekstra/fireworks/blob/master/07.Composite-all-PPIs.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true,
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
