# (PART) Figures {-}

# Figure 1: Data overview

Most of Figure 1 in the paper is made using QGIS and Adobe Illustrator, but here we export `VIR` and `total_biomass` estimates. Furthermore, we use the land use map that is stored in `data/processed/landuse/landuse_hrw_reclassified.tif`, so that doesn't need exporting anymore.

## Processing environment
```{r eval=full_repro, message=FALSE, warning=FALSE}
library(bioRad)
library(raster)
library(magrittr)
source("R/comp_ppi.R")
```

## Workflow

We load the radar PPIs.

```{r load_ppis, eval=full_repro}
hrw <- readRDS("data/processed/final-ppis/RAD_NL62_VOL_NA_201712312305_ODIM.RDS")
dhl <- readRDS("data/processed/final-ppis/RAD_NL61_VOL_NA_201712312305_ODIM.RDS")
```

Composite the PPIs and log-transform `VIR` and `total_biomass` for improved visualisation.

```{r composite_and_logtransform, eval=full_repro}
cppi <- comp_ppi(list(hrw, dhl), param = c("VIR", "total_biomass"), res = 500, method = c("mean", "mean"))
cppi$data$VIR <- log10(cppi$data$VIR)
cppi$data$VIR[is.infinite(cppi$data$VIR)] <- 0
cppi$data$VIR[cppi$data$VIR == 0] <- NA
cppi$data$total_biomass[cppi$data$total_biomass == 0] <- NA
cppi$data$total_biomass <- log10(cppi$data$total_biomass)
```

Make plots to confirm the composite and transformation works as intended.

```{r plot_to_verify, eval=full_repro}
plot(cppi, param = "VIR", zlim = c(0, 10))
plot(cppi, param = "total_biomass", zlim = c(0, 7))
```

And now we write out raster files containing these parameters, which we can then stitch together in QGIS and Adobe Illustrator.

```{r write_params_to_raster, eval=full_repro}
raster::writeRaster(as(cppi$data["VIR"], "RasterLayer"), filename = "data/plots/paper/fig1_VIR.tif", overwrite = TRUE)
raster::writeRaster(as(cppi$data["total_biomass"], "RasterLayer"), filename = "data/plots/paper/fig1_total_biomass.tif", overwrite = TRUE)
```